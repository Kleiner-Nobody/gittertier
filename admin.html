<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gittertier Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
    :root {
        --color-bg: #ffffff;
        --color-bg-secondary: #f9fafb;
        --color-text: #111111;
        --color-text-muted: #6b7280;
        --color-border: #e5e7eb;
        --color-accent: #2563eb;
        --color-accent-hover: #1d4ed8;
        --color-success: #16a34a;
        --color-error: #dc2626;
        --color-warning: #d97706;
        --color-info: #2563eb;
        --color-loyalty: #7e22ce;
        --color-delivery: #22c55e;
        --color-bagging: #f97316;
        --color-donation: #3b82f6;
        --color-premium: #c5a47e;
        --color-overlay: rgba(0, 0, 0, 0.5);
        
        --radius: 12px;
        --radius-sm: 6px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.07), 0 1px 2px rgba(0, 0, 0, 0.04);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --focus-ring: 0 0 0 3px rgba(37, 99, 235, 0.35);
        
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-xxl: 48px;
        
        --transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
        --transition-slow: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        
        --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        
        --header-height: 64px;
        --sidebar-width: 280px;
    }

    .dark-mode {
        --color-bg: #111827;
        --color-bg-secondary: #1f2937;
        --color-text: #f3f4f6;
        --color-text-muted: #9ca3af;
        --color-border: #374151;
        --color-accent: #3b82f6;
        --color-accent-hover: #2563eb;
        --color-success: #10b981;
        --color-error: #ef4444;
        --color-warning: #f59e0b;
        --color-info: #3b82f6;
        --color-loyalty: #a855f7;
        --color-delivery: #22c55e;
        --color-bagging: #fb923c;
        --color-donation: #60a5fa;
        --color-premium: #d6bc97;
        --color-overlay: rgba(0, 0, 0, 0.7);
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: var(--font-family);
        background-color: var(--color-bg);
        color: var(--color-text);
        line-height: 1.5;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Header Styles */
    .admin-header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-lg);
        border-bottom: 1px solid var(--color-border);
        background-color: var(--color-bg);
        position: sticky;
        top: 0;
        z-index: 50;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        font-weight: 700;
        font-size: var(--text-xl);
    }

    .logo i {
        font-size: var(--text-xl);
        color: var(--color-accent);
    }

    .header-controls {
        display: flex;
        gap: var(--spacing-md);
        align-items: center;
    }

    .time-display {
        background-color: var(--color-bg-secondary);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        display: none;
    }

    .logout-btn {
        background-color: transparent;
        color: var(--color-text);
        border: 1px solid var(--color-border);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .logout-btn:hover {
        background-color: var(--color-bg-secondary);
    }

    .hamburger {
        display: block;
        background: transparent;
        border: none;
        font-size: var(--text-lg);
        color: var(--color-text);
        cursor: pointer;
        transition: var(--transition);
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .hamburger:hover {
        background-color: var(--color-bg-secondary);
    }

    /* Main layout */
    .admin-container {
        display: flex;
        flex: 1;
    }

    /* Sidebar */
    .admin-sidebar {
        width: var(--sidebar-width);
        background-color: var(--color-bg);
        border-right: 1px solid var(--color-border);
        height: calc(100vh - var(--header-height));
        position: fixed;
        top: var(--header-height);
        left: 0;
        overflow-y: auto;
        transition: transform 0.3s ease;
        z-index: 40;
        padding: var(--spacing-lg) 0;
    }

    .nav-container {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
        padding: 0 var(--spacing-md);
    }

    .nav-link {
        padding: var(--spacing-md);
        border-radius: var(--radius);
        text-decoration: none;
        color: var(--color-text);
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .nav-link:hover {
        background-color: var(--color-bg-secondary);
    }

    .nav-link.active {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--color-accent);
    }

    .nav-link i {
        width: 24px;
        text-align: center;
    }

    .nav-link.active i {
        color: var(--color-accent);
    }

    .new-feature {
        background-color: var(--color-success);
        color: white;
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: auto;
    }

    /* Sidebar overlay for mobile */
    .sidebar-overlay {
        position: fixed;
        top: var(--header-height);
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        z-index: 35;
        display: none;
    }

    /* Main content */
    .admin-content {
        flex: 1;
        padding: var(--spacing-lg);
        margin-left: var(--sidebar-width);
        transition: margin-left 0.3s ease;
    }

    /* Dashboard Header */
    .dashboard-header {
        margin-bottom: var(--spacing-xl);
    }

    .dashboard-title {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
    }

    .dashboard-subtitle {
        color: var(--color-text-muted);
        font-size: var(--text-lg);
    }

    /* Welcome Card */
    .welcome-card {
        background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-hover) 100%);
        color: white;
        border-radius: var(--radius);
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
    }

    .welcome-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
    }

    .welcome-card h1 {
        font-size: var(--text-2xl);
        margin-bottom: var(--spacing-sm);
    }

    .welcome-card p {
        opacity: 0.9;
        max-width: 600px;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }

    .stat-card {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        border: 1px solid var(--color-border);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow);
        transition: var(--transition);
    }

    .stat-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
    }

    .stat-card-title {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        font-weight: 500;
    }

    .stat-card-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-lg);
    }

    .stat-card-icon.revenue {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--color-accent);
    }

    .stat-card-icon.sales {
        background-color: rgba(22, 163, 74, 0.1);
        color: var(--color-success);
    }

    .stat-card-icon.customers {
        background-color: rgba(126, 34, 206, 0.1);
        color: var(--color-loyalty);
    }

    .stat-card-icon.avg-order {
        background-color: rgba(217, 119, 6, 0.1);
        color: var(--color-warning);
    }

    .stat-card-value {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
    }

    .stat-card-change {
        font-size: var(--text-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }

    .stat-card-change.positive {
        color: var(--color-success);
    }

    .stat-card-change.negative {
        color: var(--color-error);
    }

    /* Dashboard Cards */
    .dashboard-card {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        border: 1px solid var(--color-border);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow);
        margin-bottom: var(--spacing-xl);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-lg);
    }

    .card-title {
        font-size: var(--text-lg);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .card-title i {
        color: var(--color-accent);
    }

    .card-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .card-action-btn {
        background: transparent;
        border: 1px solid var(--color-border);
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        color: var(--color-text-muted);
    }

    .card-action-btn:hover {
        background-color: var(--color-bg-secondary);
        color: var(--color-text);
    }

    /* Charts Section */
    .charts-section {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }

    @media (max-width: 1024px) {
        .charts-section {
            grid-template-columns: 1fr;
        }
    }

    .chart-card {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        border: 1px solid var(--color-border);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow);
    }

    .chart-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .chart-card-title {
        font-size: var(--text-lg);
        font-weight: 600;
    }

    .chart-card-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .chart-action-btn {
        background: transparent;
        border: 1px solid var(--color-border);
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        color: var(--color-text-muted);
    }

    .chart-action-btn:hover {
        background-color: var(--color-bg-secondary);
        color: var(--color-text);
    }

    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }

    /* Tables Section */
    .tables-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }

    @media (max-width: 1024px) {
        .tables-section {
            grid-template-columns: 1fr;
        }
    }

    .table-card {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        border: 1px solid var(--color-border);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow);
    }

    .table-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .table-card-title {
        font-size: var(--text-lg);
        font-weight: 600;
    }

    .table-card-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .table-container {
        overflow-x: auto;
    }

    .dashboard-table {
        width: 100%;
        border-collapse: collapse;
    }

    .dashboard-table th,
    .dashboard-table td {
        padding: var(--spacing-sm);
        text-align: left;
        border-bottom: 1px solid var(--color-border);
    }

    .dashboard-table th {
        font-weight: 600;
        color: var(--color-text-muted);
        background-color: var(--color-bg-secondary);
        position: sticky;
        top: 0;
    }

    .dashboard-table tr:last-child td {
        border-bottom: none;
    }

    .dashboard-table tr:hover {
        background-color: var(--color-bg-secondary);
    }

    /* Goal Progress */
    .goal-progress {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .goal-progress-bar {
        flex: 1;
        height: 8px;
        background-color: var(--color-bg-secondary);
        border-radius: 4px;
        overflow: hidden;
    }

    .goal-progress-fill {
        height: 100%;
        background-color: var(--color-success);
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .goal-progress-text {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        min-width: 80px;
        text-align: right;
    }

    /* Quick Actions */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
    }

    .quick-action-btn {
        background-color: var(--color-bg);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        padding: var(--spacing-lg);
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .quick-action-btn:hover {
        background-color: var(--color-bg-secondary);
        border-color: var(--color-accent);
        transform: translateY(-2px);
    }

    .quick-action-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-xl);
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--color-accent);
    }

    .quick-action-text {
        font-weight: 500;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        z-index: 1000;
        display: none;
    }

    .modal-overlay.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: var(--color-bg);
        border-radius: var(--radius);
        box-shadow: var(--shadow-lg);
        z-index: 1001;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        display: none;
    }

    .modal.active {
        display: block;
        animation: scaleIn 0.3s ease;
    }

    .modal-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--color-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h2 {
        font-size: var(--text-xl);
        font-weight: 600;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: var(--text-xl);
        cursor: pointer;
        color: var(--color-text-muted);
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .modal-close:hover {
        background-color: var(--color-bg-secondary);
    }

    .modal-content {
        padding: var(--spacing-lg);
    }

    .modal-input {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        margin-bottom: var(--spacing-md);
        font-size: var(--text-base);
        transition: var(--transition);
        background: var(--color-bg);
        color: var(--color-text);
    }

    .modal-input:focus {
        outline: none;
        border-color: var(--color-accent);
        box-shadow: var(--focus-ring);
    }

    .modal-buttons {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }

    .modal-buttons button {
        flex: 1;
        padding: var(--spacing-md);
        border: none;
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
    }

    .btn-save {
        background: var(--color-success);
        color: white;
    }

    .btn-save:hover {
        background: #0f9c5a;
    }

    .btn-cancel {
        background: var(--color-bg);
        border: 1px solid var(--color-border);
        color: var(--color-text);
    }

    .btn-cancel:hover {
        background: var(--color-bg-secondary);
    }

    /* Form Styles */
    .form-group {
        margin-bottom: var(--spacing-md);
    }

    .form-label {
        display: block;
        margin-bottom: var(--spacing-xs);
        font-weight: 500;
    }

    .form-control {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        transition: var(--transition);
        background: var(--color-bg);
        color: var(--color-text);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--color-accent);
        box-shadow: var(--focus-ring);
    }

    /* Alert Styles */
    .alert {
        padding: var(--spacing-md);
        border-radius: var(--radius);
        margin-bottom: var(--spacing-md);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .alert-success {
        background-color: rgba(22, 163, 74, 0.1);
        color: var(--color-success);
        border: 1px solid rgba(22, 163, 74, 0.2);
    }

    .alert-warning {
        background-color: rgba(217, 119, 6, 0.1);
        color: var(--color-warning);
        border: 1px solid rgba(217, 119, 6, 0.2);
    }

    .alert-error {
        background-color: rgba(220, 38, 38, 0.1);
        color: var(--color-error);
        border: 1px solid rgba(220, 38, 38, 0.2);
    }

    /* Badge Styles */
    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 20px;
        font-size: var(--text-xs);
        font-weight: 600;
    }

    .badge-success {
        background-color: var(--color-success);
        color: white;
    }

    .badge-warning {
        background-color: var(--color-warning);
        color: white;
    }

    .badge-error {
        background-color: var(--color-error);
        color: white;
    }

    .badge-info {
        background-color: var(--color-info);
        color: white;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: var(--spacing-xl);
        color: var(--color-text-muted);
    }

    .empty-state i {
        font-size: var(--text-3xl);
        margin-bottom: var(--spacing-md);
        display: block;
        opacity: 0.5;
    }

    .empty-state h3 {
        font-size: var(--text-xl);
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
    }

    /* Loading State */
    .loading-state {
        text-align: center;
        padding: var(--spacing-xl);
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--color-border);
        border-top: 4px solid var(--color-accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto var(--spacing-md);
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes scaleIn {
        from { transform: translate(-50%, -50%) scale(0.95); opacity: 0; }
        to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .admin-sidebar {
            transform: translateX(-100%);
        }
        
        .admin-sidebar.active {
            transform: translateX(0);
        }
        
        .admin-content {
            margin-left: 0;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
    }

    @media (min-width: 768px) {
        .time-display {
            display: block;
        }
        
        .logout-btn span {
            display: inline;
        }
    }

    @media (max-width: 768px) {
        .admin-header {
            padding: 0 var(--spacing-md);
        }
        
        .admin-content {
            padding: var(--spacing-md);
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .charts-section {
            grid-template-columns: 1fr;
        }
        
        .tables-section {
            grid-template-columns: 1fr;
        }
        
        .quick-actions {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        .modal-buttons {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .quick-actions {
            grid-template-columns: 1fr 1fr;
        }
    }

    /* Dark mode support for system preference */
    @media (prefers-color-scheme: dark) {
        :root {
            --color-bg: #111827;
            --color-bg-secondary: #1f2937;
            --color-text: #f3f4f6;
            --color-text-muted: #9ca3af;
            --color-border: #374151;
        }
        
        body {
            color-scheme: dark;
        }
    }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="logo">
            <button class="hamburger" id="hamburger">
                <i class="fas fa-bars"></i>
            </button>
            <i class="fas fa-shopping-cart"></i>
            <span>Gittertier Pro</span>
        </div>
        
        <div class="header-controls">
            <div class="time-display" id="timeDisplay"></div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Abmelden</span>
            </button>
        </div>
    </header>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="admin-container">
        <!-- Sidebar Navigation -->
        <aside class="admin-sidebar" id="sidebar">
            <div class="nav-container">
                <a href="control" class="nav-link">
                    <i class="fas fa-cogs"></i>
                    Steuerung
                    <span class="new-feature">NEU</span>
                </a>
                
                <a href="navi" class="nav-link">
                    <i class="fas fa-map-marked-alt"></i>
                    Navigation
                </a>
                
                <a href="admin" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                
                <a href="products" class="nav-link">
                    <i class="fas fa-box"></i>
                    Produktverwaltung
                </a>
                
                <a href="index" class="nav-link">
                    <i class="fas fa-cash-register"></i>
                    Kassenansicht
                </a>
                
                <a href="archive" class="nav-link">
                    <i class="fas fa-archive"></i>
                    Archiv
                </a>
                
                <a href="merchant" class="nav-link">
                    <i class="fas fa-store"></i>
                    Händleransicht
                </a>
                
                <a href="analytics" class="nav-link">
                    <i class="fas fa-chart-line"></i>
                    Analysen
                </a>
                
                <a href="settings" class="nav-link">
                    <i class="fas fa-cog"></i>
                    Einstellungen
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Dashboard</h1>
                <p class="dashboard-subtitle">Überblick über Ihr Geschäft und wichtige Kennzahlen</p>
            </div>

            <!-- Welcome Card -->
            <div class="welcome-card" id="welcome-card">
                <h1>Willkommen zurück!</h1>
                <p id="welcome-message">Heute ist ein großartiger Tag für Ihr Geschäft. Hier ist ein Überblick über Ihre aktuellen Leistungen.</p>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="quick-action-btn" onclick="showProductModal()">
                    <div class="quick-action-icon">
                        <i class="fas fa-plus"></i>
                    </div>
                    <span class="quick-action-text">Neues Produkt</span>
                </div>
                <div class="quick-action-btn" onclick="window.location.href='index'">
                    <div class="quick-action-icon">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <span class="quick-action-text">Kasse öffnen</span>
                </div>
                <div class="quick-action-btn" onclick="showGoalModal()">
                    <div class="quick-action-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <span class="quick-action-text">Ziel setzen</span>
                </div>
                <div class="quick-action-btn" onclick="showStaffModal()">
                    <div class="quick-action-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <span class="quick-action-text">Mitarbeiter</span>
                </div>
                <div class="quick-action-btn" onclick="showInventoryModal()">
                    <div class="quick-action-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <span class="quick-action-text">Inventar</span>
                </div>
                <div class="quick-action-btn" onclick="showSupplierModal()">
                    <div class="quick-action-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <span class="quick-action-text">Lieferanten</span>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid" id="stats-grid">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Lade Dashboard-Daten...</p>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">Umsatzentwicklung</h3>
                        <div class="chart-card-actions">
                            <button class="chart-action-btn" data-chart="revenue" data-type="line">
                                <i class="fas fa-chart-line"></i>
                            </button>
                            <button class="chart-action-btn active" data-chart="revenue" data-type="bar">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenue-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">Verkaufsverteilung</h3>
                        <div class="chart-card-actions">
                            <button class="chart-action-btn active" data-chart="sales" data-type="doughnut">
                                <i class="fas fa-chart-pie"></i>
                            </button>
                            <button class="chart-action-btn" data-chart="sales" data-type="pie">
                                <i class="fas fa-chart-pie"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="sales-distribution-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Goals Section -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-bullseye"></i>
                        Monatsziele
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="showGoalModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshGoals()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="goals-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Ziele...</p>
                    </div>
                </div>
            </div>

            <!-- Tables Section -->
            <div class="tables-section">
                <div class="table-card">
                    <div class="table-card-header">
                        <h3 class="table-card-title">Top-Produkte</h3>
                        <div class="table-card-actions">
                            <button class="card-action-btn" onclick="exportTopProducts()">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="card-action-btn" onclick="refreshTopProducts()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="dashboard-table" id="top-products-table">
                            <thead>
                                <tr>
                                    <th>Produkt</th>
                                    <th>Umsatz</th>
                                    <th>Verkäufe</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="empty-state">
                                        <i class="fas fa-box-open"></i>
                                        <p>Keine Daten verfügbar</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="table-card">
                    <div class="table-card-header">
                        <h3 class="table-card-title">Aktuelle Bestellungen</h3>
                        <div class="table-card-actions">
                            <button class="card-action-btn" onclick="refreshOrders()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="dashboard-table" id="orders-table">
                            <thead>
                                <tr>
                                    <th>Bestellnummer</th>
                                    <th>Kunde</th>
                                    <th>Betrag</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="empty-state">
                                        <i class="fas fa-shopping-cart"></i>
                                        <p>Keine Bestellungen verfügbar</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Inventory Alerts -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Inventarwarnungen
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="refreshInventoryAlerts()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="inventory-alerts-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Inventardaten...</p>
                    </div>
                </div>
            </div>

            <!-- Staff Performance -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-users"></i>
                        Mitarbeiterleistung
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="showStaffModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshStaffPerformance()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="staff-performance-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Mitarbeiterdaten...</p>
                    </div>
                </div>
            </div>

            <!-- Customer Insights -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Kundenstatistiken
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="refreshCustomerStats()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="customer-stats-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Kundendaten...</p>
                    </div>
                </div>
            </div>

            <!-- Financial Summary -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-euro-sign"></i>
                        Finanzübersicht
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="exportFinancialReport()">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshFinancialSummary()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="financial-summary-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Finanzdaten...</p>
                    </div>
                </div>
            </div>

            <!-- Marketing Campaigns -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-bullhorn"></i>
                        Marketingkampagnen
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="showCampaignModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshCampaigns()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="campaigns-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Kampagnen...</p>
                    </div>
                </div>
            </div>

            <!-- Loyalty Program -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-star"></i>
                        Treueprogramm
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="refreshLoyaltyStats()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="loyalty-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Treueprogramm-Daten...</p>
                    </div>
                </div>
            </div>

            <!-- Supplier Management -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-truck"></i>
                        Lieferantenmanagement
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="showSupplierModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshSuppliers()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="suppliers-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Lieferanten...</p>
                    </div>
                </div>
            </div>

            <!-- Store Performance -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-store"></i>
                        Filialleistung
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="refreshStorePerformance()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="store-performance-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Filialdaten...</p>
                    </div>
                </div>
            </div>

            <!-- Customer Feedback -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-comment-alt"></i>
                        Kundenfeedback
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="refreshFeedback()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="feedback-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Feedback...</p>
                    </div>
                </div>
            </div>

            <!-- Employee Scheduling -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-calendar-alt"></i>
                        Mitarbeiterplanung
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="showScheduleModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshSchedule()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="schedule-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Planung...</p>
                    </div>
                </div>
            </div>

            <!-- Maintenance Requests -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-tools"></i>
                        Wartungsanfragen
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="showMaintenanceModal()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="card-action-btn" onclick="refreshMaintenance()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="maintenance-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Wartungsanfragen...</p>
                    </div>
                </div>
            </div>

            <!-- Security and Access Logs -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-shield-alt"></i>
                        Sicherheitsprotokolle
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="refreshSecurityLogs()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="security-logs-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Lade Sicherheitsprotokolle...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div class="modal-overlay" id="modal-overlay"></div>
    
    <div id="product-modal" class="modal">
        <div class="modal-header">
            <h2 id="modal-title">Neues Produkt</h2>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-content">
            <input type="text" id="product-name" placeholder="Produktname" class="modal-input">
            <input type="number" step="0.01" id="product-price" placeholder="Preis (€)" class="modal-input">
            <input type="text" id="product-barcode" placeholder="Barcode" class="modal-input">
            <input type="number" id="product-stock" placeholder="Lagerbestand" class="modal-input">
            <input type="text" id="product-category" placeholder="Kategorie" class="modal-input">
            
            <div class="modal-buttons">
                <button class="btn-save" id="saveProductBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goal-modal" class="modal">
        <div class="modal-header">
            <h2>Monatsziel festlegen</h2>
            <button class="modal-close" id="goalModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="goal-type">Zieltyp</label>
                <select id="goal-type" class="form-control">
                    <option value="revenue">Umsatz</option>
                    <option value="sales">Verkäufe</option>
                    <option value="customers">Neue Kunden</option>
                    <option value="products">Produkte verkauft</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="goal-target">Zielwert</label>
                <input type="number" id="goal-target" class="form-control" placeholder="Zielwert">
            </div>
            <div class="form-group">
                <label class="form-label" for="goal-month">Monat</label>
                <input type="month" id="goal-month" class="form-control">
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveGoalBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelGoalBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Staff Modal -->
    <div id="staff-modal" class="modal">
        <div class="modal-header">
            <h2>Mitarbeiter hinzufügen</h2>
            <button class="modal-close" id="staffModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="staff-name">Name</label>
                <input type="text" id="staff-name" class="form-control" placeholder="Vollständiger Name">
            </div>
            <div class="form-group">
                <label class="form-label" for="staff-email">E-Mail</label>
                <input type="email" id="staff-email" class="form-control" placeholder="E-Mail Adresse">
            </div>
            <div class="form-group">
                <label class="form-label" for="staff-role">Rolle</label>
                <select id="staff-role" class="form-control">
                    <option value="cashier">Kassierer</option>
                    <option value="manager">Manager</option>
                    <option value="assistant">Verkaufsassistent</option>
                    <option value="stock">Lagerverwalter</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="staff-salary">Gehalt (€)</label>
                <input type="number" id="staff-salary" class="form-control" placeholder="Monatliches Gehalt">
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveStaffBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelStaffBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventory-modal" class="modal">
        <div class="modal-header">
            <h2>Inventaranpassung</h2>
            <button class="modal-close" id="inventoryModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="inventory-product">Produkt</label>
                <select id="inventory-product" class="form-control">
                    <!-- Products will be populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="inventory-adjustment">Anpassung</label>
                <input type="number" id="inventory-adjustment" class="form-control" placeholder="Menge (positiv für Zugang, negativ für Abgang)">
            </div>
            <div class="form-group">
                <label class="form-label" for="inventory-reason">Grund</label>
                <select id="inventory-reason" class="form-control">
                    <option value="sale">Verkauf</option>
                    <option value="restock">Nachbestellung</option>
                    <option value="damage">Beschädigung</option>
                    <option value="theft">Diebstahl</option>
                    <option value="other">Sonstiges</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveInventoryBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelInventoryBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplier-modal" class="modal">
        <div class="modal-header">
            <h2>Lieferant hinzufügen</h2>
            <button class="modal-close" id="supplierModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="supplier-name">Name</label>
                <input type="text" id="supplier-name" class="form-control" placeholder="Lieferantenname">
            </div>
            <div class="form-group">
                <label class="form-label" for="supplier-contact">Kontaktperson</label>
                <input type="text" id="supplier-contact" class="form-control" placeholder="Name der Kontaktperson">
            </div>
            <div class="form-group">
                <label class="form-label" for="supplier-email">E-Mail</label>
                <input type="email" id="supplier-email" class="form-control" placeholder="E-Mail Adresse">
            </div>
            <div class="form-group">
                <label class="form-label" for="supplier-phone">Telefon</label>
                <input type="tel" id="supplier-phone" class="form-control" placeholder="Telefonnummer">
            </div>
            <div class="form-group">
                <label class="form-label" for="supplier-products">Gelieferte Produkte</label>
                <input type="text" id="supplier-products" class="form-control" placeholder="Produkte (durch Komma getrennt)">
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveSupplierBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelSupplierBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Campaign Modal -->
    <div id="campaign-modal" class="modal">
        <div class="modal-header">
            <h2>Marketingkampagne erstellen</h2>
            <button class="modal-close" id="campaignModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="campaign-name">Kampagnenname</label>
                <input type="text" id="campaign-name" class="form-control" placeholder="Name der Kampagne">
            </div>
            <div class="form-group">
                <label class="form-label" for="campaign-type">Kampagnentyp</label>
                <select id="campaign-type" class="form-control">
                    <option value="email">E-Mail</option>
                    <option value="social">Social Media</option>
                    <option value="discount">Rabattaktion</option>
                    <option value="loyalty">Treueprogramm</option>
                    <option value="event">Veranstaltung</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="campaign-budget">Budget (€)</label>
                <input type="number" id="campaign-budget" class="form-control" placeholder="Budget in Euro">
            </div>
            <div class="form-group">
                <label class="form-label" for="campaign-start">Startdatum</label>
                <input type="date" id="campaign-start" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label" for="campaign-end">Enddatum</label>
                <input type="date" id="campaign-end" class="form-control">
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveCampaignBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelCampaignBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="schedule-modal" class="modal">
        <div class="modal-header">
            <h2>Schichtplan erstellen</h2>
            <button class="modal-close" id="scheduleModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="schedule-staff">Mitarbeiter</label>
                <select id="schedule-staff" class="form-control">
                    <!-- Staff will be populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="schedule-date">Datum</label>
                <input type="date" id="schedule-date" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label" for="schedule-start">Startzeit</label>
                <input type="time" id="schedule-start" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label" for="schedule-end">Endzeit</label>
                <input type="time" id="schedule-end" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label" for="schedule-role">Rolle während der Schicht</label>
                <select id="schedule-role" class="form-control">
                    <option value="cashier">Kassierer</option>
                    <option value="manager">Manager</option>
                    <option value="assistant">Verkaufsassistent</option>
                    <option value="stock">Lagerverwalter</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveScheduleBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelScheduleBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div id="maintenance-modal" class="modal">
        <div class="modal-header">
            <h2>Wartungsanfrage erstellen</h2>
            <button class="modal-close" id="maintenanceModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label" for="maintenance-equipment">Gerät/Equipment</label>
                <input type="text" id="maintenance-equipment" class="form-control" placeholder="Gerätename">
            </div>
            <div class="form-group">
                <label class="form-label" for="maintenance-issue">Problembeschreibung</label>
                <textarea id="maintenance-issue" class="form-control" placeholder="Beschreiben Sie das Problem" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" for="maintenance-priority">Priorität</label>
                <select id="maintenance-priority" class="form-control">
                    <option value="low">Niedrig</option>
                    <option value="medium">Mittel</option>
                    <option value="high">Hoch</option>
                    <option value="critical">Kritisch</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn-save" id="saveMaintenanceBtn">
                    <i class="fas fa-save"></i> Speichern
                </button>
                <button class="btn-cancel" id="cancelMaintenanceBtn">
                    <i class="fas fa-times"></i> Abbrechen
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Dashboard Manager
        const dashboardManager = (function() {
            let dashboardData = {
                stats: {},
                goals: [],
                products: [],
                orders: [],
                inventoryAlerts: [],
                staff: [],
                customerStats: {},
                financialSummary: {},
                campaigns: [],
                loyaltyStats: {},
                suppliers: [],
                storePerformance: {},
                feedback: [],
                schedule: [],
                maintenance: [],
                securityLogs: []
            };
            
            // Initialize dashboard data
            async function init() {
                await loadAllData();
                updateWelcomeMessage();
                return dashboardData;
            }
            
            // Load all dashboard data
            async function loadAllData() {
                await Promise.all([
                    loadStats(),
                    loadGoals(),
                    loadProducts(),
                    loadOrders(),
                    loadInventoryAlerts(),
                    loadStaff(),
                    loadCustomerStats(),
                    loadFinancialSummary(),
                    loadCampaigns(),
                    loadLoyaltyStats(),
                    loadSuppliers(),
                    loadStorePerformance(),
                    loadFeedback(),
                    loadSchedule(),
                    loadMaintenance(),
                    loadSecurityLogs()
                ]);
            }
            
            // Load statistics
            async function loadStats() {
                try {
                    const paymentArchive = JSON.parse(localStorage.getItem('payment_archive') || '[]');
                    const products = await storageManager.getProducts();
                    
                    // Calculate today's date
                    const today = new Date();
                    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59);
                    
                    // Filter today's payments
                    const todayPayments = paymentArchive.filter(payment => {
                        const paymentDate = new Date(payment.date);
                        return paymentDate >= todayStart && paymentDate <= todayEnd;
                    });
                    
                    // Calculate today's revenue
                    const todayRevenue = todayPayments.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    // Calculate this week's payments
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    weekStart.setHours(0, 0, 0, 0);
                    
                    const weekPayments = paymentArchive.filter(payment => {
                        const paymentDate = new Date(payment.date);
                        return paymentDate >= weekStart;
                    });
                    
                    const weekRevenue = weekPayments.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    // Calculate this month's payments
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    const monthPayments = paymentArchive.filter(payment => {
                        const paymentDate = new Date(payment.date);
                        return paymentDate >= monthStart;
                    });
                    
                    const monthRevenue = monthPayments.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    // Calculate average order value
                    const totalRevenue = paymentArchive.reduce((sum, payment) => sum + payment.amount, 0);
                    const avgOrderValue = paymentArchive.length > 0 ? totalRevenue / paymentArchive.length : 0;
                    
                    // Calculate unique customers
                    const uniqueCustomers = [...new Set(paymentArchive.map(payment => payment.customer).filter(Boolean))].length;
                    
                    // Calculate low stock products
                    const lowStockProducts = Object.values(products).filter(product => 
                        product.stock !== undefined && product.stock < 10
                    ).length;
                    
                    dashboardData.stats = {
                        todayRevenue,
                        weekRevenue,
                        monthRevenue,
                        totalTransactions: paymentArchive.length,
                        avgOrderValue,
                        uniqueCustomers,
                        lowStockProducts,
                        totalProducts: Object.keys(products).length
                    };
                    
                    return dashboardData.stats;
                } catch (error) {
                    console.error('Failed to load stats:', error);
                    return {};
                }
            }
            
            // Load goals
            async function loadGoals() {
                try {
                    const goals = JSON.parse(localStorage.getItem('dashboard_goals') || '[]');
                    dashboardData.goals = goals;
                    return goals;
                } catch (error) {
                    console.error('Failed to load goals:', error);
                    return [];
                }
            }
            
            // Save a new goal
            async function saveGoal(goal) {
                try {
                    const goals = await loadGoals();
                    goal.id = 'goal-' + Date.now();
                    goal.createdAt = new Date().toISOString();
                    goal.progress = 0;
                    
                    goals.push(goal);
                    localStorage.setItem('dashboard_goals', JSON.stringify(goals));
                    
                    dashboardData.goals = goals;
                    return goal;
                } catch (error) {
                    console.error('Failed to save goal:', error);
                    throw error;
                }
            }
            
            // Update goal progress
            async function updateGoalProgress(goalId, progress) {
                try {
                    const goals = await loadGoals();
                    const goalIndex = goals.findIndex(g => g.id === goalId);
                    
                    if (goalIndex !== -1) {
                        goals[goalIndex].progress = progress;
                        goals[goalIndex].updatedAt = new Date().toISOString();
                        localStorage.setItem('dashboard_goals', JSON.stringify(goals));
                        dashboardData.goals = goals;
                        return true;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('Failed to update goal progress:', error);
                    return false;
                }
            }
            
            // Load products
            async function loadProducts() {
                try {
                    const products = await storageManager.getProducts();
                    dashboardData.products = Object.values(products);
                    return dashboardData.products;
                } catch (error) {
                    console.error('Failed to load products:', error);
                    return [];
                }
            }
            
            // Load orders
            async function loadOrders() {
                try {
                    const paymentArchive = JSON.parse(localStorage.getItem('payment_archive') || '[]');
                    // Get recent orders (last 10)
                    const recentOrders = paymentArchive
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 10);
                    
                    dashboardData.orders = recentOrders;
                    return recentOrders;
                } catch (error) {
                    console.error('Failed to load orders:', error);
                    return [];
                }
            }
            
            // Load inventory alerts
            async function loadInventoryAlerts() {
                try {
                    const products = await storageManager.getProducts();
                    const lowStockProducts = Object.values(products).filter(product => 
                        product.stock !== undefined && product.stock < 10
                    );
                    
                    const outOfStockProducts = Object.values(products).filter(product => 
                        product.stock !== undefined && product.stock <= 0
                    );
                    
                    dashboardData.inventoryAlerts = {
                        lowStock: lowStockProducts,
                        outOfStock: outOfStockProducts
                    };
                    
                    return dashboardData.inventoryAlerts;
                } catch (error) {
                    console.error('Failed to load inventory alerts:', error);
                    return { lowStock: [], outOfStock: [] };
                }
            }
            
            // Load staff
            async function loadStaff() {
                try {
                    const staff = JSON.parse(localStorage.getItem('dashboard_staff') || '[]');
                    
                    // If no staff data exists, create sample data
                    if (staff.length === 0) {
                        const sampleStaff = [
                            {
                                id: 'staff-1',
                                name: 'Anna Schmidt',
                                email: 'anna.schmidt@example.com',
                                role: 'manager',
                                salary: 3200,
                                hireDate: '2023-01-15',
                                performance: 95
                            },
                            {
                                id: 'staff-2',
                                name: 'Thomas Weber',
                                email: 'thomas.weber@example.com',
                                role: 'cashier',
                                salary: 2450,
                                hireDate: '2023-03-22',
                                performance: 88
                            },
                            {
                                id: 'staff-3',
                                name: 'Maria Fischer',
                                email: 'maria.fischer@example.com',
                                role: 'assistant',
                                salary: 2300,
                                hireDate: '2023-06-10',
                                performance: 92
                            }
                        ];
                        
                        localStorage.setItem('dashboard_staff', JSON.stringify(sampleStaff));
                        dashboardData.staff = sampleStaff;
                    } else {
                        dashboardData.staff = staff;
                    }
                    
                    return dashboardData.staff;
                } catch (error) {
                    console.error('Failed to load staff:', error);
                    return [];
                }
            }
            
            // Save a new staff member
            async function saveStaff(staff) {
                try {
                    const staffList = await loadStaff();
                    staff.id = 'staff-' + Date.now();
                    staff.hireDate = new Date().toISOString().split('T')[0];
                    staff.performance = 85; // Default performance
                    
                    staffList.push(staff);
                    localStorage.setItem('dashboard_staff', JSON.stringify(staffList));
                    
                    dashboardData.staff = staffList;
                    return staff;
                } catch (error) {
                    console.error('Failed to save staff:', error);
                    throw error;
                }
            }
            
            // Load customer statistics
            async function loadCustomerStats() {
                try {
                    const paymentArchive = JSON.parse(localStorage.getItem('payment_archive') || '[]');
                    
                    // Calculate customer statistics
                    const customers = [...new Set(paymentArchive.map(payment => payment.customer).filter(Boolean))];
                    const totalCustomers = customers.length;
                    
                    // Calculate new customers this month
                    const monthStart = new Date();
                    monthStart.setDate(1);
                    monthStart.setHours(0, 0, 0, 0);
                    
                    const newCustomers = paymentArchive
                        .filter(payment => {
                            const paymentDate = new Date(payment.date);
                            return paymentDate >= monthStart && payment.customer;
                        })
                        .reduce((unique, payment) => {
                            if (!unique.includes(payment.customer)) {
                                unique.push(payment.customer);
                            }
                            return unique;
                        }, []).length;
                    
                    // Calculate returning customers
                    const returningCustomers = paymentArchive
                        .filter(payment => payment.customer)
                        .reduce((counts, payment) => {
                            counts[payment.customer] = (counts[payment.customer] || 0) + 1;
                            return counts;
                        }, {});
                    
                    const multiplePurchaseCustomers = Object.values(returningCustomers).filter(count => count > 1).length;
                    
                    dashboardData.customerStats = {
                        totalCustomers,
                        newCustomers,
                        returningCustomers: multiplePurchaseCustomers,
                        customerGrowth: totalCustomers > 0 ? ((newCustomers / totalCustomers) * 100).toFixed(1) : 0
                    };
                    
                    return dashboardData.customerStats;
                } catch (error) {
                    console.error('Failed to load customer stats:', error);
                    return {};
                }
            }
            
            // Load financial summary
            async function loadFinancialSummary() {
                try {
                    const paymentArchive = JSON.parse(localStorage.getItem('payment_archive') || '[]');
                    const expenses = JSON.parse(localStorage.getItem('dashboard_expenses') || '[]');
                    
                    // Calculate revenue
                    const totalRevenue = paymentArchive.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    // Calculate expenses
                    const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
                    
                    // Calculate profit
                    const profit = totalRevenue - totalExpenses;
                    
                    // Calculate profit margin
                    const profitMargin = totalRevenue > 0 ? (profit / totalRevenue) * 100 : 0;
                    
                    dashboardData.financialSummary = {
                        totalRevenue,
                        totalExpenses,
                        profit,
                        profitMargin: profitMargin.toFixed(2)
                    };
                    
                    return dashboardData.financialSummary;
                } catch (error) {
                    console.error('Failed to load financial summary:', error);
                    return {};
                }
            }
            
            // Load campaigns
            async function loadCampaigns() {
                try {
                    const campaigns = JSON.parse(localStorage.getItem('dashboard_campaigns') || '[]');
                    
                    // If no campaigns exist, create sample data
                    if (campaigns.length === 0) {
                        const sampleCampaigns = [
                            {
                                id: 'campaign-1',
                                name: 'Frühlingsaktion',
                                type: 'discount',
                                budget: 500,
                                startDate: '2023-03-01',
                                endDate: '2023-03-31',
                                status: 'completed',
                                results: {
                                    revenue: 12500,
                                    newCustomers: 45,
                                    roi: 2400
                                }
                            },
                            {
                                id: 'campaign-2',
                                name: 'Sommerrabatt',
                                type: 'discount',
                                budget: 750,
                                startDate: '2023-06-01',
                                endDate: '2023-08-31',
                                status: 'active',
                                results: {
                                    revenue: 8500,
                                    newCustomers: 32,
                                    roi: 1133
                                }
                            },
                            {
                                id: 'campaign-3',
                                name: 'Newsletter Herbst',
                                type: 'email',
                                budget: 200,
                                startDate: '2023-09-15',
                                endDate: '2023-10-15',
                                status: 'planned',
                                results: {
                                    revenue: 0,
                                    newCustomers: 0,
                                    roi: 0
                                }
                            }
                        ];
                        
                        localStorage.setItem('dashboard_campaigns', JSON.stringify(sampleCampaigns));
                        dashboardData.campaigns = sampleCampaigns;
                    } else {
                        dashboardData.campaigns = campaigns;
                    }
                    
                    return dashboardData.campaigns;
                } catch (error) {
                    console.error('Failed to load campaigns:', error);
                    return [];
                }
            }
            
            // Save a new campaign
            async function saveCampaign(campaign) {
                try {
                    const campaigns = await loadCampaigns();
                    campaign.id = 'campaign-' + Date.now();
                    campaign.status = 'planned';
                    campaign.results = {
                        revenue: 0,
                        newCustomers: 0,
                        roi: 0
                    };
                    
                    campaigns.push(campaign);
                    localStorage.setItem('dashboard_campaigns', JSON.stringify(campaigns));
                    
                    dashboardData.campaigns = campaigns;
                    return campaign;
                } catch (error) {
                    console.error('Failed to save campaign:', error);
                    throw error;
                }
            }
            
            // Load loyalty statistics
            async function loadLoyaltyStats() {
                try {
                    const loyaltyData = JSON.parse(localStorage.getItem('dashboard_loyalty') || '{}');
                    
                    // If no loyalty data exists, create sample data
                    if (Object.keys(loyaltyData).length === 0) {
                        const sampleLoyaltyData = {
                            totalMembers: 187,
                            activeMembers: 142,
                            pointsIssued: 12560,
                            pointsRedeemed: 8430,
                            averagePoints: 67.2,
                            redemptionRate: 67.1
                        };
                        
                        localStorage.setItem('dashboard_loyalty', JSON.stringify(sampleLoyaltyData));
                        dashboardData.loyaltyStats = sampleLoyaltyData;
                    } else {
                        dashboardData.loyaltyStats = loyaltyData;
                    }
                    
                    return dashboardData.loyaltyStats;
                } catch (error) {
                    console.error('Failed to load loyalty stats:', error);
                    return {};
                }
            }
            
            // Load suppliers
            async function loadSuppliers() {
                try {
                    const suppliers = JSON.parse(localStorage.getItem('dashboard_suppliers') || '[]');
                    
                    // If no suppliers exist, create sample data
                    if (suppliers.length === 0) {
                        const sampleSuppliers = [
                            {
                                id: 'supplier-1',
                                name: 'Frischemarkt GmbH',
                                contact: 'Herr Müller',
                                email: 'mueller@frischemarkt.de',
                                phone: '+49 30 12345678',
                                products: 'Obst, Gemüse, Molkerei',
                                rating: 4.5,
                                lastOrder: '2023-08-15'
                            },
                            {
                                id: 'supplier-2',
                                name: 'Metztgerei Schmidt',
                                contact: 'Frau Weber',
                                email: 'weber@metzgerei-schmidt.de',
                                phone: '+49 30 87654321',
                                products: 'Fleisch, Wurst',
                                rating: 4.2,
                                lastOrder: '2023-08-18'
                            },
                            {
                                id: 'supplier-3',
                                name: 'Getränke Hoffmann',
                                contact: 'Herr Hoffmann',
                                email: 'info@getraenke-hoffmann.de',
                                phone: '+49 30 55555555',
                                products: 'Getränke, Wasser, Säfte',
                                rating: 4.7,
                                lastOrder: '2023-08-10'
                            }
                        ];
                        
                        localStorage.setItem('dashboard_suppliers', JSON.stringify(sampleSuppliers));
                        dashboardData.suppliers = sampleSuppliers;
                    } else {
                        dashboardData.suppliers = suppliers;
                    }
                    
                    return dashboardData.suppliers;
                } catch (error) {
                    console.error('Failed to load suppliers:', error);
                    return [];
                }
            }
            
            // Save a new supplier
            async function saveSupplier(supplier) {
                try {
                    const suppliers = await loadSuppliers();
                    supplier.id = 'supplier-' + Date.now();
                    supplier.rating = 4.0; // Default rating
                    supplier.lastOrder = new Date().toISOString().split('T')[0];
                    
                    suppliers.push(supplier);
                    localStorage.setItem('dashboard_suppliers', JSON.stringify(suppliers));
                    
                    dashboardData.suppliers = suppliers;
                    return supplier;
                } catch (error) {
                    console.error('Failed to save supplier:', error);
                    throw error;
                }
            }
            
            // Load store performance
            async function loadStorePerformance() {
                try {
                    const paymentArchive = JSON.parse(localStorage.getItem('payment_archive') || '[]');
                    
                    // Calculate store performance metrics
                    const today = new Date();
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    weekStart.setHours(0, 0, 0, 0);
                    
                    const weekPayments = paymentArchive.filter(payment => {
                        const paymentDate = new Date(payment.date);
                        return paymentDate >= weekStart;
                    });
                    
                    const weekRevenue = weekPayments.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    // Calculate last week for comparison
                    const lastWeekStart = new Date(weekStart);
                    lastWeekStart.setDate(lastWeekStart.getDate() - 7);
                    const lastWeekEnd = new Date(weekStart);
                    lastWeekEnd.setDate(lastWeekEnd.getDate() - 1);
                    
                    const lastWeekPayments = paymentArchive.filter(payment => {
                        const paymentDate = new Date(payment.date);
                        return paymentDate >= lastWeekStart && paymentDate <= lastWeekEnd;
                    });
                    
                    const lastWeekRevenue = lastWeekPayments.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    // Calculate week-over-week growth
                    const wowGrowth = lastWeekRevenue > 0 ? 
                        ((weekRevenue - lastWeekRevenue) / lastWeekRevenue) * 100 : 0;
                    
                    // Calculate busiest day
                    const dayRevenue = {};
                    weekPayments.forEach(payment => {
                        const day = new Date(payment.date).toLocaleDateString('de-DE', { weekday: 'long' });
                        dayRevenue[day] = (dayRevenue[day] || 0) + payment.amount;
                    });
                    
                    let busiestDay = '';
                    let maxRevenue = 0;
                    
                    for (const day in dayRevenue) {
                        if (dayRevenue[day] > maxRevenue) {
                            maxRevenue = dayRevenue[day];
                            busiestDay = day;
                        }
                    }
                    
                    dashboardData.storePerformance = {
                        weekRevenue,
                        lastWeekRevenue,
                        wowGrowth: wowGrowth.toFixed(1),
                        busiestDay,
                        transactions: weekPayments.length,
                        avgTransactionValue: weekPayments.length > 0 ? weekRevenue / weekPayments.length : 0
                    };
                    
                    return dashboardData.storePerformance;
                } catch (error) {
                    console.error('Failed to load store performance:', error);
                    return {};
                }
            }
            
            // Load customer feedback
            async function loadFeedback() {
                try {
                    const feedback = JSON.parse(localStorage.getItem('dashboard_feedback') || '[]');
                    
                    // If no feedback exists, create sample data
                    if (feedback.length === 0) {
                        const sampleFeedback = [
                            {
                                id: 'feedback-1',
                                customer: 'Michaela Schulz',
                                rating: 5,
                                comment: 'Ausgezeichneter Service! Das Personal war sehr freundlich und hilfsbereit.',
                                date: '2023-08-20',
                                response: 'Vielen Dank für Ihr Feedback! Wir freuen uns, dass Sie zufrieden waren.'
                            },
                            {
                                id: 'feedback-2',
                                customer: 'Robert Klein',
                                rating: 4,
                                comment: 'Gute Produktauswahl, aber die Wartezeit an der Kasse war etwas lang.',
                                date: '2023-08-18',
                                response: ''
                            },
                            {
                                id: 'feedback-3',
                                customer: 'Sabine Wagner',
                                rating: 3,
                                comment: 'Einige Produkte waren nicht vorrätig. Bitte Lagerbestand überprüfen.',
                                date: '2023-08-15',
                                response: 'Vielen Dank für den Hinweis. Wir arbeiten daran, unsere Lagerbestände zu optimieren.'
                            }
                        ];
                        
                        localStorage.setItem('dashboard_feedback', JSON.stringify(sampleFeedback));
                        dashboardData.feedback = sampleFeedback;
                    } else {
                        dashboardData.feedback = feedback;
                    }
                    
                    return dashboardData.feedback;
                } catch (error) {
                    console.error('Failed to load feedback:', error);
                    return [];
                }
            }
            
            // Load employee schedule
            async function loadSchedule() {
                try {
                    const schedule = JSON.parse(localStorage.getItem('dashboard_schedule') || '[]');
                    
                    // If no schedule exists, create sample data
                    if (schedule.length === 0) {
                        const sampleSchedule = [
                            {
                                id: 'schedule-1',
                                staffId: 'staff-1',
                                staffName: 'Anna Schmidt',
                                date: '2023-08-21',
                                startTime: '08:00',
                                endTime: '16:00',
                                role: 'manager'
                            },
                            {
                                id: 'schedule-2',
                                staffId: 'staff-2',
                                staffName: 'Thomas Weber',
                                date: '2023-08-21',
                                startTime: '10:00',
                                endTime: '18:00',
                                role: 'cashier'
                            },
                            {
                                id: 'schedule-3',
                                staffId: 'staff-3',
                                staffName: 'Maria Fischer',
                                date: '2023-08-21',
                                startTime: '12:00',
                                endTime: '20:00',
                                role: 'assistant'
                            }
                        ];
                        
                        localStorage.setItem('dashboard_schedule', JSON.stringify(sampleSchedule));
                        dashboardData.schedule = sampleSchedule;
                    } else {
                        dashboardData.schedule = schedule;
                    }
                    
                    return dashboardData.schedule;
                } catch (error) {
                    console.error('Failed to load schedule:', error);
                    return [];
                }
            }
            
            // Save a new schedule entry
            async function saveSchedule(schedule) {
                try {
                    const scheduleList = await loadSchedule();
                    schedule.id = 'schedule-' + Date.now();
                    
                    scheduleList.push(schedule);
                    localStorage.setItem('dashboard_schedule', JSON.stringify(scheduleList));
                    
                    dashboardData.schedule = scheduleList;
                    return schedule;
                } catch (error) {
                    console.error('Failed to save schedule:', error);
                    throw error;
                }
            }
            
            // Load maintenance requests
            async function loadMaintenance() {
                try {
                    const maintenance = JSON.parse(localStorage.getItem('dashboard_maintenance') || '[]');
                    
                    // If no maintenance requests exist, create sample data
                    if (maintenance.length === 0) {
                        const sampleMaintenance = [
                            {
                                id: 'maintenance-1',
                                equipment: 'Kassen-Scanner',
                                issue: 'Scanner erkennt Barcodes nicht zuverlässig',
                                priority: 'high',
                                status: 'in-progress',
                                reportedDate: '2023-08-18',
                                assignedTo: 'Technik Team'
                            },
                            {
                                id: 'maintenance-2',
                                equipment: 'Kühlregal 3',
                                issue: 'Temperatur schwankt, möglicher Defekt am Thermostat',
                                priority: 'medium',
                                status: 'pending',
                                reportedDate: '2023-08-20',
                                assignedTo: ''
                            }
                        ];
                        
                        localStorage.setItem('dashboard_maintenance', JSON.stringify(sampleMaintenance));
                        dashboardData.maintenance = sampleMaintenance;
                    } else {
                        dashboardData.maintenance = maintenance;
                    }
                    
                    return dashboardData.maintenance;
                } catch (error) {
                    console.error('Failed to load maintenance:', error);
                    return [];
                }
            }
            
            // Save a new maintenance request
            async function saveMaintenance(maintenance) {
                try {
                    const maintenanceList = await loadMaintenance();
                    maintenance.id = 'maintenance-' + Date.now();
                    maintenance.status = 'pending';
                    maintenance.reportedDate = new Date().toISOString().split('T')[0];
                    maintenance.assignedTo = '';
                    
                    maintenanceList.push(maintenance);
                    localStorage.setItem('dashboard_maintenance', JSON.stringify(maintenanceList));
                    
                    dashboardData.maintenance = maintenanceList;
                    return maintenance;
                } catch (error) {
                    console.error('Failed to save maintenance:', error);
                    throw error;
                }
            }
            
            // Load security logs
            async function loadSecurityLogs() {
                try {
                    const securityLogs = JSON.parse(localStorage.getItem('dashboard_security_logs') || '[]');
                    
                    // If no security logs exist, create sample data
                    if (securityLogs.length === 0) {
                        const sampleSecurityLogs = [
                            {
                                id: 'log-1',
                                timestamp: '2023-08-20 08:15:23',
                                user: 'Anna Schmidt',
                                action: 'Login',
                                status: 'success',
                                ip: '192.168.1.105'
                            },
                            {
                                id: 'log-2',
                                timestamp: '2023-08-20 10:32:45',
                                user: 'Thomas Weber',
                                action: 'Produktpreis geändert',
                                status: 'success',
                                ip: '192.168.1.112'
                            },
                            {
                                id: 'log-3',
                                timestamp: '2023-08-19 14:20:11',
                                user: 'Unbekannt',
                                action: 'Login',
                                status: 'failed',
                                ip: '192.168.1.250'
                            }
                        ];
                        
                        localStorage.setItem('dashboard_security_logs', JSON.stringify(sampleSecurityLogs));
                        dashboardData.securityLogs = sampleSecurityLogs;
                    } else {
                        dashboardData.securityLogs = securityLogs;
                    }
                    
                    return dashboardData.securityLogs;
                } catch (error) {
                    console.error('Failed to load security logs:', error);
                    return [];
                }
            }
            
            // Update welcome message based on time of day
            function updateWelcomeMessage() {
                const welcomeMessage = document.getElementById('welcome-message');
                const hour = new Date().getHours();
                
                let message = '';
                
                if (hour < 12) {
                    message = 'Guten Morgen! Ein perfekter Start in den Tag für Ihr Geschäft.';
                } else if (hour < 18) {
                    message = 'Guten Tag! Halten Sie den Schwung für Ihr Geschäft aufrecht.';
                } else {
                    message = 'Guten Abend! Zeit, die Leistung des Tages zu überprüfen.';
                }
                
                if (welcomeMessage) {
                    welcomeMessage.textContent = message;
                }
            }
            
            // Public API
            return {
                init,
                loadAllData,
                loadStats,
                loadGoals,
                saveGoal,
                updateGoalProgress,
                loadProducts,
                loadOrders,
                loadInventoryAlerts,
                loadStaff,
                saveStaff,
                loadCustomerStats,
                loadFinancialSummary,
                loadCampaigns,
                saveCampaign,
                loadLoyaltyStats,
                loadSuppliers,
                saveSupplier,
                loadStorePerformance,
                loadFeedback,
                loadSchedule,
                saveSchedule,
                loadMaintenance,
                saveMaintenance,
                loadSecurityLogs,
                getData: () => dashboardData
            };
        })();

        // Storage Manager Integration
        const storageManager = {
            getProducts: function() {
                const products = {};
                
                // Get all product keys
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    
                    if (key.startsWith('product_')) {
                        try {
                            const item = localStorage.getItem(key);
                            const parsed = JSON.parse(item);
                            
                            // Check if it's compressed
                            if (parsed && parsed.data && typeof parsed.data === 'string') {
                                try {
                                    const decompressed = LZString.decompressFromBase64(parsed.data);
                                    if (decompressed) {
                                        products[parsed.barcode] = JSON.parse(decompressed);
                                    }
                                } catch (e) {
                                    console.error('Failed to decompress product data', e);
                                }
                            } else if (parsed) {
                                products[parsed.barcode] = parsed;
                            }
                        } catch (e) {
                            // Not JSON, skip
                        }
                    }
                }
                
                return products;
            },
            
            saveProduct: function(product) {
                try {
                    // Create a wrapper with version and timestamp
                    const wrappedProduct = {
                        version: 1,
                        lastModified: new Date().toISOString(),
                        ...product
                    };
                    
                    // Compress the data
                    const compressed = LZString.compressToBase64(JSON.stringify(wrappedProduct));
                    
                    // Store in localStorage
                    localStorage.setItem(`product_${product.barcode}`, compressed);
                    
                    return true;
                } catch (error) {
                    console.error('Failed to save product:', error);
                    return false;
                }
            },
            
            getPaymentArchive: function() {
                try {
                    const archive = localStorage.getItem('payment_archive');
                    return archive ? JSON.parse(archive) : [];
                } catch (error) {
                    console.error('Failed to get payment archive:', error);
                    return [];
                }
            }
        };

        // UI Manager
        const uiManager = (function() {
            let revenueChart = null;
            let salesDistributionChart = null;
            
            // Initialize UI
            async function init() {
                await dashboardManager.init();
                renderStats();
                renderGoals();
                renderTopProducts();
                renderOrders();
                renderInventoryAlerts();
                renderStaffPerformance();
                renderCustomerStats();
                renderFinancialSummary();
                renderCampaigns();
                renderLoyaltyStats();
                renderSuppliers();
                renderStorePerformance();
                renderFeedback();
                renderSchedule();
                renderMaintenance();
                renderSecurityLogs();
                initCharts();
            }
            
            // Render statistics
            function renderStats() {
                const stats = dashboardManager.getData().stats;
                const statsGrid = document.getElementById('stats-grid');
                
                if (!statsGrid) return;
                
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Heutiger Umsatz</div>
                            <div class="stat-card-icon revenue">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                        </div>
                        <div class="stat-card-value">€${stats.todayRevenue?.toFixed(2) || '0.00'}</div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            ${stats.todayRevenue > 0 ? 'Aktiv' : 'Keine Verkäufe'}
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Wochenumsatz</div>
                            <div class="stat-card-icon sales">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="stat-card-value">€${stats.weekRevenue?.toFixed(2) || '0.00'}</div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            ${stats.weekRevenue > 0 ? 'Aktiv' : 'Keine Verkäufe'}
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Monatsumsatz</div>
                            <div class="stat-card-icon revenue">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="stat-card-value">€${stats.monthRevenue?.toFixed(2) || '0.00'}</div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            ${stats.monthRevenue > 0 ? 'Aktiv' : 'Keine Verkäufe'}
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Durchschn. Bestellwert</div>
                            <div class="stat-card-icon avg-order">
                                <i class="fas fa-receipt"></i>
                            </div>
                        </div>
                        <div class="stat-card-value">€${stats.avgOrderValue?.toFixed(2) || '0.00'}</div>
                        <div class="stat-card-change">
                            <i class="fas fa-minus"></i>
                            -
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Kunden</div>
                            <div class="stat-card-icon customers">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-card-value">${stats.uniqueCustomers || '0'}</div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            ${stats.uniqueCustomers > 0 ? 'Aktiv' : 'Keine Kunden'}
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Niedrige Lagerbestände</div>
                            <div class="stat-card-icon avg-order">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="stat-card-value">${stats.lowStockProducts || '0'}</div>
                        <div class="stat-card-change ${stats.lowStockProducts > 0 ? 'negative' : 'positive'}">
                            <i class="fas fa-${stats.lowStockProducts > 0 ? 'exclamation-triangle' : 'check'}"></i>
                            ${stats.lowStockProducts > 0 ? 'Achtung' : 'OK'}
                        </div>
                    </div>
                `;
            }
            
            // Render goals
            function renderGoals() {
                const goals = dashboardManager.getData().goals;
                const container = document.getElementById('goals-container');
                
                if (!container) return;
                
                if (goals.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bullseye"></i>
                            <h3>Keine Ziele festgelegt</h3>
                            <p>Legen Sie Ihre ersten Monatsziele fest, um Ihre Leistung zu verfolgen.</p>
                            <button class="btn-save" onclick="showGoalModal()" style="margin-top: var(--spacing-md);">
                                <i class="fas fa-plus"></i> Erstes Ziel festlegen
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let goalsHTML = '';
                
                goals.forEach(goal => {
                    const progressPercent = Math.min(100, Math.max(0, goal.progress || 0));
                    
                    goalsHTML += `
                        <div class="goal-item" style="margin-bottom: var(--spacing-lg);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${getGoalTypeName(goal.type)}</strong>
                                    <span style="color: var(--color-text-muted); font-size: var(--text-sm); margin-left: var(--spacing-sm);">
                                        ${goal.month || 'Aktueller Monat'}
                                    </span>
                                </div>
                                <div>
                                    <span style="font-weight: 600;">${goal.progress || 0}%</span>
                                    <span style="color: var(--color-text-muted); font-size: var(--text-sm); margin-left: var(--spacing-sm);">
                                        von ${goal.target}
                                    </span>
                                </div>
                            </div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar">
                                    <div class="goal-progress-fill" style="width: ${progressPercent}%;"></div>
                                </div>
                                <div class="goal-progress-text">${progressPercent}%</div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = goalsHTML;
            }
            
            // Get goal type name for display
            function getGoalTypeName(type) {
                switch(type) {
                    case 'revenue': return 'Umsatz';
                    case 'sales': return 'Verkäufe';
                    case 'customers': return 'Neue Kunden';
                    case 'products': return 'Produkte verkauft';
                    default: return type;
                }
            }
            
            // Render top products
            function renderTopProducts() {
                const products = dashboardManager.getData().products;
                const tableBody = document.querySelector('#top-products-table tbody');
                
                if (!tableBody) return;
                
                // Sort products by revenue (simulated)
                const topProducts = products
                    .sort((a, b) => {
                        // Simulate revenue based on price and random sales
                        const revenueA = a.price * (Math.floor(Math.random() * 100) + 10);
                        const revenueB = b.price * (Math.floor(Math.random() * 100) + 10);
                        return revenueB - revenueA;
                    })
                    .slice(0, 5);
                
                if (topProducts.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <p>Keine Produkte verfügbar</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let tableHTML = '';
                
                topProducts.forEach((product, index) => {
                    // Simulate sales data
                    const sales = Math.floor(Math.random() * 100) + 10;
                    const revenue = product.price * sales;
                    const stockStatus = product.stock > 10 ? 'Vorräte' : 
                                       product.stock > 0 ? 'Wenig' : 'Ausverkauft';
                    
                    const statusClass = product.stock > 10 ? 'badge-success' : 
                                      product.stock > 0 ? 'badge-warning' : 'badge-error';
                    
                    tableHTML += `
                        <tr>
                            <td>${product.name}</td>
                            <td>€${revenue.toFixed(2)}</td>
                            <td>${sales}</td>
                            <td><span class="badge ${statusClass}">${stockStatus}</span></td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = tableHTML;
            }
            
            // Render orders
            function renderOrders() {
                const orders = dashboardManager.getData().orders;
                const tableBody = document.querySelector('#orders-table tbody');
                
                if (!tableBody) return;
                
                if (orders.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Keine Bestellungen verfügbar</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let tableHTML = '';
                
                orders.forEach(order => {
                    const orderId = order.id || 'ORD-' + Math.random().toString(36).substr(2, 8).toUpperCase();
                    const customer = order.customer || 'Unbekannt';
                    const amount = order.amount || 0;
                    const status = order.status || 'Abgeschlossen';
                    
                    const statusClass = status === 'Abgeschlossen' ? 'badge-success' : 
                                      status === 'In Bearbeitung' ? 'badge-warning' : 'badge-info';
                    
                    tableHTML += `
                        <tr>
                            <td>${orderId}</td>
                            <td>${customer}</td>
                            <td>€${amount.toFixed(2)}</td>
                            <td><span class="badge ${statusClass}">${status}</span></td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = tableHTML;
            }
            
            // Render inventory alerts
            function renderInventoryAlerts() {
                const inventoryAlerts = dashboardManager.getData().inventoryAlerts;
                const container = document.getElementById('inventory-alerts-container');
                
                if (!container) return;
                
                const { lowStock, outOfStock } = inventoryAlerts;
                
                if (lowStock.length === 0 && outOfStock.length === 0) {
                    container.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <strong>Alles im grünen Bereich</strong>
                                <p>Alle Produkte haben ausreichend Lagerbestand.</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                let alertsHTML = '';
                
                if (outOfStock.length > 0) {
                    alertsHTML += `
                        <div class="alert alert-error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>${outOfStock.length} Produkte ausverkauft</strong>
                                <p>Diese Produkte müssen dringend nachbestellt werden.</p>
                            </div>
                        </div>
                    `;
                    
                    outOfStock.forEach(product => {
                        alertsHTML += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm); background: rgba(220, 38, 38, 0.05); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${product.name}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Barcode: ${product.barcode}</div>
                                </div>
                                <span class="badge badge-error">Ausverkauft</span>
                            </div>
                        `;
                    });
                }
                
                if (lowStock.length > 0) {
                    alertsHTML += `
                        <div class="alert alert-warning" style="margin-top: var(--spacing-md);">
                            <i class="fas fa-exclamation-circle"></i>
                            <div>
                                <strong>${lowStock.length} Produkte mit niedrigem Lagerbestand</strong>
                                <p>Diese Produkte sollten bald nachbestellt werden.</p>
                            </div>
                        </div>
                    `;
                    
                    lowStock.forEach(product => {
                        alertsHTML += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm); background: rgba(217, 119, 6, 0.05); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${product.name}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        Barcode: ${product.barcode} | Lager: ${product.stock}
                                    </div>
                                </div>
                                <span class="badge badge-warning">Niedrig</span>
                            </div>
                        `;
                    });
                }
                
                container.innerHTML = alertsHTML;
            }
            
            // Render staff performance
            function renderStaffPerformance() {
                const staff = dashboardManager.getData().staff;
                const container = document.getElementById('staff-performance-container');
                
                if (!container) return;
                
                if (staff.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>Keine Mitarbeiterdaten</h3>
                            <p>Fügen Sie Mitarbeiter hinzu, um deren Leistung zu verfolgen.</p>
                        </div>
                    `;
                    return;
                }
                
                let staffHTML = '';
                
                staff.forEach(employee => {
                    const performance = employee.performance || 0;
                    const performanceClass = performance >= 90 ? 'badge-success' : 
                                           performance >= 80 ? 'badge-warning' : 'badge-error';
                    
                    staffHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div>
                                <strong>${employee.name}</strong>
                                <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                    ${getRoleName(employee.role)} | Gehalt: €${employee.salary?.toFixed(2) || '0.00'}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span class="badge ${performanceClass}">${performance}%</span>
                                <div style="font-size: var(--text-sm); color: var(--color-text-muted); margin-top: var(--spacing-xs);">
                                    Leistung
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = staffHTML;
            }
            
            // Get role name for display
            function getRoleName(role) {
                switch(role) {
                    case 'cashier': return 'Kassierer';
                    case 'manager': return 'Manager';
                    case 'assistant': return 'Verkaufsassistent';
                    case 'stock': return 'Lagerverwalter';
                    default: return role;
                }
            }
            
            // Render customer statistics
            function renderCustomerStats() {
                const customerStats = dashboardManager.getData().customerStats;
                const container = document.getElementById('customer-stats-container');
                
                if (!container) return;
                
                const { totalCustomers, newCustomers, returningCustomers, customerGrowth } = customerStats;
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-accent);">${totalCustomers || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Gesamtkunden</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success);">${newCustomers || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Neue Kunden (diesen Monat)</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-loyalty);">${returningCustomers || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Wiederkehrende Kunden</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-info);">${customerGrowth || 0}%</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Kundenwachstum</div>
                        </div>
                    </div>
                `;
            }
            
            // Render financial summary
            function renderFinancialSummary() {
                const financialSummary = dashboardManager.getData().financialSummary;
                const container = document.getElementById('financial-summary-container');
                
                if (!container) return;
                
                const { totalRevenue, totalExpenses, profit, profitMargin } = financialSummary;
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success);">€${totalRevenue?.toFixed(2) || '0.00'}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Gesamtumsatz</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-error);">€${totalExpenses?.toFixed(2) || '0.00'}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Gesamtausgaben</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: ${profit >= 0 ? 'var(--color-success)' : 'var(--color-error)'};">€${profit?.toFixed(2) || '0.00'}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Gewinn/Verlust</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: ${profitMargin >= 0 ? 'var(--color-success)' : 'var(--color-error)'};">${profitMargin || '0.00'}%</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Gewinnmarge</div>
                        </div>
                    </div>
                `;
            }
            
            // Render campaigns
            function renderCampaigns() {
                const campaigns = dashboardManager.getData().campaigns;
                const container = document.getElementById('campaigns-container');
                
                if (!container) return;
                
                if (campaigns.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bullhorn"></i>
                            <h3>Keine Marketingkampagnen</h3>
                            <p>Erstellen Sie Ihre erste Marketingkampagne, um neue Kunden zu gewinnen.</p>
                        </div>
                    `;
                    return;
                }
                
                let campaignsHTML = '';
                
                campaigns.forEach(campaign => {
                    const statusClass = campaign.status === 'active' ? 'badge-success' : 
                                      campaign.status === 'completed' ? 'badge-info' : 'badge-warning';
                    
                    const statusText = campaign.status === 'active' ? 'Aktiv' : 
                                     campaign.status === 'completed' ? 'Abgeschlossen' : 'Geplant';
                    
                    const roi = campaign.results?.roi || 0;
                    const roiClass = roi > 0 ? 'positive' : 'negative';
                    const roiIcon = roi > 0 ? 'arrow-up' : 'arrow-down';
                    
                    campaignsHTML += `
                        <div style="padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${campaign.name}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        ${getCampaignTypeName(campaign.type)} | Budget: €${campaign.budget?.toFixed(2) || '0.00'}
                                    </div>
                                </div>
                                <span class="badge ${statusClass}">${statusText}</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--spacing-sm); text-align: center;">
                                <div>
                                    <div style="font-size: var(--text-lg); font-weight: 600;">€${campaign.results?.revenue?.toFixed(2) || '0.00'}</div>
                                    <div style="font-size: var(--text-xs); color: var(--color-text-muted);">Umsatz</div>
                                </div>
                                <div>
                                    <div style="font-size: var(--text-lg); font-weight: 600;">${campaign.results?.newCustomers || 0}</div>
                                    <div style="font-size: var(--text-xs); color: var(--color-text-muted);">Neue Kunden</div>
                                </div>
                                <div>
                                    <div style="font-size: var(--text-lg); font-weight: 600; color: ${roi > 0 ? 'var(--color-success)' : 'var(--color-error)'};">${roi}%</div>
                                    <div style="font-size: var(--text-xs); color: var(--color-text-muted);">ROI</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = campaignsHTML;
            }
            
            // Get campaign type name for display
            function getCampaignTypeName(type) {
                switch(type) {
                    case 'email': return 'E-Mail';
                    case 'social': return 'Social Media';
                    case 'discount': return 'Rabattaktion';
                    case 'loyalty': return 'Treueprogramm';
                    case 'event': return 'Veranstaltung';
                    default: return type;
                }
            }
            
            // Render loyalty statistics
            function renderLoyaltyStats() {
                const loyaltyStats = dashboardManager.getData().loyaltyStats;
                const container = document.getElementById('loyalty-container');
                
                if (!container) return;
                
                const { totalMembers, activeMembers, pointsIssued, pointsRedeemed, averagePoints, redemptionRate } = loyaltyStats;
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-loyalty);">${totalMembers || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Mitglieder gesamt</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success);">${activeMembers || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Aktive Mitglieder</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-info);">${pointsIssued || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Punkte ausgegeben</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-warning);">${pointsRedeemed || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Punkte eingelöst</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-accent);">${averagePoints || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Durchschn. Punkte</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success);">${redemptionRate || 0}%</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Einlöserate</div>
                        </div>
                    </div>
                `;
            }
            
            // Render suppliers
            function renderSuppliers() {
                const suppliers = dashboardManager.getData().suppliers;
                const container = document.getElementById('suppliers-container');
                
                if (!container) return;
                
                if (suppliers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>Keine Lieferanten</h3>
                            <p>Fügen Sie Lieferanten hinzu, um Ihre Lieferkette zu verwalten.</p>
                        </div>
                    `;
                    return;
                }
                
                let suppliersHTML = '';
                
                suppliers.forEach(supplier => {
                    const rating = supplier.rating || 0;
                    const ratingStars = '★'.repeat(Math.floor(rating)) + '☆'.repeat(5 - Math.floor(rating));
                    
                    suppliersHTML += `
                        <div style="padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${supplier.name}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        Kontakt: ${supplier.contact} | ${supplier.products}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--color-warning);">${ratingStars}</div>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">${rating.toFixed(1)}/5.0</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: var(--text-sm); color: var(--color-text-muted);">
                                <div>${supplier.email}</div>
                                <div>Letzte Bestellung: ${supplier.lastOrder}</div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = suppliersHTML;
            }
            
            // Render store performance
            function renderStorePerformance() {
                const storePerformance = dashboardManager.getData().storePerformance;
                const container = document.getElementById('store-performance-container');
                
                if (!container) return;
                
                const { weekRevenue, lastWeekRevenue, wowGrowth, busiestDay, transactions, avgTransactionValue } = storePerformance;
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success);">€${weekRevenue?.toFixed(2) || '0.00'}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Umsatz diese Woche</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: ${wowGrowth >= 0 ? 'var(--color-success)' : 'var(--color-error)'};">${wowGrowth || 0}%</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Wachstum (Woche)</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-info);">${transactions || 0}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Transaktionen</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius);">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-accent);">€${avgTransactionValue?.toFixed(2) || '0.00'}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Durchschn. Transaktion</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); grid-column: 1 / -1;">
                            <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-warning);">${busiestDay || 'Unbekannt'}</div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Umsatzstärkster Tag</div>
                        </div>
                    </div>
                `;
            }
            
            // Render feedback
            function renderFeedback() {
                const feedback = dashboardManager.getData().feedback;
                const container = document.getElementById('feedback-container');
                
                if (!container) return;
                
                if (feedback.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-comment-alt"></i>
                            <h3>Kein Kundenfeedback</h3>
                            <p>Noch haben Kunden kein Feedback hinterlassen.</p>
                        </div>
                    `;
                    return;
                }
                
                let feedbackHTML = '';
                
                feedback.forEach(item => {
                    const ratingStars = '★'.repeat(item.rating) + '☆'.repeat(5 - item.rating);
                    
                    feedbackHTML += `
                        <div style="padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${item.customer}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        ${item.date}
                                    </div>
                                </div>
                                <div style="color: var(--color-warning);">${ratingStars}</div>
                            </div>
                            <div style="margin-bottom: var(--spacing-sm);">
                                ${item.comment}
                            </div>
                            ${item.response ? `
                                <div style="padding: var(--spacing-sm); background: rgba(37, 99, 235, 0.05); border-radius: var(--radius-sm); font-style: italic;">
                                    <strong>Antwort:</strong> ${item.response}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                container.innerHTML = feedbackHTML;
            }
            
            // Render schedule
            function renderSchedule() {
                const schedule = dashboardManager.getData().schedule;
                const container = document.getElementById('schedule-container');
                
                if (!container) return;
                
                if (schedule.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Keine Schichtpläne</h3>
                            <p>Erstellen Sie Schichtpläne für Ihre Mitarbeiter.</p>
                        </div>
                    `;
                    return;
                }
                
                let scheduleHTML = '';
                
                schedule.forEach(shift => {
                    scheduleHTML += `
                        <div style="padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${shift.staffName}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        ${shift.date} | ${shift.startTime} - ${shift.endTime}
                                    </div>
                                </div>
                                <span class="badge badge-info">${getRoleName(shift.role)}</span>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = scheduleHTML;
            }
            
            // Render maintenance
            function renderMaintenance() {
                const maintenance = dashboardManager.getData().maintenance;
                const container = document.getElementById('maintenance-container');
                
                if (!container) return;
                
                if (maintenance.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tools"></i>
                            <h3>Keine Wartungsanfragen</h3>
                            <p>Alle Geräte und Einrichtungen sind in gutem Zustand.</p>
                        </div>
                    `;
                    return;
                }
                
                let maintenanceHTML = '';
                
                maintenance.forEach(request => {
                    const priorityClass = request.priority === 'critical' ? 'badge-error' : 
                                        request.priority === 'high' ? 'badge-warning' : 
                                        request.priority === 'medium' ? 'badge-info' : 'badge-success';
                    
                    const statusClass = request.status === 'in-progress' ? 'badge-warning' : 
                                      request.status === 'completed' ? 'badge-success' : 'badge-error';
                    
                    maintenanceHTML += `
                        <div style="padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${request.equipment}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        Gemeldet: ${request.reportedDate}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <span class="badge ${priorityClass}">${request.priority}</span>
                                    <span class="badge ${statusClass}" style="margin-left: var(--spacing-xs);">${request.status}</span>
                                </div>
                            </div>
                            <div style="margin-bottom: var(--spacing-sm);">
                                ${request.issue}
                            </div>
                            ${request.assignedTo ? `
                                <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                    Zugewiesen an: ${request.assignedTo}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                container.innerHTML = maintenanceHTML;
            }
            
            // Render security logs
            function renderSecurityLogs() {
                const securityLogs = dashboardManager.getData().securityLogs;
                const container = document.getElementById('security-logs-container');
                
                if (!container) return;
                
                if (securityLogs.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shield-alt"></i>
                            <h3>Keine Sicherheitsprotokolle</h3>
                            <p>Es wurden noch keine Sicherheitsereignisse aufgezeichnet.</p>
                        </div>
                    `;
                    return;
                }
                
                let logsHTML = '';
                
                securityLogs.forEach(log => {
                    const statusClass = log.status === 'success' ? 'badge-success' : 'badge-error';
                    
                    logsHTML += `
                        <div style="padding: var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <strong>${log.user}</strong>
                                    <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                        ${log.timestamp}
                                    </div>
                                </div>
                                <span class="badge ${statusClass}">${log.status}</span>
                            </div>
                            <div style="margin-bottom: var(--spacing-sm);">
                                ${log.action}
                            </div>
                            <div style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                IP: ${log.ip}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = logsHTML;
            }
            
            // Initialize charts
            function initCharts() {
                // Revenue chart
                const revenueCtx = document.getElementById('revenue-chart');
                if (revenueCtx) {
                    revenueChart = new Chart(revenueCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
                            datasets: [{
                                label: 'Umsatz (€)',
                                data: [1250, 1890, 1530, 2100, 2750, 3200, 2850],
                                backgroundColor: 'rgba(37, 99, 235, 0.5)',
                                borderColor: 'rgba(37, 99, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '€' + value;
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return 'Umsatz: €' + context.raw;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Sales distribution chart
                const salesDistributionCtx = document.getElementById('sales-distribution-chart');
                if (salesDistributionCtx) {
                    salesDistributionChart = new Chart(salesDistributionCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['Lebensmittel', 'Getränke', 'Haushalt', 'Drogerie', 'Sonstiges'],
                            datasets: [{
                                data: [35, 25, 20, 15, 5],
                                backgroundColor: [
                                    'rgba(37, 99, 235, 0.7)',
                                    'rgba(22, 163, 74, 0.7)',
                                    'rgba(217, 119, 6, 0.7)',
                                    'rgba(126, 34, 206, 0.7)',
                                    'rgba(107, 114, 128, 0.7)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.label + ': ' + context.raw + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            // Public API
            return {
                init,
                renderStats,
                renderGoals,
                renderTopProducts,
                renderOrders,
                renderInventoryAlerts,
                renderStaffPerformance,
                renderCustomerStats,
                renderFinancialSummary,
                renderCampaigns,
                renderLoyaltyStats,
                renderSuppliers,
                renderStorePerformance,
                renderFeedback,
                renderSchedule,
                renderMaintenance,
                renderSecurityLogs
            };
        })();

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            // Apply dark mode if enabled
            applyDarkMode();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize dashboard
            await uiManager.init();
            
            // Update time display
            updateTime();
            setInterval(updateTime, 1000);
        });

        // Apply dark mode if enabled
        function applyDarkMode() {
            const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Hamburger menu toggle for mobile
            document.getElementById('hamburger').addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                sidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
            });
            
            // Close sidebar when clicking overlay
            document.getElementById('sidebarOverlay').addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
            });
            
            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', () => {
                const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
                
                if (settings.logoutConfirmation) {
                    if (!confirm('Möchten Sie sich wirklich abmelden?')) {
                        return;
                    }
                }
                
                sessionStorage.removeItem('validTokens');
                localStorage.removeItem('authToken');
                window.location.reload();
            });
            
            // Modal close buttons
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('goalModalClose').addEventListener('click', closeModal);
            document.getElementById('staffModalClose').addEventListener('click', closeModal);
            document.getElementById('inventoryModalClose').addEventListener('click', closeModal);
            document.getElementById('supplierModalClose').addEventListener('click', closeModal);
            document.getElementById('campaignModalClose').addEventListener('click', closeModal);
            document.getElementById('scheduleModalClose').addEventListener('click', closeModal);
            document.getElementById('maintenanceModalClose').addEventListener('click', closeModal);
            
            // Modal cancel buttons
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('cancelGoalBtn').addEventListener('click', closeModal);
            document.getElementById('cancelStaffBtn').addEventListener('click', closeModal);
            document.getElementById('cancelInventoryBtn').addEventListener('click', closeModal);
            document.getElementById('cancelSupplierBtn').addEventListener('click', closeModal);
            document.getElementById('cancelCampaignBtn').addEventListener('click', closeModal);
            document.getElementById('cancelScheduleBtn').addEventListener('click', closeModal);
            document.getElementById('cancelMaintenanceBtn').addEventListener('click', closeModal);
            
            // Modal save buttons
            document.getElementById('saveProductBtn').addEventListener('click', saveProduct);
            document.getElementById('saveGoalBtn').addEventListener('click', saveGoal);
            document.getElementById('saveStaffBtn').addEventListener('click', saveStaff);
            document.getElementById('saveInventoryBtn').addEventListener('click', saveInventory);
            document.getElementById('saveSupplierBtn').addEventListener('click', saveSupplier);
            document.getElementById('saveCampaignBtn').addEventListener('click', saveCampaign);
            document.getElementById('saveScheduleBtn').addEventListener('click', saveSchedule);
            document.getElementById('saveMaintenanceBtn').addEventListener('click', saveMaintenance);
            
            // Chart type buttons
            document.querySelectorAll('.chart-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const chartId = this.getAttribute('data-chart');
                    const chartType = this.getAttribute('data-type');
                    
                    // Remove active class from all buttons in this chart group
                    this.parentElement.querySelectorAll('.chart-action-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Change chart type
                    if (chartId === 'revenue' && revenueChart) {
                        revenueChart.config.type = chartType;
                        revenueChart.update();
                    } else if (chartId === 'sales' && salesDistributionChart) {
                        salesDistributionChart.config.type = chartType;
                        salesDistributionChart.update();
                    }
                });
            });
        }

        // Time display function
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('de-DE', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('timeDisplay').textContent = `${dateString} | ${timeString}`;
        }

        // Modal functions
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
            document.getElementById('modal-overlay').classList.remove('active');
        }

        function openModal(modalId) {
            closeModal(); // Close any open modals first
            document.getElementById(modalId).classList.add('active');
            document.getElementById('modal-overlay').classList.add('active');
        }

        // Show product modal
        function showProductModal() {
            openModal('product-modal');
        }

        // Save product
        async function saveProduct() {
            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const barcode = document.getElementById('product-barcode').value;
            const stock = parseInt(document.getElementById('product-stock').value);
            const category = document.getElementById('product-category').value;
            
            if (!name || !price || !barcode || isNaN(stock)) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            const product = {
                name,
                price,
                barcode,
                stock,
                category
            };
            
            const success = storageManager.saveProduct(product);
            
            if (success) {
                closeModal();
                alert('Produkt erfolgreich gespeichert!');
                
                // Reset form
                document.getElementById('product-name').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-barcode').value = '';
                document.getElementById('product-stock').value = '';
                document.getElementById('product-category').value = '';
                
                // Refresh dashboard data
                await dashboardManager.loadProducts();
                uiManager.renderTopProducts();
                uiManager.renderInventoryAlerts();
            } else {
                alert('Fehler beim Speichern des Produkts.');
            }
        }

        // Show goal modal
        function showGoalModal() {
            // Set default month to current month
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            document.getElementById('goal-month').value = `${year}-${month}`;
            
            openModal('goal-modal');
        }

        // Save goal
        async function saveGoal() {
            const type = document.getElementById('goal-type').value;
            const target = parseFloat(document.getElementById('goal-target').value);
            const month = document.getElementById('goal-month').value;
            
            if (!target || isNaN(target)) {
                alert('Bitte geben Sie einen gültigen Zielwert ein.');
                return;
            }
            
            const goal = {
                type,
                target,
                month
            };
            
            try {
                await dashboardManager.saveGoal(goal);
                closeModal();
                alert('Ziel erfolgreich gespeichert!');
                
                // Reset form
                document.getElementById('goal-target').value = '';
                
                // Refresh goals
                uiManager.renderGoals();
            } catch (error) {
                alert('Fehler beim Speichern des Ziels.');
            }
        }

        // Show staff modal
        function showStaffModal() {
            openModal('staff-modal');
        }

        // Save staff
        async function saveStaff() {
            const name = document.getElementById('staff-name').value;
            const email = document.getElementById('staff-email').value;
            const role = document.getElementById('staff-role').value;
            const salary = parseFloat(document.getElementById('staff-salary').value);
            
            if (!name || !email || !role || isNaN(salary)) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            const staff = {
                name,
                email,
                role,
                salary
            };
            
            try {
                await dashboardManager.saveStaff(staff);
                closeModal();
                alert('Mitarbeiter erfolgreich hinzugefügt!');
                
                // Reset form
                document.getElementById('staff-name').value = '';
                document.getElementById('staff-email').value = '';
                document.getElementById('staff-role').value = 'cashier';
                document.getElementById('staff-salary').value = '';
                
                // Refresh staff data
                uiManager.renderStaffPerformance();
            } catch (error) {
                alert('Fehler beim Hinzufügen des Mitarbeiters.');
            }
        }

        // Show inventory modal
        function showInventoryModal() {
            // Populate product dropdown
            const products = dashboardManager.getData().products;
            const productSelect = document.getElementById('inventory-product');
            productSelect.innerHTML = '';
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.barcode;
                option.textContent = `${product.name} (Lager: ${product.stock || 0})`;
                productSelect.appendChild(option);
            });
            
            openModal('inventory-modal');
        }

        // Save inventory adjustment
        async function saveInventory() {
            const productBarcode = document.getElementById('inventory-product').value;
            const adjustment = parseInt(document.getElementById('inventory-adjustment').value);
            const reason = document.getElementById('inventory-reason').value;
            
            if (!productBarcode || isNaN(adjustment)) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            // Get the product
            const products = await storageManager.getProducts();
            const product = products[productBarcode];
            
            if (!product) {
                alert('Produkt nicht gefunden.');
                return;
            }
            
            // Update stock
            const newStock = (product.stock || 0) + adjustment;
            product.stock = Math.max(0, newStock);
            
            // Save updated product
            const success = storageManager.saveProduct(product);
            
            if (success) {
                closeModal();
                alert('Lagerbestand erfolgreich angepasst!');
                
                // Reset form
                document.getElementById('inventory-adjustment').value = '';
                
                // Refresh inventory data
                await dashboardManager.loadProducts();
                await dashboardManager.loadInventoryAlerts();
                uiManager.renderTopProducts();
                uiManager.renderInventoryAlerts();
            } else {
                alert('Fehler beim Anpassen des Lagerbestands.');
            }
        }

        // Show supplier modal
        function showSupplierModal() {
            openModal('supplier-modal');
        }

        // Save supplier
        async function saveSupplier() {
            const name = document.getElementById('supplier-name').value;
            const contact = document.getElementById('supplier-contact').value;
            const email = document.getElementById('supplier-email').value;
            const phone = document.getElementById('supplier-phone').value;
            const products = document.getElementById('supplier-products').value;
            
            if (!name || !contact || !email || !phone || !products) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            const supplier = {
                name,
                contact,
                email,
                phone,
                products
            };
            
            try {
                await dashboardManager.saveSupplier(supplier);
                closeModal();
                alert('Lieferant erfolgreich hinzugefügt!');
                
                // Reset form
                document.getElementById('supplier-name').value = '';
                document.getElementById('supplier-contact').value = '';
                document.getElementById('supplier-email').value = '';
                document.getElementById('supplier-phone').value = '';
                document.getElementById('supplier-products').value = '';
                
                // Refresh supplier data
                uiManager.renderSuppliers();
            } catch (error) {
                alert('Fehler beim Hinzufügen des Lieferanten.');
            }
        }

        // Show campaign modal
        function showCampaignModal() {
            openModal('campaign-modal');
        }

        // Save campaign
        async function saveCampaign() {
            const name = document.getElementById('campaign-name').value;
            const type = document.getElementById('campaign-type').value;
            const budget = parseFloat(document.getElementById('campaign-budget').value);
            const startDate = document.getElementById('campaign-start').value;
            const endDate = document.getElementById('campaign-end').value;
            
            if (!name || !type || isNaN(budget) || !startDate || !endDate) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            const campaign = {
                name,
                type,
                budget,
                startDate,
                endDate
            };
            
            try {
                await dashboardManager.saveCampaign(campaign);
                closeModal();
                alert('Kampagne erfolgreich erstellt!');
                
                // Reset form
                document.getElementById('campaign-name').value = '';
                document.getElementById('campaign-type').value = 'email';
                document.getElementById('campaign-budget').value = '';
                document.getElementById('campaign-start').value = '';
                document.getElementById('campaign-end').value = '';
                
                // Refresh campaign data
                uiManager.renderCampaigns();
            } catch (error) {
                alert('Fehler beim Erstellen der Kampagne.');
            }
        }

        // Show schedule modal
        function showScheduleModal() {
            // Populate staff dropdown
            const staff = dashboardManager.getData().staff;
            const staffSelect = document.getElementById('schedule-staff');
            staffSelect.innerHTML = '';
            
            staff.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = `${employee.name} (${getRoleName(employee.role)})`;
                staffSelect.appendChild(option);
            });
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('schedule-date').value = today;
            
            openModal('schedule-modal');
        }

        // Save schedule
        async function saveSchedule() {
            const staffId = document.getElementById('schedule-staff').value;
            const date = document.getElementById('schedule-date').value;
            const startTime = document.getElementById('schedule-start').value;
            const endTime = document.getElementById('schedule-end').value;
            const role = document.getElementById('schedule-role').value;
            
            if (!staffId || !date || !startTime || !endTime || !role) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            // Find staff name
            const staff = dashboardManager.getData().staff;
            const employee = staff.find(e => e.id === staffId);
            
            if (!employee) {
                alert('Mitarbeiter nicht gefunden.');
                return;
            }
            
            const schedule = {
                staffId,
                staffName: employee.name,
                date,
                startTime,
                endTime,
                role
            };
            
            try {
                await dashboardManager.saveSchedule(schedule);
                closeModal();
                alert('Schichtplan erfolgreich erstellt!');
                
                // Reset form
                document.getElementById('schedule-date').value = '';
                document.getElementById('schedule-start').value = '';
                document.getElementById('schedule-end').value = '';
                document.getElementById('schedule-role').value = 'cashier';
                
                // Refresh schedule data
                uiManager.renderSchedule();
            } catch (error) {
                alert('Fehler beim Erstellen des Schichtplans.');
            }
        }

        // Show maintenance modal
        function showMaintenanceModal() {
            openModal('maintenance-modal');
        }

        // Save maintenance
        async function saveMaintenance() {
            const equipment = document.getElementById('maintenance-equipment').value;
            const issue = document.getElementById('maintenance-issue').value;
            const priority = document.getElementById('maintenance-priority').value;
            
            if (!equipment || !issue || !priority) {
                alert('Bitte füllen Sie alle erforderlichen Felder aus.');
                return;
            }
            
            const maintenance = {
                equipment,
                issue,
                priority
            };
            
            try {
                await dashboardManager.saveMaintenance(maintenance);
                closeModal();
                alert('Wartungsanfrage erfolgreich erstellt!');
                
                // Reset form
                document.getElementById('maintenance-equipment').value = '';
                document.getElementById('maintenance-issue').value = '';
                document.getElementById('maintenance-priority').value = 'medium';
                
                // Refresh maintenance data
                uiManager.renderMaintenance();
            } catch (error) {
                alert('Fehler beim Erstellen der Wartungsanfrage.');
            }
        }

        // Refresh functions
        async function refreshGoals() {
            await dashboardManager.loadGoals();
            uiManager.renderGoals();
        }

        async function refreshTopProducts() {
            await dashboardManager.loadProducts();
            uiManager.renderTopProducts();
        }

        async function refreshOrders() {
            await dashboardManager.loadOrders();
            uiManager.renderOrders();
        }

        async function refreshInventoryAlerts() {
            await dashboardManager.loadInventoryAlerts();
            uiManager.renderInventoryAlerts();
        }

        async function refreshStaffPerformance() {
            await dashboardManager.loadStaff();
            uiManager.renderStaffPerformance();
        }

        async function refreshCustomerStats() {
            await dashboardManager.loadCustomerStats();
            uiManager.renderCustomerStats();
        }

        async function refreshFinancialSummary() {
            await dashboardManager.loadFinancialSummary();
            uiManager.renderFinancialSummary();
        }

        async function refreshCampaigns() {
            await dashboardManager.loadCampaigns();
            uiManager.renderCampaigns();
        }

        async function refreshLoyaltyStats() {
            await dashboardManager.loadLoyaltyStats();
            uiManager.renderLoyaltyStats();
        }

        async function refreshSuppliers() {
            await dashboardManager.loadSuppliers();
            uiManager.renderSuppliers();
        }

        async function refreshStorePerformance() {
            await dashboardManager.loadStorePerformance();
            uiManager.renderStorePerformance();
        }

        async function refreshFeedback() {
            await dashboardManager.loadFeedback();
            uiManager.renderFeedback();
        }

        async function refreshSchedule() {
            await dashboardManager.loadSchedule();
            uiManager.renderSchedule();
        }

        async function refreshMaintenance() {
            await dashboardManager.loadMaintenance();
            uiManager.renderMaintenance();
        }

        async function refreshSecurityLogs() {
            await dashboardManager.loadSecurityLogs();
            uiManager.renderSecurityLogs();
        }

        // Export functions
        function exportTopProducts() {
            const products = dashboardManager.getData().products;
            
            if (products.length === 0) {
                alert('Keine Produkte zum Exportieren verfügbar.');
                return;
            }
            
            // Sort products by revenue (simulated)
            const topProducts = products
                .sort((a, b) => {
                    const revenueA = a.price * (Math.floor(Math.random() * 100) + 10);
                    const revenueB = b.price * (Math.floor(Math.random() * 100) + 10);
                    return revenueB - revenueA;
                })
                .slice(0, 10);
            
            // Create CSV content
            let csvContent = "Produktname,Barcode,Preis,Lagerbestand,Umsatz (simuliert),Verkäufe (simuliert)\n";
            
            topProducts.forEach(product => {
                const sales = Math.floor(Math.random() * 100) + 10;
                const revenue = product.price * sales;
                
                csvContent += `"${product.name}",${product.barcode},${product.price},${product.stock || 0},${revenue},${sales}\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'top_produkte.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Top-Produkte wurden erfolgreich exportiert.');
        }

        function exportFinancialReport() {
            const financialSummary = dashboardManager.getData().financialSummary;
            const stats = dashboardManager.getData().stats;
            
            // Create PDF
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text('Finanzbericht', 20, 30);
            
            // Date
            doc.setFontSize(12);
            doc.text(`Erstellt am: ${new Date().toLocaleDateString('de-DE')}`, 20, 45);
            
            // Financial summary
            doc.setFontSize(16);
            doc.text('Finanzübersicht', 20, 65);
            
            doc.setFontSize(12);
            doc.text(`Gesamtumsatz: €${financialSummary.totalRevenue?.toFixed(2) || '0.00'}`, 20, 80);
            doc.text(`Gesamtausgaben: €${financialSummary.totalExpenses?.toFixed(2) || '0.00'}`, 20, 90);
            doc.text(`Gewinn/Verlust: €${financialSummary.profit?.toFixed(2) || '0.00'}`, 20, 100);
            doc.text(`Gewinnmarge: ${financialSummary.profitMargin || '0.00'}%`, 20, 110);
            
            // Statistics
            doc.setFontSize(16);
            doc.text('Verkaufsstatistiken', 20, 130);
            
            doc.setFontSize(12);
            doc.text(`Heutiger Umsatz: €${stats.todayRevenue?.toFixed(2) || '0.00'}`, 20, 145);
            doc.text(`Wochenumsatz: €${stats.weekRevenue?.toFixed(2) || '0.00'}`, 20, 155);
            doc.text(`Monatsumsatz: €${stats.monthRevenue?.toFixed(2) || '0.00'}`, 20, 165);
            doc.text(`Durchschn. Bestellwert: €${stats.avgOrderValue?.toFixed(2) || '0.00'}`, 20, 175);
            doc.text(`Gesamttransaktionen: ${stats.totalTransactions || 0}`, 20, 185);
            doc.text(`Eindeutige Kunden: ${stats.uniqueCustomers || 0}`, 20, 195);
            
            // Save PDF
            doc.save('finanzbericht.pdf');
            
            alert('Finanzbericht wurde erfolgreich exportiert.');
        }
    </script>
</body>
</html>
