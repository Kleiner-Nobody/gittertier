<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gittertier Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    :root {
        --color-bg: #ffffff;
        --color-bg-secondary: #f9fafb;
        --color-text: #111111;
        --color-text-muted: #6b7280;
        --color-border: #e5e7eb;
        --color-accent: #2563eb;
        --color-accent-hover: #1d4ed8;
        --color-success: #16a34a;
        --color-success-light: #dcfce7;
        --color-error: #dc2626;
        --color-error-light: #fee2e2;
        --color-warning: #d97706;
        --color-warning-light: #fef3c7;
        --color-info: #0ea5e9;
        --color-info-light: #e0f2fe;
        --color-premium: #7e22ce;
        --color-premium-light: #f3e8ff;
        --color-ai: #10b981;
        --color-ai-light: #d1fae5;
        --color-overlay: rgba(0, 0, 0, 0.5);
        
        --radius: 12px;
        --radius-sm: 6px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.07), 0 1px 2px rgba(0, 0, 0, 0.04);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --focus-ring: 0 0 0 3px rgba(37, 99, 235, 0.35);
        
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-xxl: 48px;
        
        --transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
        --transition-slow: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        
        --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        
        --header-height: 64px;
        --sidebar-width: 280px;
        --sidebar-width-collapsed: 80px;
    }

    .dark-mode {
        --color-bg: #111827;
        --color-bg-secondary: #1f2937;
        --color-text: #f3f4f6;
        --color-text-muted: #9ca3af;
        --color-border: #374151;
        --color-accent: #3b82f6;
        --color-accent-hover: #2563eb;
        --color-success: #10b981;
        --color-success-light: rgba(16, 185, 129, 0.1);
        --color-error: #ef4444;
        --color-error-light: rgba(239, 68, 68, 0.1);
        --color-warning: #f59e0b;
        --color-warning-light: rgba(245, 158, 11, 0.1);
        --color-info: #0ea5e9;
        --color-info-light: rgba(14, 165, 233, 0.1);
        --color-premium: #a855f7;
        --color-premium-light: rgba(168, 85, 247, 0.1);
        --color-ai: #10b981;
        --color-ai-light: rgba(16, 185, 129, 0.1);
        --color-overlay: rgba(0, 0, 0, 0.7);
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: var(--font-family);
        background-color: var(--color-bg);
        color: var(--color-text);
        line-height: 1.5;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Header Styles */
    .admin-header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-lg);
        border-bottom: 1px solid var(--color-border);
        background-color: var(--color-bg);
        position: sticky;
        top: 0;
        z-index: 50;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        font-weight: 700;
        font-size: var(--text-xl);
    }

    .logo i {
        font-size: var(--text-xl);
        color: var(--color-accent);
    }

    .header-controls {
        display: flex;
        gap: var(--spacing-md);
        align-items: center;
    }

    .time-display {
        background-color: var(--color-bg-secondary);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        display: none;
    }

    .logout-btn {
        background-color: transparent;
        color: var(--color-text);
        border: 1px solid var(--color-border);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .logout-btn:hover {
        background-color: var(--color-bg-secondary);
    }

    .hamburger {
        display: block;
        background: transparent;
        border: none;
        font-size: var(--text-lg);
        color: var(--color-text);
        cursor: pointer;
        transition: var(--transition);
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .hamburger:hover {
        background-color: var(--color-bg-secondary);
    }

    /* Main layout */
    .admin-container {
        display: flex;
        flex: 1;
    }

    /* Sidebar */
    .admin-sidebar {
        width: var(--sidebar-width);
        background-color: var(--color-bg);
        border-right: 1px solid var(--color-border);
        height: calc(100vh - var(--header-height));
        position: fixed;
        top: var(--header-height);
        left: 0;
        overflow-y: auto;
        transition: transform 0.3s ease;
        z-index: 40;
        padding: var(--spacing-lg) 0;
    }

    .nav-container {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
        padding: 0 var(--spacing-md);
    }

    .nav-link {
        padding: var(--spacing-md);
        border-radius: var(--radius);
        text-decoration: none;
        color: var(--color-text);
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .nav-link:hover {
        background-color: var(--color-bg-secondary);
    }

    .nav-link.active {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--color-accent);
    }

    .nav-link i {
        width: 24px;
        text-align: center;
    }

    .nav-link.active i {
        color: var(--color-accent);
    }

    .new-feature {
        background-color: var(--color-success);
        color: white;
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: auto;
    }

    /* Sidebar overlay for mobile */
    .sidebar-overlay {
        position: fixed;
        top: var(--header-height);
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        z-index: 35;
        display: none;
    }

    /* Main content */
    .admin-content {
        flex: 1;
        padding: var(--spacing-lg);
        margin-left: var(--sidebar-width);
        transition: margin-left 0.3s ease;
    }

    /* Dashboard Grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }

    /* Dashboard Header */
    .dashboard-header {
        grid-column: 1 / -1;
        margin-bottom: var(--spacing-lg);
    }

    .dashboard-title {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
    }

    .dashboard-subtitle {
        color: var(--color-text-muted);
        font-size: var(--text-lg);
    }

    /* Cards */
    .dashboard-card {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        border: 1px solid var(--color-border);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-lg);
    }

    .card-title {
        font-size: var(--text-lg);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .card-title i {
        color: var(--color-accent);
    }

    .card-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .card-action-btn {
        background: transparent;
        border: none;
        color: var(--color-text-muted);
        cursor: pointer;
        padding: var(--spacing-xs);
        border-radius: var(--radius-sm);
        transition: var(--transition);
    }

    .card-action-btn:hover {
        background-color: var(--color-bg-secondary);
        color: var(--color-accent);
    }

    /* Card Sizes */
    .card-small {
        grid-column: span 3;
    }

    .card-medium {
        grid-column: span 6;
    }

    .card-large {
        grid-column: span 9;
    }

    .card-full {
        grid-column: 1 / -1;
    }

    /* Stat Cards */
    .stat-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: var(--spacing-lg);
        border-radius: var(--radius);
        background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-hover) 100%);
        color: white;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        z-index: 1;
    }

    .stat-card > * {
        position: relative;
        z-index: 2;
    }

    .stat-card .stat-icon {
        font-size: var(--text-2xl);
        margin-bottom: var(--spacing-sm);
        opacity: 0.9;
    }

    .stat-card .stat-value {
        font-size: var(--text-3xl);
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
    }

    .stat-card .stat-label {
        font-size: var(--text-sm);
        opacity: 0.9;
    }

    .stat-card .stat-change {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: var(--text-xs);
        margin-top: var(--spacing-sm);
        padding: 4px 8px;
        border-radius: 20px;
        background-color: rgba(255, 255, 255, 0.2);
    }

    .stat-card.positive {
        background: linear-gradient(135deg, var(--color-success) 0%, #0f9c5a 100%);
    }

    .stat-card.warning {
        background: linear-gradient(135deg, var(--color-warning) 0%, #b45309 100%);
    }

    .stat-card.danger {
        background: linear-gradient(135deg, var(--color-error) 0%, #b91c1c 100%);
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }

    /* Goal Progress */
    .goal-progress {
        margin-top: var(--spacing-md);
    }

    .goal-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid var(--color-border);
    }

    .goal-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .goal-info {
        flex: 1;
    }

    .goal-title {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
    }

    .goal-description {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
    }

    .goal-progress-bar {
        height: 8px;
        background-color: var(--color-bg-secondary);
        border-radius: 4px;
        overflow: hidden;
        margin: var(--spacing-sm) 0;
    }

    .goal-progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .goal-progress-fill.positive {
        background-color: var(--color-success);
    }

    .goal-progress-fill.warning {
        background-color: var(--color-warning);
    }

    .goal-progress-fill.danger {
        background-color: var(--color-error);
    }

    .goal-stats {
        display: flex;
        justify-content: space-between;
        font-size: var(--text-sm);
    }

    .goal-current {
        font-weight: 600;
    }

    .goal-target {
        color: var(--color-text-muted);
    }

    /* Recent Activity */
    .activity-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .activity-item {
        display: flex;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        border-radius: var(--radius);
        background-color: var(--color-bg-secondary);
        transition: var(--transition);
    }

    .activity-item:hover {
        background-color: var(--color-bg);
        box-shadow: var(--shadow);
    }

    .activity-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--color-accent);
        color: white;
        flex-shrink: 0;
    }

    .activity-content {
        flex: 1;
    }

    .activity-title {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
    }

    .activity-description {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-xs);
    }

    .activity-time {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
    }

    /* Product List */
    .product-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .product-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-sm);
        border-radius: var(--radius);
        transition: var(--transition);
    }

    .product-item:hover {
        background-color: var(--color-bg-secondary);
    }

    .product-image {
        width: 50px;
        height: 50px;
        border-radius: var(--radius-sm);
        background-color: var(--color-bg-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-text-muted);
        overflow: hidden;
    }

    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-info {
        flex: 1;
    }

    .product-name {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
    }

    .product-details {
        display: flex;
        gap: var(--spacing-md);
        font-size: var(--text-sm);
        color: var(--color-text-muted);
    }

    .product-stock {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }

    .stock-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .stock-indicator.high {
        background-color: var(--color-success);
    }

    .stock-indicator.medium {
        background-color: var(--color-warning);
    }

    .stock-indicator.low {
        background-color: var(--color-error);
    }

    /* Task List */
    .task-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .task-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        border-radius: var(--radius);
        background-color: var(--color-bg-secondary);
        transition: var(--transition);
    }

    .task-item:hover {
        background-color: var(--color-bg);
        box-shadow: var(--shadow);
    }

    .task-checkbox {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid var(--color-border);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        flex-shrink: 0;
    }

    .task-checkbox.checked {
        background-color: var(--color-success);
        border-color: var(--color-success);
        color: white;
    }

    .task-content {
        flex: 1;
    }

    .task-title {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
    }

    .task-description {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-xs);
    }

    .task-meta {
        display: flex;
        gap: var(--spacing-md);
        font-size: var(--text-xs);
        color: var(--color-text-muted);
    }

    .task-priority {
        padding: 2px 8px;
        border-radius: 20px;
        font-size: var(--text-xs);
        font-weight: 600;
    }

    .task-priority.high {
        background-color: var(--color-error-light);
        color: var(--color-error);
    }

    .task-priority.medium {
        background-color: var(--color-warning-light);
        color: var(--color-warning);
    }

    .task-priority.low {
        background-color: var(--color-success-light);
        color: var(--color-success);
    }

    /* AI Assistant */
    .ai-assistant {
        background-color: var(--color-ai-light);
        border: 1px solid var(--color-ai);
        border-radius: var(--radius);
        padding: var(--spacing-lg);
        position: relative;
        overflow: hidden;
    }

    .ai-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .ai-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--color-ai) 0%, #0d9668 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--text-xl);
    }

    .ai-title {
        font-weight: 600;
        font-size: var(--text-lg);
    }

    .ai-subtitle {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
    }

    .ai-messages {
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: var(--spacing-md);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .ai-message {
        padding: var(--spacing-md);
        border-radius: var(--radius);
        max-width: 80%;
    }

    .ai-message.user {
        align-self: flex-end;
        background-color: var(--color-accent);
        color: white;
    }

    .ai-message.assistant {
        align-self: flex-start;
        background-color: var(--color-bg);
        border: 1px solid var(--color-border);
    }

    .ai-input-container {
        display: flex;
        gap: var(--spacing-sm);
    }

    .ai-input {
        flex: 1;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        background-color: var(--color-bg);
        color: var(--color-text);
        transition: var(--transition);
    }

    .ai-input:focus {
        outline: none;
        border-color: var(--color-ai);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.35);
    }

    .ai-send-btn {
        background-color: var(--color-ai);
        color: white;
        border: none;
        border-radius: var(--radius);
        padding: var(--spacing-md) var(--spacing-lg);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ai-send-btn:hover {
        background-color: #0d9668;
    }

    /* Quick Actions */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: var(--spacing-md);
    }

    .action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-lg);
        border-radius: var(--radius);
        background-color: var(--color-bg-secondary);
        border: 1px solid var(--color-border);
        cursor: pointer;
        transition: var(--transition);
        text-align: center;
    }

    .action-btn:hover {
        background-color: var(--color-bg);
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .action-icon {
        font-size: var(--text-2xl);
        margin-bottom: var(--spacing-sm);
        color: var(--color-accent);
    }

    .action-label {
        font-weight: 600;
        font-size: var(--text-sm);
    }

    /* Notifications */
    .notifications-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .notification-item {
        display: flex;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        border-radius: var(--radius);
        background-color: var(--color-bg-secondary);
        transition: var(--transition);
    }

    .notification-item:hover {
        background-color: var(--color-bg);
        box-shadow: var(--shadow);
    }

    .notification-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .notification-icon.info {
        background-color: var(--color-info-light);
        color: var(--color-info);
    }

    .notification-icon.success {
        background-color: var(--color-success-light);
        color: var(--color-success);
    }

    .notification-icon.warning {
        background-color: var(--color-warning-light);
        color: var(--color-warning);
    }

    .notification-icon.error {
        background-color: var(--color-error-light);
        color: var(--color-error);
    }

    .notification-content {
        flex: 1;
    }

    .notification-title {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
    }

    .notification-description {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-xs);
    }

    .notification-time {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        display: none;
        padding: var(--spacing-md);
    }

    .modal-overlay.active {
        display: flex;
        animation: fadeIn 0.3s ease;
    }

    .modal {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        padding: var(--spacing-xl);
        width: 100%;
        max-width: 600px;
        box-shadow: var(--shadow-lg);
        animation: scaleIn 0.3s ease;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .modal-title {
        font-size: var(--text-xl);
        font-weight: 600;
    }

    .close-modal {
        background: transparent;
        border: none;
        font-size: var(--text-xl);
        color: var(--color-text);
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .close-modal:hover {
        background-color: var(--color-bg-secondary);
    }

    .modal-body {
        margin-bottom: var(--spacing-lg);
    }

    .modal-footer {
        display: flex;
        gap: var(--spacing-md);
        justify-content: flex-end;
    }

    /* Form Styles */
    .form-group {
        margin-bottom: var(--spacing-lg);
    }

    .form-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 600;
    }

    .form-control {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        background-color: var(--color-bg);
        color: var(--color-text);
        transition: var(--transition);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--color-accent);
        box-shadow: var(--focus-ring);
    }

    .form-select {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        background-color: var(--color-bg);
        color: var(--color-text);
        transition: var(--transition);
    }

    .form-textarea {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        background-color: var(--color-bg);
        color: var(--color-text);
        transition: var(--transition);
        resize: vertical;
        min-height: 120px;
    }

    /* Button Styles */
    .btn {
        padding: var(--spacing-md) var(--spacing-lg);
        border: none;
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .btn:active {
        transform: translateY(0);
    }

    .btn-primary {
        background-color: var(--color-accent);
        color: white;
    }

    .btn-primary:hover {
        background-color: var(--color-accent-hover);
    }

    .btn-success {
        background-color: var(--color-success);
        color: white;
    }

    .btn-success:hover {
        background-color: #0f9c5a;
    }

    .btn-outline {
        background-color: transparent;
        border: 1px solid var(--color-border);
        color: var(--color-text);
    }

    .btn-outline:hover {
        background-color: var(--color-bg-secondary);
        border-color: var(--color-accent);
    }

    /* Animation Keyframes */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes scaleIn {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .admin-sidebar {
            transform: translateX(-100%);
        }
        
        .admin-sidebar.active {
            transform: translateX(0);
        }
        
        .admin-content {
            margin-left: 0;
        }
        
        .sidebar-overlay.active {
            display: block;
        }

        .card-small, .card-medium, .card-large {
            grid-column: span 6;
        }
    }

    @media (min-width: 768px) {
        .time-display {
            display: block;
        }
        
        .logout-btn span {
            display: inline;
        }
    }

    @media (max-width: 768px) {
        .admin-header {
            padding: 0 var(--spacing-md);
        }
        
        .admin-content {
            padding: var(--spacing-md);
        }
        
        .card-small, .card-medium, .card-large {
            grid-column: span 12;
        }

        .quick-actions {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }

        .ai-message {
            max-width: 90%;
        }
    }

    @media (max-width: 480px) {
        .modal {
            padding: var(--spacing-md);
        }

        .modal-footer {
            flex-direction: column;
        }

        .ai-header {
            flex-direction: column;
            text-align: center;
            gap: var(--spacing-sm);
        }

        .quick-actions {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* Dark mode support for system preference */
    @media (prefers-color-scheme: dark) {
        :root {
            --color-bg: #111827;
            --color-bg-secondary: #1f2937;
            --color-text: #f3f4f6;
            --color-text-muted: #9ca3af;
            --color-border: #374151;
        }
    }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="logo">
            <button class="hamburger" id="hamburger">
                <i class="fas fa-bars"></i>
            </button>
            <i class="fas fa-shopping-cart"></i>
            <span>Dashboard</span>
        </div>
        <div class="header-controls">
            <div class="time-display" id="timeDisplay"></div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Abmelden</span>
            </button>
        </div>
    </div>

    <div class="admin-container">
        <aside class="admin-sidebar" id="sidebar">
            <div class="nav-container">
                <a href="control" class="nav-link">
                    <i class="fas fa-cogs"></i>
                    <span>Steuerung</span>
                    <span class="new-feature">NEU</span>
                </a>
                
                <a href="navi" class="nav-link">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Navigation</span>
                </a>
                
                <a href="admin" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                
                <a href="products" class="nav-link">
                    <i class="fas fa-box"></i>
                    <span>Produktverwaltung</span>
                </a>
                
                <a href="index" class="nav-link">
                    <i class="fas fa-cash-register"></i>
                    <span>Kassenansicht</span>
                </a>
                
                <a href="archive" class="nav-link">
                    <i class="fas fa-archive"></i>
                    <span>Archiv</span>
                </a>
                
                <a href="merchant" class="nav-link">
                    <i class="fas fa-store"></i>
                    <span>Händleransicht</span>
                </a>
                
                <a href="analytics" class="nav-link">
                    <i class="fas fa-chart-line"></i>
                    <span>Analysen</span>
                </a>
                
                <a href="settings" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>Einstellungen</span>
                </a>
            </div>
        </aside>
        
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <main class="admin-content">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Dashboard</h1>
                <p class="dashboard-subtitle">Übersicht über Ihr Geschäft</p>
            </div>

            <div class="dashboard-grid">
                <!-- Stat Cards -->
                <div class="dashboard-card card-small stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <div class="stat-value" id="today-revenue">€0.00</div>
                    <div class="stat-label">Umsatz heute</div>
                    <div class="stat-change" id="today-revenue-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>0%</span>
                    </div>
                </div>

                <div class="dashboard-card card-small stat-card positive">
                    <div class="stat-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-value" id="today-orders">0</div>
                    <div class="stat-label">Bestellungen heute</div>
                    <div class="stat-change" id="today-orders-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>0%</span>
                    </div>
                </div>

                <div class="dashboard-card card-small stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <div class="stat-value" id="low-stock-count">0</div>
                    <div class="stat-label">Niedriger Lagerbestand</div>
                    <div class="stat-change">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Zu überprüfen</span>
                    </div>
                </div>

                <div class="dashboard-card card-small stat-card danger">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="new-customers">0</div>
                    <div class="stat-label">Neue Kunden</div>
                    <div class="stat-change" id="new-customers-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>0%</span>
                    </div>
                </div>

                <!-- Revenue Chart -->
                <div class="dashboard-card card-large">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Umsatzentwicklung
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="revenue-week">
                                <i class="fas fa-calendar-week"></i>
                            </button>
                            <button class="card-action-btn" id="revenue-month">
                                <i class="fas fa-calendar-alt"></i>
                            </button>
                            <button class="card-action-btn" id="revenue-year">
                                <i class="fas fa-calendar"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenue-chart"></canvas>
                    </div>
                </div>

                <!-- Monthly Goals -->
                <div class="dashboard-card card-medium">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-bullseye"></i>
                            Monatsziele
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="edit-goals">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                    <div class="goal-progress" id="goals-container">
                        <!-- Goals will be populated here -->
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="dashboard-card card-medium">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-history"></i>
                            Letzte Aktivitäten
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="refresh-activities">
                                <i class="fas fa-sync"></i>
                            </button>
                        </div>
                    </div>
                    <div class="activity-list" id="activities-container">
                        <!-- Activities will be populated here -->
                    </div>
                </div>

                <!-- Top Products -->
                <div class="dashboard-card card-medium">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-star"></i>
                            Top-Produkte
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="view-all-products">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product-list" id="top-products-container">
                        <!-- Top products will be populated here -->
                    </div>
                </div>

                <!-- Low Stock Alert -->
                <div class="dashboard-card card-medium">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Niedriger Lagerbestand
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="view-low-stock">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product-list" id="low-stock-container">
                        <!-- Low stock products will be populated here -->
                    </div>
                </div>

                <!-- Task Manager -->
                <div class="dashboard-card card-large">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-tasks"></i>
                            Aufgaben-Manager
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="add-task">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="task-list" id="tasks-container">
                        <!-- Tasks will be populated here -->
                    </div>
                </div>

                <!-- AI Assistant -->
                <div class="dashboard-card card-large ai-assistant">
                    <div class="ai-header">
                        <div class="ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div class="ai-title">KI-Assistent</div>
                            <div class="ai-subtitle">Fragen Sie mich nach Ihren Geschäftsdaten</div>
                        </div>
                    </div>
                    <div class="ai-messages" id="ai-messages">
                        <div class="ai-message assistant">
                            Hallo! Ich bin Ihr KI-Assistent. Wie kann ich Ihnen helfen?
                        </div>
                    </div>
                    <div class="ai-input-container">
                        <input type="text" class="ai-input" id="ai-input" placeholder="Stellen Sie eine Frage...">
                        <button class="ai-send-btn" id="ai-send">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="dashboard-card card-medium">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-bolt"></i>
                            Schnellaktionen
                        </h2>
                    </div>
                    <div class="quick-actions">
                        <div class="action-btn" id="quick-sale">
                            <div class="action-icon">
                                <i class="fas fa-cash-register"></i>
                            </div>
                            <div class="action-label">Verkauf</div>
                        </div>
                        <div class="action-btn" id="quick-product">
                            <div class="action-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="action-label">Produkt hinzufügen</div>
                        </div>
                        <div class="action-btn" id="quick-customer">
                            <div class="action-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="action-label">Kunde hinzufügen</div>
                        </div>
                        <div class="action-btn" id="quick-report">
                            <div class="action-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="action-label">Bericht erstellen</div>
                        </div>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="dashboard-card card-medium">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-bell"></i>
                            Benachrichtigungen
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="mark-all-read">
                                <i class="fas fa-check-double"></i>
                            </button>
                        </div>
                    </div>
                    <div class="notifications-list" id="notifications-container">
                        <!-- Notifications will be populated here -->
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="dashboard-card card-full">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Leistungsmetriken
                        </h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="export-metrics">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="metrics-chart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Goals Modal -->
    <div class="modal-overlay" id="goals-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Monatsziele bearbeiten</h2>
                <button class="close-modal" id="close-goals-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="revenue-goal">Umsatz-Ziel (€)</label>
                    <input type="number" class="form-control" id="revenue-goal" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label" for="orders-goal">Bestellungen-Ziel</label>
                    <input type="number" class="form-control" id="orders-goal" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label" for="customers-goal">Neue Kunden-Ziel</label>
                    <input type="number" class="form-control" id="customers-goal" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label" for="products-goal">Produkte verkauft-Ziel</label>
                    <input type="number" class="form-control" id="products-goal" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-goals">Abbrechen</button>
                <button class="btn btn-primary" id="save-goals">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Aufgabe hinzufügen</h2>
                <button class="close-modal" id="close-task-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="task-title">Titel</label>
                    <input type="text" class="form-control" id="task-title" placeholder="Titel der Aufgabe">
                </div>
                <div class="form-group">
                    <label class="form-label" for="task-description">Beschreibung</label>
                    <textarea class="form-textarea" id="task-description" placeholder="Beschreibung der Aufgabe"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="task-priority">Priorität</label>
                    <select class="form-select" id="task-priority">
                        <option value="low">Niedrig</option>
                        <option value="medium">Mittel</option>
                        <option value="high">Hoch</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="task-due-date">Fälligkeitsdatum</label>
                    <input type="date" class="form-control" id="task-due-date">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-task">Abbrechen</button>
                <button class="btn btn-primary" id="save-task">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Quick Sale Modal -->
    <div class="modal-overlay" id="sale-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Schnellverkauf</h2>
                <button class="close-modal" id="close-sale-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="sale-product">Produkt</label>
                    <select class="form-select" id="sale-product">
                        <!-- Products will be populated here -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sale-quantity">Menge</label>
                    <input type="number" class="form-control" id="sale-quantity" min="1" value="1">
                </div>
                <div class="form-group">
                    <label class="form-label" for="sale-customer">Kunde (optional)</label>
                    <input type="text" class="form-control" id="sale-customer" placeholder="Kundenname">
                </div>
                <div class="form-group">
                    <label class="form-label" for="sale-payment">Zahlungsmethode</label>
                    <select class="form-select" id="sale-payment">
                        <option value="cash">Bar</option>
                        <option value="card">Karte</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-sale">Abbrechen</button>
                <button class="btn btn-primary" id="process-sale">Verkauf abschließen</button>
            </div>
        </div>
    </div>

    <!-- Quick Product Modal -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Produkt hinzufügen</h2>
                <button class="close-modal" id="close-product-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="product-name">Produktname</label>
                    <input type="text" class="form-control" id="product-name" placeholder="Produktname">
                </div>
                <div class="form-group">
                    <label class="form-label" for="product-price">Preis (€)</label>
                    <input type="number" class="form-control" id="product-price" min="0" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label" for="product-stock">Lagerbestand</label>
                    <input type="number" class="form-control" id="product-stock" min="0" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label" for="product-barcode">Barcode (optional)</label>
                    <input type="text" class="form-control" id="product-barcode" placeholder="Barcode">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-product">Abbrechen</button>
                <button class="btn btn-primary" id="save-product">Speichern</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== DASHBOARD MANAGER ====================
        const DashboardManager = (function() {
            // Data storage keys
            const KEY_GOALS = 'dashboard_goals';
            const KEY_TASKS = 'dashboard_tasks';
            const KEY_ACTIVITIES = 'dashboard_activities';
            const KEY_NOTIFICATIONS = 'dashboard_notifications';
            const KEY_AI_CONVERSATION = 'dashboard_ai_conversation';
            const KEY_DASHBOARD_SETTINGS = 'dashboard_settings';
            
            // Initialize dashboard
            function init() {
                // Initialize default data if not exists
                initDefaultData();
                
                // Load and display all dashboard components
                loadDashboardData();
                
                // Set up auto-refresh
                setInterval(loadDashboardData, 30000); // Refresh every 30 seconds
            }
            
            // Initialize default data
            function initDefaultData() {
                // Goals
                if (!localStorage.getItem(KEY_GOALS)) {
                    const defaultGoals = {
                        revenue: 10000,
                        orders: 200,
                        customers: 50,
                        products: 500,
                        month: new Date().getMonth(),
                        year: new Date().getFullYear()
                    };
                    localStorage.setItem(KEY_GOALS, JSON.stringify(defaultGoals));
                }
                
                // Tasks
                if (!localStorage.getItem(KEY_TASKS)) {
                    const defaultTasks = [
                        {
                            id: generateId(),
                            title: 'Lagerbestand überprüfen',
                            description: 'Alle Produkte mit niedrigem Lagerbestand überprüfen und nachbestellen',
                            priority: 'high',
                            dueDate: new Date(Date.now() + 86400000).toISOString().split('T')[0], // Tomorrow
                            completed: false,
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: generateId(),
                            title: 'Monatsbericht erstellen',
                            description: 'Monatlichen Umsatzbericht für das Management erstellen',
                            priority: 'medium',
                            dueDate: new Date(Date.now() + 259200000).toISOString().split('T')[0], // 3 days
                            completed: false,
                            createdAt: new Date().toISOString()
                        }
                    ];
                    localStorage.setItem(KEY_TASKS, JSON.stringify(defaultTasks));
                }
                
                // Notifications
                if (!localStorage.getItem(KEY_NOTIFICATIONS)) {
                    const defaultNotifications = [
                        {
                            id: generateId(),
                            title: 'Willkommen bei Gittertier Pro!',
                            description: 'Ihr Dashboard wurde erfolgreich eingerichtet.',
                            type: 'info',
                            read: false,
                            timestamp: new Date().toISOString()
                        }
                    ];
                    localStorage.setItem(KEY_NOTIFICATIONS, JSON.stringify(defaultNotifications));
                }
                
                // AI Conversation
                if (!localStorage.getItem(KEY_AI_CONVERSATION)) {
                    const defaultConversation = [
                        {
                            role: 'assistant',
                            content: 'Hallo! Ich bin Ihr KI-Assistent. Wie kann ich Ihnen helfen?',
                            timestamp: new Date().toISOString()
                        }
                    ];
                    localStorage.setItem(KEY_AI_CONVERSATION, JSON.stringify(defaultConversation));
                }
            }
            
            // Generate unique ID
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            // Load and display all dashboard data
            function loadDashboardData() {
                updateStats();
                updateRevenueChart();
                updateGoals();
                updateActivities();
                updateTopProducts();
                updateLowStock();
                updateTasks();
                updateNotifications();
                updatePerformanceMetrics();
            }
            
            // Update statistics cards
            function updateStats() {
                // Get data from other pages
                const products = getProducts();
                const receipts = getReceipts();
                const customers = getCustomers();
                
                // Calculate today's date
                const today = new Date().toISOString().split('T')[0];
                
                // Calculate today's revenue and orders
                let todayRevenue = 0;
                let todayOrders = 0;
                
                receipts.forEach(receipt => {
                    const receiptDate = new Date(receipt.date).toISOString().split('T')[0];
                    if (receiptDate === today && receipt.status === 'Bestätigt') {
                        todayRevenue += receipt.amount;
                        todayOrders++;
                    }
                });
                
                // Calculate yesterday's date
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                let yesterdayRevenue = 0;
                let yesterdayOrders = 0;
                
                receipts.forEach(receipt => {
                    const receiptDate = new Date(receipt.date).toISOString().split('T')[0];
                    if (receiptDate === yesterday && receipt.status === 'Bestätigt') {
                        yesterdayRevenue += receipt.amount;
                        yesterdayOrders++;
                    }
                });
                
                // Calculate revenue change
                let revenueChange = 0;
                if (yesterdayRevenue > 0) {
                    revenueChange = ((todayRevenue - yesterdayRevenue) / yesterdayRevenue) * 100;
                }
                
                // Calculate orders change
                let ordersChange = 0;
                if (yesterdayOrders > 0) {
                    ordersChange = ((todayOrders - yesterdayOrders) / yesterdayOrders) * 100;
                }
                
                // Count low stock products
                let lowStockCount = 0;
                products.forEach(product => {
                    if (product.stock < 10) {
                        lowStockCount++;
                    }
                });
                
                // Count new customers this month
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                let newCustomers = 0;
                
                customers.forEach(customer => {
                    const customerDate = new Date(customer.createdAt || customer.date);
                    if (customerDate.getMonth() === currentMonth && customerDate.getFullYear() === currentYear) {
                        newCustomers++;
                    }
                });
                
                // Update DOM
                document.getElementById('today-revenue').textContent = `€${todayRevenue.toFixed(2)}`;
                document.getElementById('today-orders').textContent = todayOrders;
                document.getElementById('low-stock-count').textContent = lowStockCount;
                document.getElementById('new-customers').textContent = newCustomers;
                
                // Update changes
                const revenueChangeElement = document.getElementById('today-revenue-change');
                revenueChangeElement.innerHTML = `
                    <i class="fas fa-arrow-${revenueChange >= 0 ? 'up' : 'down'}"></i>
                    <span>${Math.abs(revenueChange).toFixed(1)}%</span>
                `;
                
                const ordersChangeElement = document.getElementById('today-orders-change');
                ordersChangeElement.innerHTML = `
                    <i class="fas fa-arrow-${ordersChange >= 0 ? 'up' : 'down'}"></i>
                    <span>${Math.abs(ordersChange).toFixed(1)}%</span>
                `;
                
                const customersChangeElement = document.getElementById('new-customers-change');
                // For demo purposes, we'll set a fixed change for customers
                customersChangeElement.innerHTML = `
                    <i class="fas fa-arrow-up"></i>
                    <span>12.5%</span>
                `;
            }
            
            // Update revenue chart
            function updateRevenueChart() {
                const receipts = getReceipts();
                const ctx = document.getElementById('revenue-chart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (window.revenueChart) {
                    window.revenueChart.destroy();
                }
                
                // Calculate revenue by day for the last 7 days
                const dates = [];
                const revenues = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateString = date.toISOString().split('T')[0];
                    dates.push(date.toLocaleDateString('de-DE', { weekday: 'short', day: 'numeric' }));
                    
                    let dailyRevenue = 0;
                    receipts.forEach(receipt => {
                        const receiptDate = new Date(receipt.date).toISOString().split('T')[0];
                        if (receiptDate === dateString && receipt.status === 'Bestätigt') {
                            dailyRevenue += receipt.amount;
                        }
                    });
                    
                    revenues.push(dailyRevenue);
                }
                
                // Create chart
                window.revenueChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Umsatz (€)',
                            data: revenues,
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '€' + value;
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
            
            // Update goals progress
            function updateGoals() {
                const goals = JSON.parse(localStorage.getItem(KEY_GOALS) || '{}');
                const receipts = getReceipts();
                const customers = getCustomers();
                const products = getProducts();
                
                // Calculate current month stats
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                let monthRevenue = 0;
                let monthOrders = 0;
                let monthCustomers = 0;
                let monthProductsSold = 0;
                
                receipts.forEach(receipt => {
                    const receiptDate = new Date(receipt.date);
                    if (receiptDate.getMonth() === currentMonth && 
                        receiptDate.getFullYear() === currentYear && 
                        receipt.status === 'Bestätigt') {
                        monthRevenue += receipt.amount;
                        monthOrders++;
                        
                        // Count products sold
                        if (receipt.items) {
                            receipt.items.forEach(item => {
                                monthProductsSold += item.quantity;
                            });
                        }
                    }
                });
                
                // Count new customers this month
                customers.forEach(customer => {
                    const customerDate = new Date(customer.createdAt || customer.date);
                    if (customerDate.getMonth() === currentMonth && customerDate.getFullYear() === currentYear) {
                        monthCustomers++;
                    }
                });
                
                // Calculate progress percentages
                const revenueProgress = Math.min((monthRevenue / goals.revenue) * 100, 100);
                const ordersProgress = Math.min((monthOrders / goals.orders) * 100, 100);
                const customersProgress = Math.min((monthCustomers / goals.customers) * 100, 100);
                const productsProgress = Math.min((monthProductsSold / goals.products) * 100, 100);
                
                // Determine progress bar class
                function getProgressClass(progress) {
                    if (progress >= 80) return 'positive';
                    if (progress >= 50) return 'warning';
                    return 'danger';
                }
                
                // Update DOM
                const goalsContainer = document.getElementById('goals-container');
                goalsContainer.innerHTML = `
                    <div class="goal-item">
                        <div class="goal-info">
                            <div class="goal-title">Umsatz-Ziel</div>
                            <div class="goal-description">Monatliches Umsatzziel erreichen</div>
                            <div class="goal-progress-bar">
                                <div class="goal-progress-fill ${getProgressClass(revenueProgress)}" style="width: ${revenueProgress}%"></div>
                            </div>
                            <div class="goal-stats">
                                <span class="goal-current">€${monthRevenue.toFixed(2)}</span>
                                <span class="goal-target">von €${goals.revenue}</span>
                            </div>
                        </div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-info">
                            <div class="goal-title">Bestellungen-Ziel</div>
                            <div class="goal-description">Anzahl der Bestellungen pro Monat</div>
                            <div class="goal-progress-bar">
                                <div class="goal-progress-fill ${getProgressClass(ordersProgress)}" style="width: ${ordersProgress}%"></div>
                            </div>
                            <div class="goal-stats">
                                <span class="goal-current">${monthOrders}</span>
                                <span class="goal-target">von ${goals.orders}</span>
                            </div>
                        </div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-info">
                            <div class="goal-title">Neue Kunden</div>
                            <div class="goal-description">Neue Kunden in diesem Monat</div>
                            <div class="goal-progress-bar">
                                <div class="goal-progress-fill ${getProgressClass(customersProgress)}" style="width: ${customersProgress}%"></div>
                            </div>
                            <div class="goal-stats">
                                <span class="goal-current">${monthCustomers}</span>
                                <span class="goal-target">von ${goals.customers}</span>
                            </div>
                        </div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-info">
                            <div class="goal-title">Produkte verkauft</div>
                            <div class="goal-description">Gesamtzahl verkaufter Produkte</div>
                            <div class="goal-progress-bar">
                                <div class="goal-progress-fill ${getProgressClass(productsProgress)}" style="width: ${productsProgress}%"></div>
                            </div>
                            <div class="goal-stats">
                                <span class="goal-current">${monthProductsSold}</span>
                                <span class="goal-target">von ${goals.products}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Update recent activities
            function updateActivities() {
                const activities = JSON.parse(localStorage.getItem(KEY_ACTIVITIES) || '[]');
                const receipts = getReceipts();
                
                // If no activities, generate some from receipts
                if (activities.length === 0) {
                    // Generate activities from recent receipts
                    const recentReceipts = receipts
                        .filter(receipt => receipt.status === 'Bestätigt')
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5);
                    
                    recentReceipts.forEach(receipt => {
                        activities.push({
                            id: generateId(),
                            title: 'Verkauf abgeschlossen',
                            description: `Verkauf von €${receipt.amount.toFixed(2)} an ${receipt.customerName || 'Kunde'}`,
                            icon: 'fas fa-shopping-cart',
                            timestamp: receipt.date
                        });
                    });
                    
                    // Save generated activities
                    localStorage.setItem(KEY_ACTIVITIES, JSON.stringify(activities));
                }
                
                // Sort activities by timestamp (newest first)
                activities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Update DOM
                const activitiesContainer = document.getElementById('activities-container');
                activitiesContainer.innerHTML = '';
                
                activities.slice(0, 5).forEach(activity => {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'activity-item';
                    activityElement.innerHTML = `
                        <div class="activity-icon">
                            <i class="${activity.icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-description">${activity.description}</div>
                            <div class="activity-time">${formatTimeAgo(new Date(activity.timestamp))}</div>
                        </div>
                    `;
                    activitiesContainer.appendChild(activityElement);
                });
            }
            
            // Update top products
            function updateTopProducts() {
                const products = getProducts();
                const receipts = getReceipts();
                
                // Calculate product sales
                const productSales = {};
                
                receipts.forEach(receipt => {
                    if (receipt.status === 'Bestätigt' && receipt.items) {
                        receipt.items.forEach(item => {
                            if (!productSales[item.barcode]) {
                                productSales[item.barcode] = {
                                    name: item.name,
                                    quantity: 0,
                                    revenue: 0
                                };
                            }
                            
                            productSales[item.barcode].quantity += item.quantity;
                            productSales[item.barcode].revenue += item.quantity * item.price;
                        });
                    }
                });
                
                // Convert to array and sort by revenue
                const topProducts = Object.values(productSales)
                    .sort((a, b) => b.revenue - a.revenue)
                    .slice(0, 5);
                
                // Update DOM
                const topProductsContainer = document.getElementById('top-products-container');
                topProductsContainer.innerHTML = '';
                
                if (topProducts.length === 0) {
                    topProductsContainer.innerHTML = '<div class="empty-state">Keine Verkaufsdaten verfügbar</div>';
                    return;
                }
                
                topProducts.forEach(product => {
                    const productElement = document.createElement('div');
                    productElement.className = 'product-item';
                    productElement.innerHTML = `
                        <div class="product-image">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-details">
                                <span>${product.quantity} verkauft</span>
                                <span>€${product.revenue.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                    topProductsContainer.appendChild(productElement);
                });
            }
            
            // Update low stock products
            function updateLowStock() {
                const products = getProducts();
                
                // Filter low stock products
                const lowStockProducts = products
                    .filter(product => product.stock < 10)
                    .sort((a, b) => a.stock - b.stock)
                    .slice(0, 5);
                
                // Update DOM
                const lowStockContainer = document.getElementById('low-stock-container');
                lowStockContainer.innerHTML = '';
                
                if (lowStockProducts.length === 0) {
                    lowStockContainer.innerHTML = '<div class="empty-state">Keine Produkte mit niedrigem Lagerbestand</div>';
                    return;
                }
                
                lowStockProducts.forEach(product => {
                    const stockClass = product.stock < 5 ? 'low' : product.stock < 10 ? 'medium' : 'high';
                    
                    const productElement = document.createElement('div');
                    productElement.className = 'product-item';
                    productElement.innerHTML = `
                        <div class="product-image">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-details">
                                <div class="product-stock">
                                    <span class="stock-indicator ${stockClass}"></span>
                                    <span>${product.stock} auf Lager</span>
                                </div>
                                <span>€${product.price.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                    lowStockContainer.appendChild(productElement);
                });
            }
            
            // Update tasks
            function updateTasks() {
                const tasks = JSON.parse(localStorage.getItem(KEY_TASKS) || '[]');
                
                // Filter incomplete tasks and sort by priority and due date
                const incompleteTasks = tasks
                    .filter(task => !task.completed)
                    .sort((a, b) => {
                        // Sort by priority (high > medium > low)
                        const priorityOrder = { high: 3, medium: 2, low: 1 };
                        if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                            return priorityOrder[b.priority] - priorityOrder[a.priority];
                        }
                        
                        // Then by due date (earlier first)
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    });
                
                // Update DOM
                const tasksContainer = document.getElementById('tasks-container');
                tasksContainer.innerHTML = '';
                
                if (incompleteTasks.length === 0) {
                    tasksContainer.innerHTML = '<div class="empty-state">Keine offenen Aufgaben</div>';
                    return;
                }
                
                incompleteTasks.slice(0, 5).forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = 'task-item';
                    taskElement.innerHTML = `
                        <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-task-id="${task.id}">
                            ${task.completed ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                            <div class="task-description">${task.description}</div>
                            <div class="task-meta">
                                <span class="task-priority ${task.priority}">${getPriorityLabel(task.priority)}</span>
                                <span>Fällig: ${formatDate(new Date(task.dueDate))}</span>
                            </div>
                        </div>
                    `;
                    tasksContainer.appendChild(taskElement);
                });
                
                // Add event listeners to task checkboxes
                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', function() {
                        const taskId = this.getAttribute('data-task-id');
                        toggleTaskCompletion(taskId);
                    });
                });
            }
            
            // Update notifications
            function updateNotifications() {
                const notifications = JSON.parse(localStorage.getItem(KEY_NOTIFICATIONS) || '[]');
                
                // Filter unread notifications and sort by timestamp
                const unreadNotifications = notifications
                    .filter(notification => !notification.read)
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Update DOM
                const notificationsContainer = document.getElementById('notifications-container');
                notificationsContainer.innerHTML = '';
                
                if (unreadNotifications.length === 0) {
                    notificationsContainer.innerHTML = '<div class="empty-state">Keine neuen Benachrichtigungen</div>';
                    return;
                }
                
                unreadNotifications.slice(0, 5).forEach(notification => {
                    const notificationElement = document.createElement('div');
                    notificationElement.className = 'notification-item';
                    notificationElement.innerHTML = `
                        <div class="notification-icon ${notification.type}">
                            <i class="fas fa-${getNotificationIcon(notification.type)}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-description">${notification.description}</div>
                            <div class="notification-time">${formatTimeAgo(new Date(notification.timestamp))}</div>
                        </div>
                    `;
                    notificationsContainer.appendChild(notificationElement);
                });
            }
            
            // Update performance metrics
            function updatePerformanceMetrics() {
                const ctx = document.getElementById('metrics-chart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (window.metricsChart) {
                    window.metricsChart.destroy();
                }
                
                // Get data for metrics
                const products = getProducts();
                const receipts = getReceipts();
                
                // Calculate metrics
                const totalProducts = products.length;
                const lowStockProducts = products.filter(p => p.stock < 10).length;
                const outOfStockProducts = products.filter(p => p.stock === 0).length;
                
                const totalReceipts = receipts.length;
                const confirmedReceipts = receipts.filter(r => r.status === 'Bestätigt').length;
                const declinedReceipts = receipts.filter(r => r.status === 'Abgelehnt').length;
                
                // Create chart
                window.metricsChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Produkte auf Lager', 'Niedriger Lagerbestand', 'Nicht auf Lager', 'Bestätigte Verkäufe', 'Abgelehnte Verkäufe'],
                        datasets: [{
                            data: [totalProducts - lowStockProducts - outOfStockProducts, lowStockProducts, outOfStockProducts, confirmedReceipts, declinedReceipts],
                            backgroundColor: [
                                '#10b981',
                                '#f59e0b',
                                '#ef4444',
                                '#2563eb',
                                '#6b7280'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }
            
            // Get products from localStorage
            function getProducts() {
                try {
                    // Try to get products from the products page storage
                    const productsData = localStorage.getItem('products');
                    if (productsData) {
                        return JSON.parse(productsData);
                    }
                    
                    // Fallback: get products with product_ prefix
                    const products = {};
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('product_')) {
                            try {
                                const product = JSON.parse(localStorage.getItem(key));
                                products[product.barcode] = product;
                            } catch (e) {
                                console.error('Error parsing product:', e);
                            }
                        }
                    }
                    return Object.values(products);
                } catch (error) {
                    console.error('Error getting products:', error);
                    return [];
                }
            }
            
            // Get receipts from localStorage
            function getReceipts() {
                try {
                    // Try to get receipts from the archive page storage
                    const receiptsData = localStorage.getItem('payment_archive');
                    if (receiptsData) {
                        return JSON.parse(receiptsData);
                    }
                    
                    // Fallback: get receipts with receipt_ prefix
                    const receipts = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('receipt_')) {
                            try {
                                const receipt = JSON.parse(localStorage.getItem(key));
                                receipts.push(receipt);
                            } catch (e) {
                                console.error('Error parsing receipt:', e);
                            }
                        }
                    }
                    return receipts;
                } catch (error) {
                    console.error('Error getting receipts:', error);
                    return [];
                }
            }
            
            // Get customers from localStorage
            function getCustomers() {
                try {
                    // Try to get customers from localStorage
                    const customersData = localStorage.getItem('customers');
                    if (customersData) {
                        return JSON.parse(customersData);
                    }
                    
                    // Fallback: get customers with customer_ prefix
                    const customers = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('customer_')) {
                            try {
                                const customer = JSON.parse(localStorage.getItem(key));
                                customers.push(customer);
                            } catch (e) {
                                console.error('Error parsing customer:', e);
                            }
                        }
                    }
                    return customers;
                } catch (error) {
                    console.error('Error getting customers:', error);
                    return [];
                }
            }
            
            // Format time ago
            function formatTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) {
                    return 'Gerade eben';
                } else if (diffMins < 60) {
                    return `Vor ${diffMins} Minuten`;
                } else if (diffHours < 24) {
                    return `Vor ${diffHours} Stunden`;
                } else if (diffDays < 7) {
                    return `Vor ${diffDays} Tagen`;
                } else {
                    return date.toLocaleDateString('de-DE');
                }
            }
            
            // Format date
            function formatDate(date) {
                return date.toLocaleDateString('de-DE');
            }
            
            // Get priority label
            function getPriorityLabel(priority) {
                const labels = {
                    high: 'Hoch',
                    medium: 'Mittel',
                    low: 'Niedrig'
                };
                return labels[priority] || priority;
            }
            
            // Get notification icon
            function getNotificationIcon(type) {
                const icons = {
                    info: 'info-circle',
                    success: 'check-circle',
                    warning: 'exclamation-triangle',
                    error: 'exclamation-circle'
                };
                return icons[type] || 'bell';
            }
            
            // Toggle task completion
            function toggleTaskCompletion(taskId) {
                const tasks = JSON.parse(localStorage.getItem(KEY_TASKS) || '[]');
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                
                if (taskIndex !== -1) {
                    tasks[taskIndex].completed = !tasks[taskIndex].completed;
                    localStorage.setItem(KEY_TASKS, JSON.stringify(tasks));
                    updateTasks();
                    
                    // Add activity
                    addActivity(
                        `Aufgabe "${tasks[taskIndex].title}" ${tasks[taskIndex].completed ? 'abgeschlossen' : 'wiedereröffnet'}`,
                        'fas fa-check-circle'
                    );
                }
            }
            
            // Add activity
            function addActivity(title, icon) {
                const activities = JSON.parse(localStorage.getItem(KEY_ACTIVITIES) || '[]');
                activities.push({
                    id: generateId(),
                    title: title,
                    description: '',
                    icon: icon,
                    timestamp: new Date().toISOString()
                });
                
                // Keep only the last 50 activities
                if (activities.length > 50) {
                    activities.splice(0, activities.length - 50);
                }
                
                localStorage.setItem(KEY_ACTIVITIES, JSON.stringify(activities));
                updateActivities();
            }
            
            // Add notification
            function addNotification(title, description, type = 'info') {
                const notifications = JSON.parse(localStorage.getItem(KEY_NOTIFICATIONS) || '[]');
                notifications.push({
                    id: generateId(),
                    title: title,
                    description: description,
                    type: type,
                    read: false,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem(KEY_NOTIFICATIONS, JSON.stringify(notifications));
                updateNotifications();
            }
            
            // Mark all notifications as read
            function markAllNotificationsRead() {
                const notifications = JSON.parse(localStorage.getItem(KEY_NOTIFICATIONS) || '[]');
                notifications.forEach(notification => {
                    notification.read = true;
                });
                
                localStorage.setItem(KEY_NOTIFICATIONS, JSON.stringify(notifications));
                updateNotifications();
            }
            
            // Save goals
            function saveGoals(revenue, orders, customers, products) {
                const goals = {
                    revenue: parseFloat(revenue),
                    orders: parseInt(orders),
                    customers: parseInt(customers),
                    products: parseInt(products),
                    month: new Date().getMonth(),
                    year: new Date().getFullYear()
                };
                
                localStorage.setItem(KEY_GOALS, JSON.stringify(goals));
                updateGoals();
                
                // Add activity
                addActivity('Monatsziele aktualisiert', 'fas fa-bullseye');
                
                // Add notification
                addNotification(
                    'Ziele aktualisiert',
                    'Ihre Monatsziele wurden erfolgreich aktualisiert.',
                    'success'
                );
            }
            
            // Add task
            function addTask(title, description, priority, dueDate) {
                const tasks = JSON.parse(localStorage.getItem(KEY_TASKS) || '[]');
                tasks.push({
                    id: generateId(),
                    title: title,
                    description: description,
                    priority: priority,
                    dueDate: dueDate,
                    completed: false,
                    createdAt: new Date().toISOString()
                });
                
                localStorage.setItem(KEY_TASKS, JSON.stringify(tasks));
                updateTasks();
                
                // Add activity
                addActivity(`Aufgabe "${title}" hinzugefügt`, 'fas fa-tasks');
            }
            
            // Process quick sale
            function processQuickSale(productBarcode, quantity, customer, paymentMethod) {
                const products = getProducts();
                const product = products.find(p => p.barcode === productBarcode);
                
                if (!product) {
                    alert('Produkt nicht gefunden');
                    return;
                }
                
                // Create receipt
                const receipt = {
                    id: generateId(),
                    date: new Date().toISOString(),
                    amount: product.price * quantity,
                    status: 'Bestätigt',
                    items: [
                        {
                            name: product.name,
                            quantity: quantity,
                            price: product.price,
                            barcode: product.barcode
                        }
                    ],
                    customerName: customer || 'Kunde',
                    paymentMethod: paymentMethod,
                    source: 'dashboard'
                };
                
                // Save receipt
                const receipts = getReceipts();
                receipts.push(receipt);
                
                // Update product stock
                product.stock -= quantity;
                
                // Save products (simplified - in a real app, we'd use the proper storage method)
                try {
                    localStorage.setItem('payment_archive', JSON.stringify(receipts));
                    
                    // Update product in storage
                    const productKey = `product_${product.barcode}`;
                    localStorage.setItem(productKey, JSON.stringify(product));
                } catch (error) {
                    console.error('Error saving sale:', error);
                }
                
                // Update dashboard
                loadDashboardData();
                
                // Add activity
                addActivity(
                    `Schnellverkauf: ${quantity}x ${product.name} an ${customer || 'Kunde'}`,
                    'fas fa-cash-register'
                );
                
                // Add notification
                addNotification(
                    'Verkauf abgeschlossen',
                    `Verkauf von ${quantity}x ${product.name} für €${(product.price * quantity).toFixed(2)}`,
                    'success'
                );
            }
            
            // Add product
            function addProduct(name, price, stock, barcode) {
                const products = getProducts();
                
                // Create product
                const product = {
                    name: name,
                    price: parseFloat(price),
                    stock: parseInt(stock),
                    barcode: barcode || generateId(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Add to products
                products.push(product);
                
                // Save products (simplified - in a real app, we'd use the proper storage method)
                try {
                    localStorage.setItem('products', JSON.stringify(products));
                    
                    // Also save with product_ prefix for compatibility
                    const productKey = `product_${product.barcode}`;
                    localStorage.setItem(productKey, JSON.stringify(product));
                } catch (error) {
                    console.error('Error saving product:', error);
                }
                
                // Update dashboard
                loadDashboardData();
                
                // Add activity
                addActivity(`Produkt "${name}" hinzugefügt`, 'fas fa-box');
                
                // Add notification
                addNotification(
                    'Produkt hinzugefügt',
                    `Das Produkt "${name}" wurde erfolgreich hinzugefügt.`,
                    'success'
                );
            }
            
            // AI Assistant response
            function getAIResponse(message) {
                const products = getProducts();
                const receipts = getReceipts();
                const customers = getCustomers();
                
                // Simple AI responses based on keywords
                message = message.toLowerCase();
                
                if (message.includes('hallo') || message.includes('hi') || message.includes('guten tag')) {
                    return 'Hallo! Wie kann ich Ihnen helfen?';
                }
                
                if (message.includes('umsatz') || message.includes('einnahmen')) {
                    const today = new Date().toISOString().split('T')[0];
                    let todayRevenue = 0;
                    
                    receipts.forEach(receipt => {
                        const receiptDate = new Date(receipt.date).toISOString().split('T')[0];
                        if (receiptDate === today && receipt.status === 'Bestätigt') {
                            todayRevenue += receipt.amount;
                        }
                    });
                    
                    return `Der heutige Umsatz beträgt €${todayRevenue.toFixed(2)}.`;
                }
                
                if (message.includes('bestellung') || message.includes('verkauf')) {
                    const today = new Date().toISOString().split('T')[0];
                    let todayOrders = 0;
                    
                    receipts.forEach(receipt => {
                        const receiptDate = new Date(receipt.date).toISOString().split('T')[0];
                        if (receiptDate === today && receipt.status === 'Bestätigt') {
                            todayOrders++;
                        }
                    });
                    
                    return `Heute haben Sie ${todayOrders} Bestellungen erhalten.`;
                }
                
                if (message.includes('produkt') || message.includes('lager')) {
                    const totalProducts = products.length;
                    const lowStockProducts = products.filter(p => p.stock < 10).length;
                    const outOfStockProducts = products.filter(p => p.stock === 0).length;
                    
                    return `Sie haben ${totalProducts} Produkte im System. ${lowStockProducts} haben niedrigen Lagerbestand und ${outOfStockProducts} sind nicht auf Lager.`;
                }
                
                if (message.includes('kunde') || message.includes('kunden')) {
                    const totalCustomers = customers.length;
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    let newCustomers = 0;
                    
                    customers.forEach(customer => {
                        const customerDate = new Date(customer.createdAt || customer.date);
                        if (customerDate.getMonth() === currentMonth && customerDate.getFullYear() === currentYear) {
                            newCustomers++;
                        }
                    });
                    
                    return `Sie haben ${totalCustomers} Kunden im System. ${newCustomers} neue Kunden in diesem Monat.`;
                }
                
                if (message.includes('hilfe') || message.includes('unterstützung')) {
                    return 'Ich kann Ihnen helfen mit: Umsatz, Bestellungen, Produkte, Kunden, Lagerbestand und allgemeinen Fragen zu Ihrem Geschäft.';
                }
                
                return 'Entschuldigung, ich verstehe Ihre Frage nicht. Bitte fragen Sie nach Umsatz, Bestellungen, Produkten oder Kunden.';
            }
            
            // Public API
            return {
                init,
                saveGoals,
                addTask,
                processQuickSale,
                addProduct,
                markAllNotificationsRead,
                getAIResponse
            };
        })();

        // ==================== DASHBOARD INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dashboard
            DashboardManager.init();
            
            // Apply dark mode if enabled
            applyDarkMode();
            
            // Set up event listeners
            setupEventListeners();
            
            // Update time display
            updateTime();
            setInterval(updateTime, 1000);
            
            // Token verification
            (function() {
                const urlParams = new URLSearchParams(window.location.search);
                const urlToken = decodeURIComponent(urlParams.get('token') || '');
                const validTokens = JSON.parse(sessionStorage.getItem('validTokens') || '[]');
                const tokenIndex = validTokens.indexOf(urlToken);

                if(tokenIndex === -1) {
                    const redirect = encodeURIComponent(window.location.href);
                    window.location.href = `login?redirect=${redirect}`;
                } else {
                    // Remove used token and clean URL
                    validTokens.splice(tokenIndex, 1);
                    sessionStorage.setItem('validTokens', JSON.stringify(validTokens));
                    history.replaceState(null, null, window.location.pathname);
                }
            })();
        });

        // Apply dark mode if enabled
        function applyDarkMode() {
            const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // Update time display
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('de-DE', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            document.getElementById('timeDisplay').textContent = `${dateString}, ${timeString}`;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Hamburger menu toggle for mobile
            document.getElementById('hamburger').addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                sidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
            });
            
            // Close sidebar when clicking overlay
            document.getElementById('sidebarOverlay').addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
            });
            
            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', () => {
                const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
                
                if (settings.logoutConfirmation) {
                    if (!confirm('Möchten Sie sich wirklich abmelden?')) {
                        return;
                    }
                }
                
                sessionStorage.removeItem('validTokens');
                localStorage.removeItem('authToken');
                window.location.reload();
            });
            
            // Edit goals
            document.getElementById('edit-goals').addEventListener('click', () => {
                const goals = JSON.parse(localStorage.getItem('dashboard_goals') || '{}');
                
                document.getElementById('revenue-goal').value = goals.revenue || 0;
                document.getElementById('orders-goal').value = goals.orders || 0;
                document.getElementById('customers-goal').value = goals.customers || 0;
                document.getElementById('products-goal').value = goals.products || 0;
                
                document.getElementById('goals-modal').classList.add('active');
            });
            
            // Close goals modal
            document.getElementById('close-goals-modal').addEventListener('click', () => {
                document.getElementById('goals-modal').classList.remove('active');
            });
            
            document.getElementById('cancel-goals').addEventListener('click', () => {
                document.getElementById('goals-modal').classList.remove('active');
            });
            
            // Save goals
            document.getElementById('save-goals').addEventListener('click', () => {
                const revenue = document.getElementById('revenue-goal').value;
                const orders = document.getElementById('orders-goal').value;
                const customers = document.getElementById('customers-goal').value;
                const products = document.getElementById('products-goal').value;
                
                if (!revenue || !orders || !customers || !products) {
                    alert('Bitte füllen Sie alle Felder aus.');
                    return;
                }
                
                DashboardManager.saveGoals(revenue, orders, customers, products);
                document.getElementById('goals-modal').classList.remove('active');
            });
            
            // Add task
            document.getElementById('add-task').addEventListener('click', () => {
                // Clear form
                document.getElementById('task-title').value = '';
                document.getElementById('task-description').value = '';
                document.getElementById('task-priority').value = 'medium';
                document.getElementById('task-due-date').value = '';
                
                document.getElementById('task-modal').classList.add('active');
            });
            
            // Close task modal
            document.getElementById('close-task-modal').addEventListener('click', () => {
                document.getElementById('task-modal').classList.remove('active');
            });
            
            document.getElementById('cancel-task').addEventListener('click', () => {
                document.getElementById('task-modal').classList.remove('active');
            });
            
            // Save task
            document.getElementById('save-task').addEventListener('click', () => {
                const title = document.getElementById('task-title').value;
                const description = document.getElementById('task-description').value;
                const priority = document.getElementById('task-priority').value;
                const dueDate = document.getElementById('task-due-date').value;
                
                if (!title || !dueDate) {
                    alert('Bitte füllen Sie Titel und Fälligkeitsdatum aus.');
                    return;
                }
                
                DashboardManager.addTask(title, description, priority, dueDate);
                document.getElementById('task-modal').classList.remove('active');
            });
            
            // Quick sale
            document.getElementById('quick-sale').addEventListener('click', () => {
                const products = getProducts();
                const saleProductSelect = document.getElementById('sale-product');
                
                // Clear and populate product select
                saleProductSelect.innerHTML = '';
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.barcode;
                    option.textContent = `${product.name} (€${product.price.toFixed(2)})`;
                    saleProductSelect.appendChild(option);
                });
                
                // Clear form
                document.getElementById('sale-quantity').value = '1';
                document.getElementById('sale-customer').value = '';
                document.getElementById('sale-payment').value = 'cash';
                
                document.getElementById('sale-modal').classList.add('active');
            });
            
            // Close sale modal
            document.getElementById('close-sale-modal').addEventListener('click', () => {
                document.getElementById('sale-modal').classList.remove('active');
            });
            
            document.getElementById('cancel-sale').addEventListener('click', () => {
                document.getElementById('sale-modal').classList.remove('active');
            });
            
            // Process sale
            document.getElementById('process-sale').addEventListener('click', () => {
                const productBarcode = document.getElementById('sale-product').value;
                const quantity = document.getElementById('sale-quantity').value;
                const customer = document.getElementById('sale-customer').value;
                const paymentMethod = document.getElementById('sale-payment').value;
                
                if (!productBarcode || !quantity) {
                    alert('Bitte wählen Sie ein Produkt und geben Sie eine Menge ein.');
                    return;
                }
                
                DashboardManager.processQuickSale(productBarcode, quantity, customer, paymentMethod);
                document.getElementById('sale-modal').classList.remove('active');
            });
            
            // Quick product
            document.getElementById('quick-product').addEventListener('click', () => {
                // Clear form
                document.getElementById('product-name').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-stock').value = '0';
                document.getElementById('product-barcode').value = '';
                
                document.getElementById('product-modal').classList.add('active');
            });
            
            // Close product modal
            document.getElementById('close-product-modal').addEventListener('click', () => {
                document.getElementById('product-modal').classList.remove('active');
            });
            
            document.getElementById('cancel-product').addEventListener('click', () => {
                document.getElementById('product-modal').classList.remove('active');
            });
            
            // Save product
            document.getElementById('save-product').addEventListener('click', () => {
                const name = document.getElementById('product-name').value;
                const price = document.getElementById('product-price').value;
                const stock = document.getElementById('product-stock').value;
                const barcode = document.getElementById('product-barcode').value;
                
                if (!name || !price) {
                    alert('Bitte füllen Sie Name und Preis aus.');
                    return;
                }
                
                DashboardManager.addProduct(name, price, stock, barcode);
                document.getElementById('product-modal').classList.remove('active');
            });
            
            // Mark all notifications as read
            document.getElementById('mark-all-read').addEventListener('click', () => {
                DashboardManager.markAllNotificationsRead();
            });
            
            // AI Assistant
            document.getElementById('ai-send').addEventListener('click', sendAIMessage);
            document.getElementById('ai-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendAIMessage();
                }
            });
            
            // Refresh activities
            document.getElementById('refresh-activities').addEventListener('click', () => {
                DashboardManager.init();
            });
            
            // View all products
            document.getElementById('view-all-products').addEventListener('click', () => {
                window.location.href = 'products';
            });
            
            // View low stock
            document.getElementById('view-low-stock').addEventListener('click', () => {
                window.location.href = 'products';
            });
            
            // Export metrics
            document.getElementById('export-metrics').addEventListener('click', () => {
                alert('Metriken werden exportiert...');
                // In a real app, this would generate a PDF or CSV
            });
            
            // Revenue chart period buttons
            document.getElementById('revenue-week').addEventListener('click', () => {
                alert('Umsatzdiagramm für diese Woche wird angezeigt');
                // In a real app, this would update the chart
            });
            
            document.getElementById('revenue-month').addEventListener('click', () => {
                alert('Umsatzdiagramm für diesen Monat wird angezeigt');
                // In a real app, this would update the chart
            });
            
            document.getElementById('revenue-year').addEventListener('click', () => {
                alert('Umsatzdiagramm für dieses Jahr wird angezeigt');
                // In a real app, this would update the chart
            });
            
            // Quick actions
            document.getElementById('quick-customer').addEventListener('click', () => {
                alert('Kunden hinzufügen Funktion wird geöffnet');
                // In a real app, this would open a customer form
            });
            
            document.getElementById('quick-report').addEventListener('click', () => {
                alert('Bericht erstellen Funktion wird geöffnet');
                // In a real app, this would open a report generator
            });
        }

        // Send AI message
        function sendAIMessage() {
            const input = document.getElementById('ai-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addAIMessage('user', message);
            
            // Clear input
            input.value = '';
            
            // Get AI response
            const response = DashboardManager.getAIResponse(message);
            
            // Add AI response to chat (with a slight delay to simulate thinking)
            setTimeout(() => {
                addAIMessage('assistant', response);
            }, 1000);
        }

        // Add AI message to chat
        function addAIMessage(role, content) {
            const messagesContainer = document.getElementById('ai-messages');
            const messageElement = document.createElement('div');
            messageElement.className = `ai-message ${role}`;
            messageElement.textContent = content;
            messagesContainer.appendChild(messageElement);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Save conversation to localStorage
            saveAIConversation(role, content);
        }

        // Save AI conversation to localStorage
        function saveAIConversation(role, content) {
            const conversation = JSON.parse(localStorage.getItem('dashboard_ai_conversation') || '[]');
            conversation.push({
                role: role,
                content: content,
                timestamp: new Date().toISOString()
            });
            
            // Keep only the last 50 messages
            if (conversation.length > 50) {
                conversation.splice(0, conversation.length - 50);
            }
            
            localStorage.setItem('dashboard_ai_conversation', JSON.stringify(conversation));
        }

        // Get products from localStorage (helper function)
        function getProducts() {
            try {
                // Try to get products from the products page storage
                const productsData = localStorage.getItem('products');
                if (productsData) {
                    return JSON.parse(productsData);
                }
                
                // Fallback: get products with product_ prefix
                const products = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('product_')) {
                        try {
                            const product = JSON.parse(localStorage.getItem(key));
                            products[product.barcode] = product;
                        } catch (e) {
                            console.error('Error parsing product:', e);
                        }
                    }
                }
                return Object.values(products);
            } catch (error) {
                console.error('Error getting products:', error);
                return [];
            }
        }
    </script>
</body>
</html>
