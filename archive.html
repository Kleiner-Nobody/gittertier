<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belegarchiv - Gittertier Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    :root {
        --color-bg: #ffffff;
        --color-text: #111111;
        --color-text-muted: #6b7280;
        --color-border: #e5e7eb;
        --color-accent: #2563eb;
        --color-accent-hover: #1d4ed8;
        --color-success: #16a34a;
        --color-error: #dc2626;
        --color-warning: #d97706;
        --color-beta: #8b5cf6;
        --color-overlay: rgba(0, 0, 0, 0.5);
        
        --radius: 12px;
        --radius-sm: 6px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.07), 0 1px 2px rgba(0, 0, 0, 0.04);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --focus-ring: 0 0 0 3px rgba(37, 99, 235, 0.35);
        
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-xxl: 48px;
        
        --transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
        --transition-slow: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        
        --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        
        --header-height: 64px;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: var(--font-family);
        background-color: var(--color-bg);
        color: var(--color-text);
        line-height: 1.5;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Header Styles */
    .admin-header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-md);
        border-bottom: 1px solid var(--color-border);
        background-color: var(--color-bg);
        position: sticky;
        top: 0;
        z-index: 50;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-weight: 700;
        font-size: var(--text-lg);
    }

    .logo i {
        font-size: var(--text-lg);
        color: var(--color-accent);
    }

    .header-controls {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
    }

    .sync-btn {
        background-color: var(--color-bg);
        border: 1px solid var(--color-border);
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .sync-btn:hover {
        background-color: #f3f4f6;
    }

    .sync-btn.syncing {
        animation: pulse 1.5s infinite;
        color: var(--color-warning);
    }

    .sync-btn.online {
        color: var(--color-success);
    }

    .sync-btn.offline {
        color: var(--color-error);
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }

    .logout-btn {
        background-color: transparent;
        color: var(--color-text);
        border: 1px solid var(--color-border);
        padding: var(--spacing-sm);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .logout-btn:hover {
        background-color: #f3f4f6;
    }

    /* Main content */
    .admin-content {
        flex: 1;
        padding: var(--spacing-md);
    }

    /* Search and Filter Section */
    .search-filter-section {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .search-container {
        width: 100%;
    }

    .search-bar {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        background-color: var(--color-bg);
        color: var(--color-text);
        transition: var(--transition);
    }

    .search-bar:focus {
        outline: none;
        border-color: var(--color-accent);
        box-shadow: var(--focus-ring);
    }

    .filter-toggle {
        background-color: var(--color-bg);
        border: 1px solid var(--color-border);
        padding: var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .filter-toggle:hover {
        background-color: #f9fafb;
    }

    .filter-panel {
        background-color: var(--color-bg);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
        box-shadow: var(--shadow-md);
        display: none;
    }

    .filter-panel.active {
        display: block;
        animation: slideIn 0.3s ease;
    }

    .filter-group {
        margin-bottom: var(--spacing-md);
    }

    .filter-title {
        font-weight: 600;
        margin-bottom: var(--spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .filter-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-sm);
    }

    .filter-option {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .date-filter {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }

    .date-input {
        padding: var(--spacing-sm);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
    }

    .apply-filter-btn {
        background-color: var(--color-accent);
        color: white;
        border: none;
        padding: var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        margin-top: var(--spacing-md);
        width: 100%;
    }

    .apply-filter-btn:hover {
        background-color: var(--color-accent-hover);
    }

    /* Action buttons */
    .action-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .action-btn {
        background-color: var(--color-bg);
        border: 1px solid var(--color-border);
        padding: var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
    }

    .action-btn:hover {
        background-color: #f9fafb;
    }

    .btn-primary {
        background-color: var(--color-accent);
        color: white;
    }

    .btn-primary:hover {
        background-color: var(--color-accent-hover);
    }

    .btn-success {
        background-color: var(--color-success);
        color: white;
    }

    .btn-success:hover {
        background-color: #0f9c5a;
    }

    .btn-danger {
        background-color: var(--color-error);
        color: white;
    }

    .btn-danger:hover {
        background-color: #c53030;
    }

    /* Cards */
    .dashboard-card {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        border: 1px solid var(--color-border);
        padding: var(--spacing-md);
        box-shadow: var(--shadow);
        margin-bottom: var(--spacing-lg);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-md);
    }

    .card-title {
        font-size: var(--text-lg);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .card-title i {
        color: var(--color-accent);
    }

    /* Receipt list */
    .receipt-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .receipt-item {
        display: flex;
        flex-direction: column;
        padding: var(--spacing-md);
        background-color: #f9fafb;
        border-radius: var(--radius);
        transition: var(--transition);
        border-left: 3px solid var(--color-accent);
    }

    .receipt-item:hover {
        background-color: #f3f4f6;
        box-shadow: var(--shadow-md);
    }

    .receipt-details {
        flex: 1;
    }

    .receipt-id {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
        color: var(--color-accent);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .receipt-date {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-xs);
    }

    .receipt-note {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        margin-top: var(--spacing-xs);
        font-style: italic;
    }

    .receipt-total {
        font-weight: 700;
        font-size: var(--text-lg);
        margin: var(--spacing-xs) 0;
    }

    .status-badge {
        padding: 4px 8px;
        border-radius: 20px;
        font-size: var(--text-xs);
        font-weight: 600;
        display: inline-block;
    }

    .status-confirmed {
        background-color: rgba(22, 163, 74, 0.1);
        color: var(--color-success);
    }

    .status-declined {
        background-color: rgba(220, 38, 38, 0.1);
        color: var(--color-error);
    }

    .status-beta {
        background-color: rgba(139, 92, 246, 0.1);
        color: var(--color-beta);
    }

    .receipt-actions {
        display: flex;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
        justify-content: flex-end;
    }

    .receipt-action-btn {
        background: transparent;
        border: none;
        color: var(--color-text-muted);
        cursor: pointer;
        padding: var(--spacing-xs);
        border-radius: var(--radius-sm);
        transition: var(--transition);
    }

    .receipt-action-btn:hover {
        background-color: var(--color-bg);
        color: var(--color-accent);
    }

    .empty-receipts {
        text-align: center;
        padding: var(--spacing-xl);
        color: var(--color-text-muted);
    }

    .empty-receipts i {
        font-size: var(--text-3xl);
        color: var(--color-accent);
        margin-bottom: var(--spacing-md);
        display: block;
    }

    /* Summary section */
    .summary-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md);
        background-color: #f9fafb;
        border-radius: var(--radius);
        margin-top: var(--spacing-lg);
    }

    .summary-label {
        font-weight: 600;
    }

    .summary-value {
        font-weight: 700;
        font-size: var(--text-lg);
        color: var(--color-success);
    }

    /* Modal */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        display: none;
        padding: var(--spacing-md);
    }

    .modal-overlay.active {
        display: flex;
        animation: fadeIn 0.3s ease;
    }

    .modal {
        background-color: var(--color-bg);
        border-radius: var(--radius);
        padding: var(--spacing-md);
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        animation: scaleIn 0.3s ease;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
    }

    .modal-title {
        font-size: var(--text-lg);
        font-weight: 600;
    }

    .close-modal {
        background: transparent;
        border: none;
        font-size: var(--text-xl);
        color: var(--color-text);
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .close-modal:hover {
        background-color: #f3f4f6;
    }

    .modal-body {
        margin-bottom: var(--spacing-md);
    }

    .detail-row {
        display: flex;
        flex-direction: column;
        margin-bottom: var(--spacing-md);
    }

    .detail-label {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
        color: var(--color-text-muted);
    }

    .detail-value {
        flex: 1;
    }

    .items-table {
        width: 100%;
        border-collapse: collapse;
        margin: var(--spacing-md) 0;
    }

    .items-table th,
    .items-table td {
        padding: var(--spacing-sm);
        text-align: left;
        border-bottom: 1px solid var(--color-border);
    }

    .items-table th {
        font-weight: 600;
        color: var(--color-text-muted);
    }

    .note-input {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        margin-top: var(--spacing-sm);
        min-height: 100px;
        resize: vertical;
    }

    .note-input:focus {
        outline: none;
        border-color: var(--color-accent);
        box-shadow: var(--focus-ring);
    }

    .modal-footer {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes scaleIn {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideIn {
        from { transform: translateY(-10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    /* Beta badge */
    .beta-badge {
        background-color: rgba(139, 92, 246, 0.1);
        color: var(--color-beta);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: var(--text-xs);
        font-weight: 600;
    }

    /* Responsive adjustments */
    @media (min-width: 640px) {
        .admin-header {
            padding: 0 var(--spacing-lg);
        }
        
        .admin-content {
            padding: var(--spacing-lg);
        }
        
        .search-filter-section {
            flex-direction: row;
            align-items: center;
        }
        
        .search-container {
            flex: 1;
        }
        
        .action-buttons {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .receipt-item {
            flex-direction: row;
            align-items: center;
        }
        
        .receipt-actions {
            margin-top: 0;
        }
        
        .modal-footer {
            flex-direction: row;
        }
        
        .detail-row {
            flex-direction: row;
        }
        
        .detail-label {
            width: 120px;
        }
    }

    @media (min-width: 768px) {
        .filter-options {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .date-filter {
            grid-template-columns: 1fr 1fr;
        }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        :root {
            --color-bg: #111827;
            --color-text: #f3f4f6;
            --color-text-muted: #9ca3af;
            --color-border: #374151;
        }
        
        body {
            background-color: var(--color-bg);
        }
        
        .receipt-item {
            background-color: #1f2937;
        }
        
        .summary-section {
            background-color: #1f2937;
        }
        
        .sync-btn:hover {
            background-color: #374151;
        }
        
        .logout-btn:hover {
            background-color: #374151;
        }
        
        .filter-toggle:hover {
            background-color: #374151;
        }
        
        .action-btn:hover {
            background-color: #374151;
        }
    }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="logo">
            <i class="fas fa-shopping-cart"></i>
            <span>Belegarchiv</span>
        </div>
        <div class="header-controls">
            <button class="sync-btn online" id="sync-btn">
                <i class="fas fa-sync"></i>
            </button>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span class="logout-text">Abmelden</span>
            </button>
        </div>
    </div>

    <main class="admin-content">
        <div class="search-filter-section">
            <div class="search-container">
                <input type="text" class="search-bar" id="search-input" placeholder="Belege durchsuchen...">
            </div>
            <button class="filter-toggle" id="filterToggle">
                <span>Filter</span>
                <i class="fas fa-filter"></i>
            </button>
        </div>

        <div class="filter-panel" id="filterPanel">
            <div class="filter-group">
                <div class="filter-title">
                    <i class="fas fa-check-circle"></i>
                    Status
                </div>
                <div class="filter-options">
                    <label class="filter-option">
                        <input type="checkbox" id="filter-confirmed" checked>
                        Bestätigt
                    </label>
                    <label class="filter-option">
                        <input type="checkbox" id="filter-declined" checked>
                        Abgelehnt
                    </label>
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-title">
                    <i class="fas fa-calendar"></i>
                    Zeitraum
                </div>
                <div class="date-filter">
                    <input type="date" id="start-date" class="date-input">
                    <input type="date" id="end-date" class="date-input">
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-title">
                    <i class="fas fa-history"></i>
                    Format
                </div>
                <div class="filter-options">
                    <label class="filter-option">
                        <input type="checkbox" id="filter-current" checked>
                        Aktuell
                    </label>
                    <label class="filter-option">
                        <input type="checkbox" id="filter-beta" checked>
                        Beta
                    </label>
                </div>
            </div>

            <button class="apply-filter-btn" id="apply-filters">
                Filter anwenden
            </button>
        </div>

        <div class="action-buttons">
            <button class="action-btn btn-primary" id="export-all">
                <i class="fas fa-file-export"></i>
                <span>Exportieren</span>
            </button>
            <button class="action-btn btn-success" id="backup-btn">
                <i class="fas fa-download"></i>
                <span>Backup</span>
            </button>
            <button class="action-btn btn-danger" id="bulk-delete">
                <i class="fas fa-trash"></i>
                <span>Löschen</span>
            </button>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-file-invoice"></i>
                    Archivierte Belege
                </h2>
                <div class="receipt-count" id="receipt-count">0 Belege</div>
            </div>
            <div class="receipt-list" id="receipt-list">
                <div class="empty-receipts">
                    <i class="fas fa-receipt"></i>
                    <p>Keine Belege gefunden</p>
                </div>
            </div>
        </div>

        <div class="summary-section">
            <div class="summary-label">Gesamteinnahmen:</div>
            <div class="summary-value" id="total-amount">€0.00</div>
        </div>
    </main>

    <!-- Receipt Detail Modal -->
    <div class="modal-overlay" id="receipt-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Beleg Details</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-row">
                    <div class="detail-label">Belegnummer:</div>
                    <div class="detail-value" id="detail-id"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Datum:</div>
                    <div class="detail-value" id="detail-date"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Status:</div>
                    <div class="detail-value">
                        <span class="status-badge" id="detail-status"></span>
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Format:</div>
                    <div class="detail-value" id="detail-format"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Gesamtbetrag:</div>
                    <div class="detail-value" id="detail-total"></div>
                </div>

                <h3>Artikel</h3>
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Artikel</th>
                            <th>Menge</th>
                            <th>Preis</th>
                            <th>Gesamt</th>
                        </tr>
                    </thead>
                    <tbody id="items-list">
                    </tbody>
                </table>

                <div class="detail-row">
                    <div class="detail-label">Notizen:</div>
                    <div class="detail-value">
                        <textarea class="note-input" id="note-input" placeholder="Notizen zu diesem Beleg hinzufügen..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="toggle-status">
                    <i class="fas fa-sync"></i>
                    Status ändern
                </button>
                <button class="action-btn btn-primary" id="save-note">
                    <i class="fas fa-save"></i>
                    Speichern
                </button>
                <button class="action-btn" id="print-receipt">
                    <i class="fas fa-print"></i>
                    Drucken
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample data including beta format receipts
        const sampleReceipts = [
            {
                id: 'REC-2023-001',
                date: '2023-05-15T14:30:00.000Z',
                total: 24.99,
                status: 'Bestätigt',
                items: [
                    { name: 'Produkt A', quantity: 2, price: 9.99 },
                    { name: 'Produkt B', quantity: 1, price: 5.01 }
                ],
                note: 'Kunde war zufrieden'
            },
            {
                id: 'REC-2023-002',
                date: '2023-05-16T10:15:00.000Z',
                total: 13.49,
                status: 'Bestätigt',
                format: 'beta',
                data: 'N4IgDgphBOCSAmIBcIAKBBAmgWgIwHYAWADgCYAGATgFZ8A2Qm7AZwEsBzcgTxABoR4AQwAuEZCAqlq2ctKkAVUriSlCSAMx0AdKU0AtPiGEB7YYIA2yXOq2N+rUQFtmyANqgAdoMdiUAMW9jAFdmAAIAIXMgiFCAJUFWDwBjYxFQgGEAEUMARyDBD2EHHiRcfjBoViTfcgBfAF1aoA='
            },
            {
                id: 'REC-2023-003',
                date: '2023-05-17T16:45:00.000Z',
                total: 56.75,
                status: 'Abgelehnt',
                items: [
                    { name: 'Produkt C', quantity: 3, price: 15.50 },
                    { name: 'Produkt D', quantity: 1, price: 10.25 }
                ],
                note: 'Zahlung abgelehnt'
            }
        ];

        let currentReceipt = null;
        let allReceipts = [];
        
        // DOM Elements
        const filterToggle = document.getElementById('filterToggle');
        const filterPanel = document.getElementById('filterPanel');
        const searchInput = document.getElementById('search-input');
        const receiptList = document.getElementById('receipt-list');
        const receiptCount = document.getElementById('receipt-count');
        const totalAmount = document.getElementById('total-amount');
        const exportAllBtn = document.getElementById('export-all');
        const backupBtn = document.getElementById('backup-btn');
        const bulkDeleteBtn = document.getElementById('bulk-delete');
        const applyFiltersBtn = document.getElementById('apply-filters');
        const receiptModal = document.getElementById('receipt-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const toggleStatusBtn = document.getElementById('toggle-status');
        const saveNoteBtn = document.getElementById('save-note');
        const printReceiptBtn = document.getElementById('print-receipt');
        const syncBtn = document.getElementById('sync-btn');
        const logoutBtn = document.getElementById('logoutBtn');

        // Initialize the page
        function init() {
            loadReceipts();
            setupEventListeners();
        }

        // Load receipts from sample data
        function loadReceipts() {
            allReceipts = sampleReceipts.map(receipt => {
                // Process beta format receipts
                if (receipt.format === 'beta' && receipt.data) {
                    try {
                        const decompressed = LZString.decompressFromBase64(receipt.data);
                        if (decompressed) {
                            const parsedData = JSON.parse(decompressed);
                            receipt.items = parsedData.items || [];
                        }
                    } catch (e) {
                        console.error('Error decompressing beta format data:', e);
                        receipt.items = [];
                    }
                }
                return receipt;
            });
            
            generateReceiptList(allReceipts);
        }

        // Set up event listeners
        function setupEventListeners() {
            filterToggle.addEventListener('click', () => {
                filterPanel.classList.toggle('active');
            });
            
            closeModalBtn.addEventListener('click', () => {
                receiptModal.classList.remove('active');
            });
            
            receiptModal.addEventListener('click', (e) => {
                if (e.target === receiptModal) {
                    receiptModal.classList.remove('active');
                }
            });
            
            applyFiltersBtn.addEventListener('click', filterReceipts);
            searchInput.addEventListener('input', filterReceipts);
            
            syncBtn.addEventListener('click', () => {
                syncBtn.classList.add('syncing');
                setTimeout(() => {
                    syncBtn.classList.remove('syncing');
                    showNotification('Synchronisierung abgeschlossen', 'success');
                }, 1500);
            });
            
            logoutBtn.addEventListener('click', () => {
                if (confirm('Möchten Sie sich wirklich abmelden?')) {
                    showNotification('Erfolgreich abgemeldet', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                }
            });
            
            // Initialize other button handlers
            initButtonHandlers();
        }

        // Initialize button handlers
        function initButtonHandlers() {
            exportAllBtn.addEventListener('click', () => {
                showNotification('Export erfolgreich', 'success');
            });
            
            backupBtn.addEventListener('click', () => {
                showNotification('Backup erstellt', 'success');
            });
            
            bulkDeleteBtn.addEventListener('click', () => {
                if (confirm('Ausgewählte Belege löschen?')) {
                    showNotification('Belege gelöscht', 'success');
                }
            });
            
            toggleStatusBtn.addEventListener('click', () => {
                if (currentReceipt) {
                    currentReceipt.status = currentReceipt.status === 'Bestätigt' ? 'Abgelehnt' : 'Bestätigt';
                    showNotification(`Status geändert zu "${currentReceipt.status}"`);
                    loadReceipts();
                    receiptModal.classList.remove('active');
                }
            });
            
            saveNoteBtn.addEventListener('click', () => {
                if (currentReceipt) {
                    currentReceipt.note = document.getElementById('note-input').value;
                    showNotification('Notiz gespeichert');
                    loadReceipts();
                }
            });
            
            printReceiptBtn.addEventListener('click', () => {
                window.print();
            });
        }

        // Generate receipt list UI
        function generateReceiptList(receipts) {
            receiptList.innerHTML = '';
            
            if (receipts.length === 0) {
                receiptList.innerHTML = `
                    <div class="empty-receipts">
                        <i class="fas fa-receipt"></i>
                        <p>Keine Belege gefunden</p>
                    </div>
                `;
                receiptCount.textContent = '0 Belege';
                totalAmount.textContent = '€0.00';
                return;
            }
            
            receiptCount.textContent = `${receipts.length} Belege`;
            
            // Calculate total income from confirmed receipts
            const totalIncome = receipts
                .filter(r => r.status === 'Bestätigt')
                .reduce((sum, r) => sum + r.total, 0);
            
            totalAmount.textContent = `€${totalIncome.toFixed(2)}`;
            
            receipts.forEach(receipt => {
                const date = new Date(receipt.date);
                const dateStr = `${date.toLocaleDateString('de-DE')} ${date.toLocaleTimeString('de-DE', {hour: '2-digit', minute:'2-digit'})}`;
                
                const isBetaFormat = receipt.format === 'beta';
                const betaBadge = isBetaFormat ? '<span class="beta-badge">Beta</span>' : '';
                
                const receiptElement = document.createElement('div');
                receiptElement.className = 'receipt-item';
                receiptElement.innerHTML = `
                    <div class="receipt-details">
                        <div class="receipt-id">
                            ${receipt.id}
                            ${betaBadge}
                        </div>
                        <div class="receipt-date">${dateStr}</div>
                        <div class="receipt-total">€${receipt.total.toFixed(2)}</div>
                        <div class="status-badge ${receipt.status === 'Bestätigt' ? 'status-confirmed' : 'status-declined'}">
                            ${receipt.status}
                        </div>
                        ${receipt.note ? `<div class="receipt-note">${receipt.note}</div>` : ''}
                    </div>
                    <div class="receipt-actions">
                        <button class="receipt-action-btn view-btn" title="Details anzeigen">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="receipt-action-btn delete-btn" title="Beleg löschen">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // Add event listeners to the buttons
                const viewBtn = receiptElement.querySelector('.view-btn');
                const deleteBtn = receiptElement.querySelector('.delete-btn');
                
                viewBtn.addEventListener('click', () => {
                    showReceiptDetails(receipt);
                });
                
                deleteBtn.addEventListener('click', () => {
                    if (confirm('Diesen Beleg löschen?')) {
                        showNotification(`Beleg ${receipt.id} gelöscht`);
                        // In a real app, you would remove it from the database
                    }
                });
                
                receiptList.appendChild(receiptElement);
            });
        }

        // Show receipt details in modal
        function showReceiptDetails(receipt) {
            currentReceipt = receipt;
            const modal = document.getElementById('receipt-modal');
            
            // Populate details
            document.getElementById('detail-id').textContent = receipt.id;
            
            const date = new Date(receipt.date);
            document.getElementById('detail-date').textContent = 
                `${date.toLocaleDateString('de-DE')} ${date.toLocaleTimeString('de-DE', {hour: '2-digit', minute:'2-digit'})}`;
            
            document.getElementById('detail-total').textContent = `€${receipt.total.toFixed(2)}`;
            document.getElementById('detail-format').textContent = receipt.format === 'beta' ? 'Beta-Format' : 'Aktuelles Format';
            
            const statusBadge = document.getElementById('detail-status');
            statusBadge.textContent = receipt.status;
            statusBadge.className = 'status-badge ' + (receipt.status === 'Bestätigt' ? 'status-confirmed' : 'status-declined');
            
            // Populate items
            const itemsList = document.getElementById('items-list');
            itemsList.innerHTML = '';
            
            if (receipt.items && receipt.items.length > 0) {
                receipt.items.forEach(item => {
                    const row = document.createElement('tr');
                    const total = (item.quantity * item.price).toFixed(2);
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>€${item.price.toFixed(2)}</td>
                        <td>€${total}</td>
                    `;
                    itemsList.appendChild(row);
                });
            } else {
                // Show message if items are missing
                itemsList.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: var(--color-text-muted);">
                            <i class="fas fa-exclamation-circle"></i> Artikelinformationen nicht verfügbar
                        </td>
                    </tr>
                `;
            }
            
            // Set note
            document.getElementById('note-input').value = receipt.note || '';
            
            // Show modal
            modal.classList.add('active');
        }

        // Filter receipts based on criteria
        function filterReceipts() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const showConfirmed = document.getElementById('filter-confirmed').checked;
            const showDeclined = document.getElementById('filter-declined').checked;
            const showCurrent = document.getElementById('filter-current').checked;
            const showBeta = document.getElementById('filter-beta').checked;
            
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            const filtered = allReceipts.filter(receipt => {
                // Status filter
                if ((receipt.status === 'Bestätigt' && !showConfirmed) || 
                    (receipt.status === 'Abgelehnt' && !showDeclined)) {
                    return false;
                }
                
                // Format filter
                const isBetaFormat = receipt.format === 'beta';
                if ((isBetaFormat && !showBeta) || (!isBetaFormat && !showCurrent)) {
                    return false;
                }
                
                // Date filter
                if (startDate || endDate) {
                    const receiptDate = new Date(receipt.date);
                    const start = startDate ? new Date(startDate) : null;
                    const end = endDate ? new Date(endDate + 'T23:59:59') : null;
                    
                    if (start && receiptDate < start) return false;
                    if (end && receiptDate > end) return false;
                }
                
                // Search filter
                if (searchTerm && 
                    !receipt.id.toLowerCase().includes(searchTerm) && 
                    !receipt.date.toLowerCase().includes(searchTerm) &&
                    !receipt.status.toLowerCase().includes(searchTerm) &&
                    !receipt.total.toString().includes(searchTerm) &&
                    !(receipt.note && receipt.note.toLowerCase().includes(searchTerm))) {
                    return false;
                }
                
                return true;
            });
            
            generateReceiptList(filtered);
        }

        // Show notification
        function showNotification(message, type = 'success') {
            // Create notification element
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 500;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;
            
            if (type === 'success') {
                notification.style.backgroundColor = '#10b981';
                notification.style.color = 'white';
            } else {
                notification.style.backgroundColor = '#ef4444';
                notification.style.color = 'white';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>