<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Club - Gittertier Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #2563eb;
            --color-primary-dark: #1d4ed8;
            --color-accent: #7e22ce;
            --color-accent-light: #a855f7;
            --color-success: #16a34a;
            --color-warning: #f59e0b;
            --color-error: #dc2626;
            --color-dark: #111827;
            --color-light: #f3f4f6;
            --color-white: #ffffff;
            --color-gray: #6b7280;
            --color-gray-light: #9ca3af;
            
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --radius: 12px;
            --radius-lg: 16px;
            
            --transition: all 0.3s ease;
            --transition-slow: all 0.5s cubic-bezier(0.2, 0, 0, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--color-dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .main-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: 700;
            color: var(--color-white);
        }

        .main-logo i {
            color: var(--color-white);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1rem;
            flex-wrap: wrap;
        }

        nav a {
            text-decoration: none;
            color: var(--color-white);
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
        }

        nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-current {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 0;
            margin-bottom: 3rem;
            color: var(--color-white);
        }

        .hero h1 {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(90deg, #ffffff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: rgba(255, 255, 255, 0.9);
            max-width: 700px;
            margin: 0 auto 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 3rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-white);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        /* Points Overview */
        .points-overview {
            background: var(--color-white);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.6s ease-out;
        }

        .points-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .current-points {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .points-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--color-accent), var(--color-accent-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .points-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-dark);
        }

        .points-label {
            color: var(--color-gray);
            font-size: 0.9rem;
        }

        .tier-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--color-warning), #fbbf24);
            border-radius: 20px;
            color: white;
            font-weight: 600;
        }

        .tier-progress {
            margin-top: 1.5rem;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .progress-bar {
            height: 10px;
            background: var(--color-light);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-accent-light));
            border-radius: 5px;
            transition: width 1s ease-out;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .feature-card {
            background: var(--color-white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .feature-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .feature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .feature-icon {
            font-size: 2rem;
            color: var(--color-accent);
        }

        .feature-cost {
            background: linear-gradient(135deg, var(--color-warning), #fbbf24);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .feature-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-dark);
        }

        .feature-description {
            color: var(--color-gray);
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .feature-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-unlocked {
            background: rgba(22, 163, 74, 0.1);
            color: var(--color-success);
        }

        .status-locked {
            background: rgba(107, 114, 128, 0.1);
            color: var(--color-gray);
        }

        .unlock-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--color-accent), var(--color-accent-light));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 1rem;
        }

        .unlock-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .unlock-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .unlock-btn.unlocked {
            background: var(--color-success);
        }

        /* Active Benefits */
        .active-benefits {
            background: var(--color-white);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow-lg);
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--color-light);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .benefit-item:hover {
            transform: translateX(5px);
            background: #f1f5f9;
        }

        .benefit-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--color-success), #22c55e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .benefit-content h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .benefit-content p {
            color: var(--color-gray);
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.8);
            color: var(--color-white);
            padding: 3rem 0;
            text-align: center;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--color-white);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: var(--color-gray-light);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--color-white);
        }

        .copyright {
            color: var(--color-gray-light);
            margin-top: 2rem;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.7;
            animation: confetti 2s ease-out forwards;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            header {
                flex-direction: column;
                gap: 1rem;
            }
            
            nav ul {
                justify-content: center;
            }
            
            .hero {
                padding: 2rem 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .benefits-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
        }

        @media (max-width: 480px) {
            .points-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .feature-card {
                padding: 1rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
        }

        /* Utility Classes */
        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--color-dark);
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover {
            background: var(--color-primary-dark);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="main-logo">
                <i class="fas fa-crown"></i>
                <span>Gittertier Premium Club</span>
            </div>
            <nav>
                <ul>
                    <li><a href="index">Scanner</a></li>
                    <li><a href="customer">Bezahlung</a></li>
                    <li><a href="loyalty" class="nav-current">Premium Club</a></li>
                    <li><a href="user">Einstellungen</a></li>
                </ul>
            </nav>
        </header>

        <section class="hero">
            <h1>Ihr Weg zur Exklusivität</h1>
            <p>Entdecken Sie einzigartige Vorteile und verbessern Sie Ihr Einkaufserlebnis mit dem Gittertier Premium Club. Jeder Punkt bringt Sie näher zu besonderen Belohnungen.</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="current-balance">0</div>
                    <div class="stat-label">Aktuelle Punkte</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lifetime-points">0</div>
                    <div class="stat-label">Lebenszeit Punkte</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="unlocked-features">0</div>
                    <div class="stat-label">Freigeschaltete Features</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="tier-level">Bronze</div>
                    <div class="stat-label">Aktueller Status</div>
                </div>
            </div>
        </section>

        <section class="points-overview">
            <div class="points-header">
                <div class="current-points">
                    <div class="points-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div>
                        <div class="points-amount" id="main-points">0</div>
                        <div class="points-label">Premium Punkte</div>
                    </div>
                </div>
                <div class="tier-display">
                    <i class="fas fa-medal"></i>
                    <span id="current-tier">Bronze</span>
                </div>
            </div>
            
            <div class="tier-progress">
                <div class="progress-label">
                    <span>Fortschritt zum nächsten Level</span>
                    <span id="progress-text">0/500</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
        </section>

        <section class="unlockable-features">
            <h2 class="section-title">Exklusive Features freischalten</h2>
            <div class="features-grid" id="features-grid">
                <!-- Features will be populated by JavaScript -->
            </div>
        </section>

        <section class="active-benefits">
            <h2 class="section-title">Aktive Vorteile</h2>
            <p class="text-muted" style="color: var(--color-gray); margin-bottom: 1.5rem;">Diese Vorteile sind aktuell in Ihrem Konto aktiv</p>
            
            <div class="benefits-grid" id="active-benefits">
                <!-- Active benefits will be populated by JavaScript -->
            </div>
        </section>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">Gittertier Premium Club</div>
            <p>Der exklusive Weg zu besonderen Einkaufserlebnissen</p>
            <div class="footer-links">
                <a href="index">Scanner</a>
                <a href="customer">Bezahlung</a>
                <a href="loyalty">Premium Club</a>
                <a href="user">Einstellungen</a>
                <a href="support">Support</a>
            </div>
            <div class="copyright">
                &copy; 2025 Gittertier Pro. Alle Rechte vorbehalten.
            </div>
        </div>
    </footer>

    <div class="confetti-container" id="confetti-container"></div>

    <script>
        // Loyalty Manager
        class LoyaltyManager {
            constructor() {
                this.storageKey = 'gittertier_loyalty_data';
                this.featuresKey = 'gittertier_unlocked_features';
                this.tierHistoryKey = 'gittertier_tier_history';
                this.init();
            }

            init() {
                this.data = this.loadData();
                this.features = this.loadFeatures();
                this.tierHistory = this.loadTierHistory();
                
                if (!this.data.lifetimePoints) {
                    this.data.lifetimePoints = 0;
                }
                
                if (!this.data.currentTier) {
                    this.data.currentTier = 'bronze';
                }
                
                this.saveData();
            }

            loadData() {
                const saved = localStorage.getItem(this.storageKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                
                // Check for existing loyalty data from payment preferences
                const paymentPrefs = localStorage.getItem('gittertier_payment_preferences');
                if (paymentPrefs) {
                    const prefs = JSON.parse(paymentPrefs);
                    return {
                        currentPoints: prefs.loyaltyPoints || 0,
                        lifetimePoints: prefs.loyaltyPoints || 0,
                        currentTier: this.calculateTier(prefs.loyaltyPoints || 0),
                        isLoyaltyMember: prefs.isLoyaltyMember || false,
                        joinDate: new Date().toISOString()
                    };
                }
                
                return {
                    currentPoints: 0,
                    lifetimePoints: 0,
                    currentTier: 'bronze',
                    isLoyaltyMember: false,
                    joinDate: new Date().toISOString()
                };
            }

            loadFeatures() {
                const saved = localStorage.getItem(this.featuresKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return {};
            }

            loadTierHistory() {
                const saved = localStorage.getItem(this.tierHistoryKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return [];
            }

            saveData() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
                localStorage.setItem(this.featuresKey, JSON.stringify(this.features));
                localStorage.setItem(this.tierHistoryKey, JSON.stringify(this.tierHistory));
            }

            calculateTier(points) {
                if (points >= 5000) return 'diamond';
                if (points >= 3000) return 'platinum';
                if (points >= 1500) return 'gold';
                if (points >= 500) return 'silver';
                return 'bronze';
            }

            getTierInfo(tier) {
                const tiers = {
                    bronze: { name: 'Bronze', color: '#cd7f32', multiplier: 1.0, minPoints: 0 },
                    silver: { name: 'Silber', color: '#c0c0c0', multiplier: 1.2, minPoints: 500 },
                    gold: { name: 'Gold', color: '#ffd700', multiplier: 1.5, minPoints: 1500 },
                    platinum: { name: 'Platin', color: '#e5e4e2', multiplier: 2.0, minPoints: 3000 },
                    diamond: { name: 'Diamant', color: '#b9f2ff', multiplier: 3.0, minPoints: 5000 }
                };
                return tiers[tier] || tiers.bronze;
            }

            addPoints(amount, reason = '') {
                const oldTier = this.data.currentTier;
                this.data.currentPoints += amount;
                this.data.lifetimePoints += amount;
                
                const newTier = this.calculateTier(this.data.lifetimePoints);
                this.data.currentTier = newTier;
                
                if (newTier !== oldTier) {
                    this.tierHistory.push({
                        date: new Date().toISOString(),
                        from: oldTier,
                        to: newTier,
                        points: this.data.lifetimePoints
                    });
                    this.showTierUpgrade(oldTier, newTier);
                }
                
                this.saveData();
                this.updateUI();
                return true;
            }

            spendPoints(amount) {
                if (this.data.currentPoints < amount) {
                    return false;
                }
                this.data.currentPoints -= amount;
                this.saveData();
                this.updateUI();
                return true;
            }

            unlockFeature(featureId) {
                if (!this.features[featureId]) {
                    this.features[featureId] = {
                        unlocked: true,
                        unlockDate: new Date().toISOString(),
                        active: true
                    };
                    this.saveData();
                    
                    // Apply feature immediately
                    this.applyFeature(featureId);
                    
                    return true;
                }
                return false;
            }

            isFeatureUnlocked(featureId) {
                return this.features[featureId]?.unlocked || false;
            }

            isFeatureActive(featureId) {
                return this.features[featureId]?.active || false;
            }

            toggleFeature(featureId, active) {
                if (this.features[featureId]) {
                    this.features[featureId].active = active;
                    this.saveData();
                    
                    if (active) {
                        this.applyFeature(featureId);
                    } else {
                        this.removeFeature(featureId);
                    }
                    return true;
                }
                return false;
            }

            applyFeature(featureId) {
                const feature = FEATURES.find(f => f.id === featureId);
                if (!feature) return;

                switch(featureId) {
                    case 'theme_night':
                        this.applyNightTheme();
                        break;
                    case 'theme_gradient':
                        this.applyGradientTheme();
                        break;
                    case 'scanner_animation':
                        this.applyScannerAnimation();
                        break;
                    case 'priority_processing':
                        this.applyPriorityProcessing();
                        break;
                    case 'advanced_dashboard':
                        this.applyAdvancedDashboard();
                        break;
                    case 'point_multiplier':
                        this.applyPointMultiplier();
                        break;
                    case 'fast_checkout':
                        this.applyFastCheckout();
                        break;
                    case 'transaction_effects':
                        this.applyTransactionEffects();
                        break;
                    case 'profile_badges':
                        this.applyProfileBadges();
                        break;
                    case 'scanner_effects':
                        this.applyScannerEffects();
                        break;
                }
            }

            removeFeature(featureId) {
                // Remove specific feature effects
                switch(featureId) {
                    case 'theme_night':
                    case 'theme_gradient':
                        this.removeTheme();
                        break;
                }
            }

            applyNightTheme() {
                // Store current theme
                const currentTheme = localStorage.getItem('gittertier_theme') || 'light';
                localStorage.setItem('gittertier_theme', 'night');
                
                // Apply dark theme to all pages
                document.body.classList.add('night-theme');
                document.documentElement.style.setProperty('--color-bg', '#111827');
                document.documentElement.style.setProperty('--color-text', '#f3f4f6');
                document.documentElement.style.setProperty('--color-light', '#1f2937');
                
                // Notify other pages
                this.broadcastThemeChange('night');
            }

            applyGradientTheme() {
                localStorage.setItem('gittertier_theme', 'gradient');
                document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)';
                
                // Apply to scanner page
                const scannerStyle = `
                    :root {
                        --color-primary: #8b5cf6;
                        --color-accent: #ec4899;
                    }
                    body {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    }
                `;
                this.injectStyle(scannerStyle);
                
                this.broadcastThemeChange('gradient');
            }

            removeTheme() {
                localStorage.setItem('gittertier_theme', 'light');
                document.body.classList.remove('night-theme');
                document.body.style.background = '';
                document.documentElement.style = '';
                
                this.broadcastThemeChange('light');
            }

            applyScannerAnimation() {
                const animationStyle = `
                    #scanner-container {
                        animation: pulse 2s infinite;
                    }
                    @keyframes pulse {
                        0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
                        70% { box-shadow: 0 0 0 20px rgba(139, 92, 246, 0); }
                        100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
                    }
                `;
                this.injectStyle(animationStyle, 'scanner-animation');
            }

            applyPriorityProcessing() {
                localStorage.setItem('gittertier_priority', 'true');
                
                // Apply to payment page
                const paymentStyle = `
                    .status.confirmed {
                        animation: bounce 0.5s ease;
                    }
                    @keyframes bounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }
                `;
                this.injectStyle(paymentStyle, 'priority-processing');
            }

            applyAdvancedDashboard() {
                // Enhanced dashboard features
                localStorage.setItem('gittertier_advanced_dashboard', 'true');
                
                // Add enhanced stats to scanner page
                const scannerStats = {
                    totalScans: parseInt(localStorage.getItem('total_scans') || '0'),
                    totalSpent: parseFloat(localStorage.getItem('total_spent') || '0'),
                    favoriteProduct: localStorage.getItem('favorite_product') || 'Keine'
                };
                
                localStorage.setItem('gittertier_dashboard_stats', JSON.stringify(scannerStats));
            }

            applyPointMultiplier() {
                localStorage.setItem('gittertier_point_multiplier', '2.0');
            }

            applyFastCheckout() {
                localStorage.setItem('gittertier_fast_checkout', 'true');
                
                // Modify scanner page for faster checkout
                const fastCheckoutScript = `
                    if (window.location.pathname.includes('index')) {
                        document.querySelector('.pay-btn').addEventListener('click', function() {
                            this.innerHTML = '<i class="fas fa-bolt"></i> Schnellbezahlung';
                            this.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        });
                    }
                `;
                this.injectScript(fastCheckoutScript);
            }

            applyTransactionEffects() {
                localStorage.setItem('gittertier_transaction_effects', 'true');
                
                // Add celebration effects to payment page
                const effectsStyle = `
                    .payment-success {
                        animation: celebrate 1s ease;
                    }
                    @keyframes celebrate {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.1); }
                        100% { transform: scale(1); }
                    }
                `;
                this.injectStyle(effectsStyle, 'transaction-effects');
            }

            applyProfileBadges() {
                localStorage.setItem('gittertier_profile_badges', 'true');
                
                // Add badge to scanner page header
                const badgeHtml = `
                    <div class="profile-badge" style="
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        background: linear-gradient(135deg, #ffd700, #ffed4e);
                        color: #000;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 12px;
                        font-weight: bold;
                        z-index: 100;
                    ">
                        <i class="fas fa-crown"></i> Premium
                    </div>
                `;
                
                // Store badge HTML for injection
                localStorage.setItem('gittertier_badge_html', badgeHtml);
            }

            applyScannerEffects() {
                localStorage.setItem('gittertier_scanner_effects', 'true');
                
                // Enhanced scanner visuals
                const scannerEffects = `
                    #barcode-box {
                        border-color: #8b5cf6;
                        box-shadow: 0 0 15px #8b5cf6;
                    }
                    .scan-line {
                        background: linear-gradient(90deg, transparent, #8b5cf6, transparent);
                        animation: scan 1.5s infinite linear;
                    }
                `;
                this.injectStyle(scannerEffects, 'scanner-effects');
            }

            injectStyle(css, id = 'loyalty-style') {
                // Remove existing style with same ID
                const existing = document.getElementById(id);
                if (existing) existing.remove();
                
                // Create new style element
                const style = document.createElement('style');
                style.id = id;
                style.textContent = css;
                document.head.appendChild(style);
                
                // Store for other pages
                localStorage.setItem(`gittertier_style_${id}`, css);
            }

            injectScript(js) {
                const script = document.createElement('script');
                script.textContent = js;
                document.head.appendChild(script);
            }

            broadcastThemeChange(theme) {
                // Broadcast to other tabs
                localStorage.setItem('gittertier_theme_broadcast', JSON.stringify({
                    theme: theme,
                    timestamp: Date.now()
                }));
            }

            showTierUpgrade(oldTier, newTier) {
                const oldInfo = this.getTierInfo(oldTier);
                const newInfo = this.getTierInfo(newTier);
                
                const message = `Herzlichen Glückwunsch! Sie wurden von ${oldInfo.name} auf ${newInfo.name} befördert!`;
                
                // Show notification
                this.showNotification(message, 'success');
                
                // Create confetti celebration
                this.createConfetti();
            }

            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#10b981' : '#3b82f6'};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            createConfetti() {
                const container = document.getElementById('confetti-container');
                container.style.display = 'block';
                container.innerHTML = '';
                
                const colors = ['#8b5cf6', '#ec4899', '#10b981', '#f59e0b', '#3b82f6'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = Math.random() * 2 + 1 + 's';
                    confetti.style.animationDelay = Math.random() * 1 + 's';
                    container.appendChild(confetti);
                }
                
                setTimeout(() => {
                    container.style.display = 'none';
                    container.innerHTML = '';
                }, 3000);
            }

            updateUI() {
                // Update points display
                document.getElementById('current-balance').textContent = this.data.currentPoints;
                document.getElementById('lifetime-points').textContent = this.data.lifetimePoints;
                document.getElementById('main-points').textContent = this.data.currentPoints;
                
                // Update tier display
                const tierInfo = this.getTierInfo(this.data.currentTier);
                document.getElementById('current-tier').textContent = tierInfo.name;
                document.getElementById('tier-level').textContent = tierInfo.name;
                
                // Update progress bar
                const nextTier = this.getNextTier();
                if (nextTier) {
                    const currentPoints = this.data.lifetimePoints;
                    const minPoints = tierInfo.minPoints;
                    const nextPoints = nextTier.minPoints;
                    const progress = ((currentPoints - minPoints) / (nextPoints - minPoints)) * 100;
                    
                    document.getElementById('progress-fill').style.width = `${Math.min(progress, 100)}%`;
                    document.getElementById('progress-text').textContent = `${currentPoints - minPoints}/${nextPoints - minPoints}`;
                } else {
                    document.getElementById('progress-fill').style.width = '100%';
                    document.getElementById('progress-text').textContent = 'Maximales Level erreicht!';
                }
                
                // Count unlocked features
                const unlockedCount = Object.values(this.features).filter(f => f.unlocked).length;
                document.getElementById('unlocked-features').textContent = unlockedCount;
                
                // Render features grid
                this.renderFeatures();
                
                // Render active benefits
                this.renderActiveBenefits();
            }

            getNextTier() {
                const tiers = ['bronze', 'silver', 'gold', 'platinum', 'diamond'];
                const currentIndex = tiers.indexOf(this.data.currentTier);
                
                if (currentIndex < tiers.length - 1) {
                    return this.getTierInfo(tiers[currentIndex + 1]);
                }
                return null;
            }

            renderFeatures() {
                const container = document.getElementById('features-grid');
                container.innerHTML = '';
                
                FEATURES.forEach((feature, index) => {
                    const isUnlocked = this.isFeatureUnlocked(feature.id);
                    const isActive = this.isFeatureActive(feature.id);
                    const canAfford = this.data.currentPoints >= feature.cost;
                    
                    const card = document.createElement('div');
                    card.className = 'feature-card';
                    card.style.animationDelay = `${index * 0.1}s`;
                    
                    card.innerHTML = `
                        <div class="feature-header">
                            <div class="feature-icon">
                                <i class="${feature.icon}"></i>
                            </div>
                            <div class="feature-cost">${feature.cost} Punkte</div>
                        </div>
                        <h3 class="feature-title">${feature.title}</h3>
                        <p class="feature-description">${feature.description}</p>
                        <div class="feature-status ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                            ${isUnlocked ? (isActive ? 'Aktiviert' : 'Deaktiviert') : 'Gesperrt'}
                        </div>
                        <button class="unlock-btn ${isUnlocked ? 'unlocked' : ''}" 
                                onclick="loyaltyManager.handleFeatureClick('${feature.id}')"
                                ${!isUnlocked && !canAfford ? 'disabled' : ''}>
                            ${isUnlocked ? 
                                (isActive ? 
                                    '<i class="fas fa-toggle-on"></i> Deaktivieren' : 
                                    '<i class="fas fa-toggle-off"></i> Aktivieren') : 
                                (canAfford ? 
                                    '<i class="fas fa-lock-open"></i> Freischalten' : 
                                    'Nicht genug Punkte')}
                        </button>
                    `;
                    
                    container.appendChild(card);
                    
                    // Trigger animation
                    setTimeout(() => {
                        card.classList.add('visible');
                    }, 100);
                });
            }

            renderActiveBenefits() {
                const container = document.getElementById('active-benefits');
                container.innerHTML = '';
                
                const activeFeatures = FEATURES.filter(f => this.isFeatureActive(f.id));
                
                if (activeFeatures.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--color-gray);">
                            <i class="fas fa-gift" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p>Keine aktiven Vorteile. Schalten Sie Features frei, um hier Vorteile zu sehen.</p>
                        </div>
                    `;
                    return;
                }
                
                activeFeatures.forEach(feature => {
                    const item = document.createElement('div');
                    item.className = 'benefit-item';
                    
                    item.innerHTML = `
                        <div class="benefit-icon">
                            <i class="${feature.icon}"></i>
                        </div>
                        <div class="benefit-content">
                            <h4>${feature.title}</h4>
                            <p>${feature.benefit}</p>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            }

            handleFeatureClick(featureId) {
                const feature = FEATURES.find(f => f.id === featureId);
                if (!feature) return;
                
                const isUnlocked = this.isFeatureUnlocked(featureId);
                const isActive = this.isFeatureActive(featureId);
                
                if (!isUnlocked) {
                    // Try to unlock
                    if (this.data.currentPoints >= feature.cost) {
                        if (confirm(`Möchten Sie "${feature.title}" für ${feature.cost} Punkte freischalten?`)) {
                            if (this.spendPoints(feature.cost)) {
                                this.unlockFeature(featureId);
                                this.showNotification(`${feature.title} erfolgreich freigeschaltet!`, 'success');
                                this.createConfetti();
                            }
                        }
                    } else {
                        this.showNotification(`Nicht genug Punkte. Sie benötigen ${feature.cost - this.data.currentPoints} mehr Punkte.`, 'info');
                    }
                } else {
                    // Toggle activation
                    const newState = !isActive;
                    this.toggleFeature(featureId, newState);
                    this.showNotification(
                        `${feature.title} ${newState ? 'aktiviert' : 'deaktiviert'}`,
                        newState ? 'success' : 'info'
                    );
                }
                
                this.updateUI();
            }
        }

        // Features Definition
        const FEATURES = [
            {
                id: 'theme_night',
                title: 'Nacht-Theme',
                icon: 'fas fa-moon',
                description: 'Aktiviert ein elegantes Dunkeldesign für alle Seiten',
                benefit: 'Augenschonendes Dunkeldesign für alle Seiten',
                cost: 100,
                category: 'theme'
            },
            {
                id: 'theme_gradient',
                title: 'Premium Farbverlauf',
                icon: 'fas fa-palette',
                description: 'Exklusive Farbverläufe für Scanner und Bezahlseite',
                benefit: 'Einzigartige Farbverläufe im gesamten System',
                cost: 150,
                category: 'theme'
            },
            {
                id: 'scanner_animation',
                title: 'Scanner Animation',
                icon: 'fas fa-sparkles',
                description: 'Spezielle Puls-Animation für den Barcode-Scanner',
                benefit: 'Verbesserte Scanner-Visuals mit Animationen',
                cost: 200,
                category: 'scanner'
            },
            {
                id: 'priority_processing',
                title: 'Prioritäts-Verarbeitung',
                icon: 'fas fa-bolt',
                description: 'Schnellere Bestätigung von Zahlungen',
                benefit: '20% schnellere Zahlungsbestätigungen',
                cost: 300,
                category: 'payment'
            },
            {
                id: 'advanced_dashboard',
                title: 'Erweitertes Dashboard',
                icon: 'fas fa-chart-line',
                description: 'Detaillierte Statistiken und Einblicke',
                benefit: 'Erweiterte Einkaufsstatistiken und Insights',
                cost: 250,
                category: 'analytics'
            },
            {
                id: 'point_multiplier',
                title: 'Punkt-Multiplikator',
                icon: 'fas fa-rocket',
                description: 'Erhalten Sie 2x Punkte auf alle Einkäufe',
                benefit: 'Doppelte Punkte bei jedem Einkauf',
                cost: 500,
                category: 'points'
            },
            {
                id: 'fast_checkout',
                title: 'Schnellbezahlung',
                icon: 'fas fa-running',
                description: 'Reduzierte Klickzahlen beim Bezahlvorgang',
                benefit: 'Bis zu 50% schnellere Bezahlung',
                cost: 180,
                category: 'payment'
            },
            {
                id: 'transaction_effects',
                title: 'Transaktions-Effekte',
                icon: 'fas fa-fire',
                description: 'Spezielle Animationen bei erfolgreichen Zahlungen',
                benefit: 'Visuelle Bestätigungseffekte nach Zahlungen',
                cost: 120,
                category: 'payment'
            },
            {
                id: 'profile_badges',
                title: 'Profil-Abzeichen',
                icon: 'fas fa-shield-alt',
                description: 'Exklusive Abzeichen in Ihrem Profil',
                benefit: 'Sichtbarer Premium-Status auf allen Seiten',
                cost: 80,
                category: 'profile'
            },
            {
                id: 'scanner_effects',
                title: 'Scanner-Effekte',
                icon: 'fas fa-magic',
                description: 'Verbesserte visuelle Effekte beim Scannen',
                benefit: 'Erweiterte Scanner-Visuals mit Glow-Effekt',
                cost: 220,
                category: 'scanner'
            }
        ];

        // Initialize
        let loyaltyManager;

        document.addEventListener('DOMContentLoaded', function() {
            loyaltyManager = new LoyaltyManager();
            
            // Check for theme broadcast
            const themeBroadcast = localStorage.getItem('gittertier_theme_broadcast');
            if (themeBroadcast) {
                const { theme } = JSON.parse(themeBroadcast);
                if (theme === 'night') {
                    document.body.classList.add('night-theme');
                }
            }
            
            // Apply existing styles
            const styles = ['scanner-animation', 'priority-processing', 'transaction-effects', 'scanner-effects'];
            styles.forEach(id => {
                const css = localStorage.getItem(`gittertier_style_${id}`);
                if (css) {
                    const style = document.createElement('style');
                    style.id = id;
                    style.textContent = css;
                    document.head.appendChild(style);
                }
            });
            
            // Update UI
            loyaltyManager.updateUI();
            
            // Add scroll animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = 1;
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, {
                threshold: 0.1
            });

            document.querySelectorAll('.feature-card').forEach(card => {
                card.style.opacity = 0;
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                observer.observe(card);
            });

            // Add some demo points for testing (remove in production)
            setTimeout(() => {
                if (loyaltyManager.data.currentPoints < 100) {
                    loyaltyManager.addPoints(100, 'Willkommensbonus');
                }
            }, 1000);
        });

        // Expose to global scope for button clicks
        window.loyaltyManager = loyaltyManager;
    </script>
</body>
</html>