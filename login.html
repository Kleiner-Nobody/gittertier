<!DOCTYPE html>
<html lang="de" class="dark-mode-hidden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Anmeldung - Gittertier Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    /* ==================== APPLE LIQUID GLAS DESIGN ==================== */
    :root {
        /* Light Mode - Apple Design System */
        --color-primary: #007AFF;
        --color-primary-dark: #0056CC;
        --color-accent: #5856D6;
        --color-accent-light: #AF52DE;
        --color-success: #34C759;
        --color-warning: #FF9500;
        --color-error: #FF3B30;
        --color-dark: #000000;
        --color-light: #F2F2F7;
        --color-white: #FFFFFF;
        --color-gray: #8E8E93;
        --color-gray-light: #C7C7CC;
        --color-gray-dark: #48484A;
        --color-bg: #F2F2F7;
        --color-text: #000000;
        --color-text-muted: #8E8E93;
        --color-card-bg: #FFFFFF;
        --color-card-bg-glass: rgba(255, 255, 255, 0.7);
        --color-sidebar-bg: rgba(255, 255, 255, 0.8);
        --color-modal-bg: rgba(255, 255, 255, 0.95);
        --color-overlay: rgba(0, 0, 0, 0.5);
        --color-hover-gray: rgba(142, 142, 147, 0.08);
        --color-hover-gray-medium: rgba(142, 142, 147, 0.12);
        
        /* Apple Liquid Glas Effects */
        --glass-blur: blur(20px);
        --glass-border: 1px solid rgba(255, 255, 255, 0.2);
        --glass-border-dark: 1px solid rgba(0, 0, 0, 0.1);
        --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --glass-shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.12);
        --glass-shadow-xl: 0 12px 60px rgba(0, 0, 0, 0.16);
        
        --radius: 16px;
        --radius-sm: 8px;
        --radius-lg: 24px;
        --radius-xl: 28px;
        
        --transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        --transition-slow: all 0.5s cubic-bezier(0.2, 0, 0, 1);
        
        /* Gradients */
        --gradient-primary: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
        --gradient-accent: linear-gradient(135deg, #5856D6 0%, #AF52DE 100%);
        --gradient-success: linear-gradient(135deg, #34C759 0%, #30D158 100%);
        --gradient-warning: linear-gradient(135deg, #FF9500 0%, #FF9F0A 100%);
        --gradient-error: linear-gradient(135deg, #FF3B30 0%, #FF453A 100%);
        --gradient-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.4));
        --gradient-glass-dark: linear-gradient(135deg, rgba(28, 28, 30, 0.8), rgba(28, 28, 30, 0.4));
        --gradient-gray-hover: linear-gradient(135deg, rgba(142, 142, 147, 0.08), rgba(142, 142, 147, 0.12));
        
        /* Font Sizes */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        --text-4xl: 2.25rem;
        
        /* Spacing */
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-xxl: 48px;
        
        /* Layout */
        --header-height: 64px;
        --touch-target: 44px;
        
        /* Depth */
        --depth-1: 0 1px 3px rgba(0, 0, 0, 0.07);
        --depth-2: 0 4px 12px rgba(0, 0, 0, 0.1);
        --depth-3: 0 10px 30px rgba(0, 0, 0, 0.15);
        --depth-4: 0 20px 50px rgba(0, 0, 0, 0.2);
        
        /* Apple System Font Stack */
        --font-system: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Auto Dark Mode based on system preference */
    @media (prefers-color-scheme: dark) {
        :root {
            --color-bg: #000000;
            --color-text: #FFFFFF;
            --color-text-muted: #8E8E93;
            --color-card-bg: #1C1C1E;
            --color-card-bg-glass: rgba(28, 28, 30, 0.7);
            --color-sidebar-bg: rgba(28, 28, 30, 0.8);
            --color-modal-bg: rgba(28, 28, 30, 0.95);
            --color-overlay: rgba(0, 0, 0, 0.7);
            --color-light: #2C2C2E;
            --color-gray: #8E8E93;
            --color-gray-light: #48484A;
            --color-gray-dark: #C7C7CC;
            --color-white: #1C1C1E;
            --color-hover-gray: rgba(174, 174, 178, 0.08);
            --color-hover-gray-medium: rgba(174, 174, 178, 0.12);
            
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-border-dark: 1px solid rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            --glass-shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
            --glass-shadow-xl: 0 12px 60px rgba(0, 0, 0, 0.5);
            
            --gradient-gray-hover: linear-gradient(135deg, rgba(174, 174, 178, 0.08), rgba(174, 174, 178, 0.12));
            --gradient-glass: linear-gradient(135deg, rgba(28, 28, 30, 0.8), rgba(28, 28, 30, 0.4));
            
            --depth-1: 0 1px 3px rgba(0, 0, 0, 0.3);
            --depth-2: 0 4px 12px rgba(0, 0, 0, 0.4);
            --depth-3: 0 10px 30px rgba(0, 0, 0, 0.5);
            --depth-4: 0 20px 50px rgba(0, 0, 0, 0.6);
        }
    }

    /* Manual Dark Mode Class */
    .dark-mode {
        --color-bg: #000000;
        --color-text: #FFFFFF;
        --color-text-muted: #8E8E93;
        --color-card-bg: #1C1C1E;
        --color-card-bg-glass: rgba(28, 28, 30, 0.7);
        --color-sidebar-bg: rgba(28, 28, 30, 0.8);
        --color-modal-bg: rgba(28, 28, 30, 0.95);
        --color-overlay: rgba(0, 0, 0, 0.7);
        --color-light: #2C2C2E;
        --color-gray: #8E8E93;
        --color-gray-light: #48484A;
        --color-gray-dark: #C7C7CC;
        --color-white: #1C1C1E;
        --color-hover-gray: rgba(174, 174, 178, 0.08);
        --color-hover-gray-medium: rgba(174, 174, 178, 0.12);
        
        --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        --glass-border-dark: 1px solid rgba(255, 255, 255, 0.1);
        --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        --glass-shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
        --glass-shadow-xl: 0 12px 60px rgba(0, 0, 0, 0.5);
        
        --gradient-gray-hover: linear-gradient(135deg, rgba(174, 174, 178, 0.08), rgba(174, 174, 178, 0.12));
        --gradient-glass: linear-gradient(135deg, rgba(28, 28, 30, 0.8), rgba(28, 28, 30, 0.4));
        
        --depth-1: 0 1px 3px rgba(0, 0, 0, 0.3);
        --depth-2: 0 4px 12px rgba(0, 0, 0, 0.4);
        --depth-3: 0 10px 30px rgba(0, 0, 0, 0.5);
        --depth-4: 0 20px 50px rgba(0, 0, 0, 0.6);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: var(--font-system);
        background: var(--color-bg);
        color: var(--color-text);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
        transition: var(--transition-slow);
    }

    /* ==================== HEADER - APPLE STYLE ==================== */
    .admin-header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-lg);
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-bottom: var(--glass-border);
        min-height: var(--touch-target);
    }

    @media (max-width: 480px) {
        .admin-header {
            padding: 0 var(--spacing-sm);
        }
    }

    .logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        font-weight: 700;
        font-size: var(--text-xl);
        color: var(--color-primary);
        min-height: var(--touch-target);
    }

    .logo i {
        font-size: var(--text-xl);
        color: var(--color-primary);
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header-controls {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
    }

    .theme-toggle {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        color: var(--color-text);
        border: var(--glass-border);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        min-height: var(--touch-target);
        min-width: var(--touch-target);
        box-shadow: var(--glass-shadow);
    }

    .theme-toggle:hover, .theme-toggle:active, .theme-toggle:focus {
        background: var(--gradient-gray-hover);
        transform: translateY(-1px);
        box-shadow: var(--glass-shadow-lg);
    }

    .time-display {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-size: var(--text-sm);
        color: var(--color-text);
        min-height: var(--touch-target);
        display: flex;
        align-items: center;
        border: var(--glass-border);
        box-shadow: var(--glass-shadow);
    }

    /* ==================== MAIN CONTENT ==================== */
    main {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-xl) var(--spacing-lg);
        min-height: calc(100vh - var(--header-height));
    }

    /* ==================== LOGIN CONTAINER ==================== */
    .login-container {
        width: 100%;
        max-width: 480px;
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-xl);
        border: var(--glass-border);
        box-shadow: var(--glass-shadow-xl);
        padding: var(--spacing-xl);
        animation: scaleIn 0.4s cubic-bezier(0.2, 0, 0, 1);
        position: relative;
        overflow: hidden;
    }

    .login-container::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
        animation: shimmer 3s infinite linear;
    }

    .login-content {
        position: relative;
        z-index: 1;
    }

    /* ==================== LOGIN HEADER ==================== */
    .login-header {
        text-align: center;
        margin-bottom: var(--spacing-xl);
    }

    .login-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--spacing-lg);
        box-shadow: var(--glass-shadow-lg);
        position: relative;
        overflow: hidden;
    }

    .login-icon::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
        animation: shimmer 2s infinite linear;
    }

    .login-icon i {
        font-size: var(--text-3xl);
        color: white;
        position: relative;
        z-index: 1;
    }

    .login-title {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-sm);
        line-height: 1.2;
    }

    .login-subtitle {
        color: var(--color-text-muted);
        font-size: var(--text-base);
        line-height: 1.4;
    }

    /* ==================== LOGIN FORM ==================== */
    .login-form {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
    }

    .input-group {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .input-label {
        font-weight: 600;
        font-size: var(--text-sm);
        color: var(--color-text);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .input-label i {
        color: var(--color-primary);
    }

    .password-container {
        position: relative;
        display: flex;
        align-items: center;
    }

    .login-input {
        width: 100%;
        padding: var(--spacing-md);
        border: var(--glass-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        background: var(--gradient-glass);
        color: var(--color-text);
        transition: var(--transition);
        padding-right: 50px;
        min-height: var(--touch-target);
        line-height: 1.4;
        backdrop-filter: var(--glass-blur);
    }

    .login-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
    }

    .toggle-password {
        position: absolute;
        right: var(--spacing-sm);
        background: var(--gradient-glass);
        border: var(--glass-border);
        color: var(--color-text-muted);
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        transition: var(--transition);
        width: var(--touch-target);
        height: var(--touch-target);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .toggle-password:hover, .toggle-password:active, .toggle-password:focus {
        background: var(--color-hover-gray);
        color: var(--color-text);
    }

    /* ==================== REMEMBER ME SWITCH ==================== */
    .stay-logged-container {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin: var(--spacing-sm) 0;
        padding: var(--spacing-sm);
        border-radius: var(--radius);
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        border: var(--glass-border);
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-gray-light);
        transition: var(--transition);
        border-radius: 34px;
        box-shadow: var(--glass-shadow);
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: var(--transition);
        border-radius: 50%;
        box-shadow: var(--depth-1);
    }

    input:checked + .slider {
        background: var(--gradient-primary);
    }

    input:checked + .slider:before {
        transform: translateX(20px);
    }

    .stay-logged-label {
        font-size: var(--text-sm);
        color: var(--color-text);
        font-weight: 500;
        flex: 1;
    }

    /* ==================== LOGIN BUTTON ==================== */
    .login-button {
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius);
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--text-base);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
        box-shadow: var(--glass-shadow);
        min-height: var(--touch-target);
        position: relative;
        overflow: hidden;
    }

    .login-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }

    .login-button:hover, .login-button:active, .login-button:focus {
        background: var(--color-primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--glass-shadow-lg);
    }

    .login-button:hover::before {
        left: 100%;
    }

    .login-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: var(--glass-shadow);
    }

    .login-button:disabled:hover::before {
        left: -100%;
    }

    /* ==================== ERROR MESSAGE ==================== */
    .error-message {
        background: rgba(255, 59, 48, 0.1);
        backdrop-filter: var(--glass-blur);
        color: var(--color-error);
        text-align: center;
        padding: var(--spacing-md);
        border-radius: var(--radius);
        display: none;
        animation: fadeIn 0.3s ease;
        border: var(--glass-border);
        font-size: var(--text-sm);
        margin-top: var(--spacing-md);
    }

    .error-message i {
        margin-right: var(--spacing-sm);
    }

    /* ==================== SECURITY INFO ==================== */
    .security-info {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        color: var(--color-success);
        padding: var(--spacing-md);
        background: rgba(52, 199, 89, 0.1);
        backdrop-filter: var(--glass-blur);
        border-radius: var(--radius);
        font-size: var(--text-xs);
        margin-top: var(--spacing-md);
        border: var(--glass-border);
    }

    .security-info i {
        font-size: var(--text-lg);
    }

    /* ==================== ACTIVITY LOG ==================== */
    .activity-log {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        border-radius: var(--radius);
        padding: var(--spacing-md);
        margin-top: var(--spacing-xl);
        border: var(--glass-border);
        max-height: 200px;
        overflow-y: auto;
    }

    .activity-log h3 {
        font-size: var(--text-sm);
        color: var(--color-text);
        margin-bottom: var(--spacing-md);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .activity-log h3 i {
        color: var(--color-primary);
    }

    .activity-item {
        font-size: var(--text-xs);
        padding: var(--spacing-sm) 0;
        border-bottom: var(--glass-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-message {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding-right: var(--spacing-sm);
    }

    .activity-time {
        color: var(--color-text-muted);
        font-size: 0.7rem;
        white-space: nowrap;
    }

    /* ==================== SESSION TIMEOUT WARNING ==================== */
    .session-timeout {
        position: fixed;
        bottom: var(--spacing-lg);
        right: var(--spacing-lg);
        background: var(--gradient-error);
        color: white;
        padding: var(--spacing-md) var(--spacing-lg);
        border-radius: var(--radius-lg);
        box-shadow: var(--glass-shadow-xl);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        z-index: 100;
        border: var(--glass-border);
        backdrop-filter: var(--glass-blur);
    }

    .session-timeout.active {
        transform: translateY(0);
        opacity: 1;
    }

    .session-timeout .countdown {
        font-weight: 700;
        font-size: var(--text-lg);
    }

    .session-timeout button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        backdrop-filter: var(--glass-blur);
        border: var(--glass-border);
        min-height: 36px;
    }

    .session-timeout button:hover, .session-timeout button:active, .session-timeout button:focus {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
    }

    /* ==================== MODALS ==================== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        display: none;
        padding: var(--spacing-md);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .modal-overlay.active {
        display: flex;
        animation: fadeIn 0.3s ease;
    }

    .modal {
        background: var(--color-modal-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        width: 100%;
        max-width: 500px;
        box-shadow: var(--glass-shadow-xl);
        border: var(--glass-border);
        animation: scaleIn 0.3s cubic-bezier(0.2, 0, 0, 1);
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .modal-title {
        font-size: var(--text-xl);
        font-weight: 600;
        line-height: 1.2;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .modal-header i {
        font-size: var(--text-2xl);
        color: var(--color-error);
    }

    .close-modal {
        background: var(--gradient-glass);
        border: var(--glass-border);
        font-size: var(--text-xl);
        color: var(--color-text);
        cursor: pointer;
        width: var(--touch-target);
        height: var(--touch-target);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .close-modal:hover, .close-modal:active, .close-modal:focus {
        background: var(--color-hover-gray);
        transform: rotate(90deg);
    }

    .modal-body {
        margin-bottom: var(--spacing-lg);
    }

    .modal-message {
        color: var(--color-text);
        margin-bottom: var(--spacing-md);
        line-height: 1.6;
    }

    .redirect-path-display {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        border-radius: var(--radius);
        padding: var(--spacing-md);
        margin: var(--spacing-md) 0;
        font-family: 'SF Mono', Monaco, 'Cascadia Mono', 'Segoe UI Mono', 'Roboto Mono', monospace;
        font-size: var(--text-sm);
        color: var(--color-error);
        overflow: hidden;
        text-overflow: ellipsis;
        border: var(--glass-border);
        word-break: break-all;
    }

    .modal-actions {
        display: flex;
        gap: var(--spacing-md);
        justify-content: flex-end;
        flex-wrap: wrap;
    }

    .modal-btn {
        padding: var(--spacing-md) var(--spacing-lg);
        border: none;
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        min-height: var(--touch-target);
        flex: 1;
        justify-content: center;
        text-align: center;
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        border: var(--glass-border);
        color: var(--color-text);
    }

    .modal-btn.primary {
        background: var(--gradient-primary);
        color: white;
        border: none;
    }

    .modal-btn.primary:hover, .modal-btn.primary:active, .modal-btn.primary:focus {
        background: var(--color-primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--glass-shadow);
    }

    .modal-btn.secondary:hover, .modal-btn.secondary:active, .modal-btn.secondary:focus {
        background: var(--color-hover-gray);
        transform: translateY(-1px);
    }

    /* ==================== LOADER ==================== */
    .loader {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }

    /* ==================== ANIMATIONS ==================== */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes scaleIn {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-8px); }
        40%, 80% { transform: translateX(8px); }
    }

    /* ==================== RESPONSIVE DESIGN ==================== */
    @media (max-width: 768px) {
        .login-container {
            padding: var(--spacing-lg);
        }
        
        .login-title {
            font-size: var(--text-xl);
        }
        
        .login-icon {
            width: 64px;
            height: 64px;
        }
        
        .login-icon i {
            font-size: var(--text-2xl);
        }
        
        .session-timeout {
            left: var(--spacing-md);
            right: var(--spacing-md);
            bottom: var(--spacing-md);
            flex-direction: column;
            text-align: center;
            gap: var(--spacing-sm);
        }
        
        .modal-actions {
            flex-direction: column;
        }
        
        .admin-header {
            padding: 0 var(--spacing-md);
        }
        
        .time-display {
            display: none;
        }
    }

    @media (max-width: 480px) {
        .login-container {
            padding: var(--spacing-md);
        }
        
        .modal {
            padding: var(--spacing-lg);
        }
        
        .session-timeout {
            padding: var(--spacing-sm);
        }
        
        .modal-btn {
            width: 100%;
        }
    }

    /* Enhanced mobile accessibility */
    @media (hover: none) and (pointer: coarse) {
        .login-input,
        .toggle-password,
        .theme-toggle,
        .login-button,
        .modal-btn {
            min-height: 48px;
        }
        
        .login-input {
            font-size: 16px;
        }
        
        .switch {
            width: 52px;
            height: 32px;
        }
        
        .slider:before {
            height: 26px;
            width: 26px;
            left: 3px;
            bottom: 3px;
        }
        
        input:checked + .slider:before {
            transform: translateX(20px);
        }
    }

    /* Improved scrollbars */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--color-light);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--color-gray-light);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--color-gray);
    }

    /* Better focus styles for accessibility */
    *:focus-visible {
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
    }

    /* Loading states */
    .loading {
        opacity: 0.7;
        pointer-events: none;
        position: relative;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 24px;
        height: 24px;
        border: 2px solid var(--glass-border);
        border-top-color: var(--color-primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-top: -12px;
        margin-left: -12px;
    }

    /* iOS specific styles */
    @supports (-webkit-touch-callout: none) {
        .login-container,
        .modal {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .session-timeout {
            bottom: calc(var(--spacing-lg) + env(safe-area-inset-bottom));
        }
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        .login-container::before,
        .login-icon::before {
            animation: none;
        }
        
        .login-button::before {
            transition: none;
        }
    }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="admin-header">
        <div class="logo">
            <i class="fas fa-shopping-cart"></i>
            <span>Gittertier Pro</span>
        </div>
        <div class="header-controls">
            <div class="time-display" id="timeDisplay"></div>
            <button class="theme-toggle touch-feedback" id="themeToggle" aria-label="Design wechseln">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main>
        <div class="login-container">
            <div class="login-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h1 class="login-title">Administrator-Anmeldung</h1>
                    <p class="login-subtitle">Sichere Anmeldung für Gittertier Pro Dashboard</p>
                </div>
                
                <form class="login-form" id="loginForm">
                    <div class="input-group">
                        <label class="input-label" for="passwordInput">
                            <i class="fas fa-key"></i>
                            Passwort
                        </label>
                        <div class="password-container">
                            <input type="password" 
                                   class="login-input touch-feedback" 
                                   placeholder="Passwort eingeben"
                                   id="passwordInput"
                                   required
                                   autocomplete="current-password"
                                   aria-required="true">
                            <button type="button" class="toggle-password touch-feedback" id="togglePassword" aria-label="Passwort anzeigen/verbergen">
                                <i class="far fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="stay-logged-container touch-feedback">
                        <label class="switch">
                            <input type="checkbox" id="stayLoggedIn">
                            <span class="slider"></span>
                        </label>
                        <span class="stay-logged-label">Angemeldet bleiben (für 24 Stunden)</span>
                    </div>
                    
                    <button type="submit" class="login-button touch-feedback" id="loginButton">
                        <i class="fas fa-sign-in-alt"></i>
                        Anmelden
                    </button>
                    
                    <div class="error-message touch-feedback" id="errorMessage" role="alert" aria-live="assertive">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="errorText">Falsches Passwort. Bitte versuchen Sie es erneut.</span>
                    </div>
                    
                    <div class="security-info touch-feedback">
                        <i class="fas fa-shield-alt"></i>
                        <span>Ende-zu-Ende verschlüsselte Verbindung • Sicherheitsebene: Hoch</span>
                    </div>
                    
                    <div class="activity-log" id="activityLogContainer">
                        <h3><i class="fas fa-history"></i> Letzte Anmeldeaktivitäten</h3>
                        <div id="activityLog">
                            <!-- Activity items will be added here -->
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
    
    <!-- Session Timeout Warning -->
    <div class="session-timeout" id="sessionTimeout" role="alert" aria-live="assertive">
        <i class="fas fa-clock"></i>
        <div class="session-info">
            <span>Ihre Sitzung läuft ab in: <span class="countdown" id="timeoutCountdown">60</span> Sekunden</span>
        </div>
        <button class="touch-feedback" id="extendSession" aria-label="Sitzung verlängern">
            <i class="fas fa-sync-alt"></i>
            <span>Verlängern</span>
        </button>
    </div>
    
    <!-- Error Modal -->
    <div class="modal-overlay" id="errorModal" role="dialog" aria-labelledby="errorModalTitle" aria-hidden="true">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="errorModalTitle">
                    <i class="fas fa-exclamation-triangle"></i>
                    Kritischer Fehler
                </h2>
                <button class="close-modal touch-feedback" id="closeErrorModal" aria-label="Modal schließen">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-message">Keine Weiterleitungs-URL spezifiziert!</p>
                <p class="modal-message">Die Anmeldung kann nicht fortgesetzt werden, da keine gültige Weiterleitungs-URL angegeben wurde.</p>
                
                <div class="redirect-path-display" id="redirectPathDisplay" aria-label="Weiterleitungspfad">
                    Keine Weiterleitung angegeben
                </div>
                
                <div class="modal-message">
                    <i class="fas fa-info-circle" style="color: var(--color-primary); margin-right: var(--spacing-sm);"></i>
                    Bitte stellen Sie sicher, dass Sie über eine gültige Einladungs-URL auf diese Seite gelangt sind.
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary touch-feedback" id="goToHome" aria-label="Zur Hauptseite gehen">
                    <i class="fas fa-home"></i>
                    Zur Hauptseite
                </button>
                <button class="modal-btn primary touch-feedback" id="retryLogin" aria-label="Erneut versuchen">
                    <i class="fas fa-redo"></i>
                    Erneut versuchen
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== APPLICATION INITIALIZATION ====================
        // DOM elements
        const loginForm = document.getElementById('loginForm');
        const passwordInput = document.getElementById('passwordInput');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const togglePassword = document.getElementById('togglePassword');
        const errorModal = document.getElementById('errorModal');
        const redirectPathDisplay = document.getElementById('redirectPathDisplay');
        const sessionTimeout = document.getElementById('sessionTimeout');
        const timeoutCountdown = document.getElementById('timeoutCountdown');
        const extendSessionBtn = document.getElementById('extendSession');
        const activityLog = document.getElementById('activityLog');
        const activityLogContainer = document.getElementById('activityLogContainer');
        const stayLoggedIn = document.getElementById('stayLoggedIn');
        const loginButton = document.getElementById('loginButton');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const timeDisplay = document.getElementById('timeDisplay');
        const closeErrorModal = document.getElementById('closeErrorModal');
        const goToHome = document.getElementById('goToHome');
        const retryLogin = document.getElementById('retryLogin');
        const passwordEyeIcon = togglePassword.querySelector('i');

        // State variables
        let timeoutTimer;
        let countdownInterval;
        let countdown = 60;
        let redirectPath = '';
        let activityItems = [];
        let failedAttempts = 0;
        let lockoutTime = 0;
        let isPasswordVisible = false;

        // ==================== THEME MANAGEMENT ====================
        // Initialize theme based on system preference or saved setting
        function initTheme() {
            try {
                const savedTheme = localStorage.getItem('darkMode');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme === 'enabled' || (!savedTheme && systemPrefersDark)) {
                    enableDarkMode();
                } else if (savedTheme === 'disabled') {
                    disableDarkMode();
                }
                // If no saved preference and system doesn't prefer dark, keep light mode
            } catch (error) {
                console.error('Error initializing theme:', error);
            }
        }

        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            localStorage.setItem('darkMode', 'enabled');
        }

        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
            localStorage.setItem('darkMode', 'disabled');
        }

        function toggleTheme() {
            const isDark = document.body.classList.contains('dark-mode');
            if (isDark) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
            addActivity('Design geändert: ' + (isDark ? 'Hell' : 'Dunkel'));
        }

        // ==================== TIME DISPLAY ====================
        function updateTime() {
            try {
                const now = new Date();
                
                if (timeDisplay) {
                    const timeString = now.toLocaleTimeString('de-DE', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: window.innerWidth <= 768 ? undefined : '2-digit'
                    });
                    const dateString = now.toLocaleDateString('de-DE', {
                        weekday: window.innerWidth <= 768 ? 'short' : 'long',
                        day: '2-digit',
                        month: window.innerWidth <= 768 ? 'short' : 'long',
                        year: window.innerWidth <= 768 ? undefined : 'numeric'
                    });
                    timeDisplay.textContent = window.innerWidth <= 768 ? 
                        `${dateString}, ${timeString}` : 
                        `${dateString}, ${timeString}`;
                }
            } catch (error) {
                console.error('Error updating time:', error);
            }
        }

        // ==================== ACTIVITY LOG MANAGEMENT ====================
        function addActivity(message, isError = false) {
            try {
                const now = new Date();
                const timeString = now.toLocaleTimeString('de-DE', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                const dateString = now.toLocaleDateString('de-DE');
                
                activityItems.unshift({
                    message,
                    time: `${dateString} ${timeString}`,
                    isError,
                    timestamp: now.getTime()
                });
                
                // Keep only last 5 items
                if (activityItems.length > 5) {
                    activityItems = activityItems.slice(0, 5);
                }
                
                // Update activity log display
                updateActivityLogDisplay();
                
                // Save activities to localStorage
                localStorage.setItem('loginActivities', JSON.stringify(activityItems));
            } catch (error) {
                console.error('Error adding activity:', error);
            }
        }

        function updateActivityLogDisplay() {
            try {
                activityLog.innerHTML = '';
                
                if (activityItems.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'activity-item';
                    emptyMessage.innerHTML = `
                        <span class="activity-message">Keine Aktivitäten vorhanden</span>
                        <span class="activity-time">-</span>
                    `;
                    activityLog.appendChild(emptyMessage);
                    return;
                }
                
                activityItems.forEach(item => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    activityItem.innerHTML = `
                        <span class="activity-message" style="${item.isError ? 'color: var(--color-error)' : ''}">
                            ${item.isError ? '<i class="fas fa-exclamation-circle"></i> ' : '<i class="fas fa-info-circle"></i> '}
                            ${item.message}
                        </span>
                        <span class="activity-time">${item.time}</span>
                    `;
                    activityLog.appendChild(activityItem);
                });
            } catch (error) {
                console.error('Error updating activity log display:', error);
            }
        }

        function loadActivities() {
            try {
                const savedActivities = localStorage.getItem('loginActivities');
                if (savedActivities) {
                    activityItems = JSON.parse(savedActivities);
                    
                    // Remove activities older than 7 days
                    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    activityItems = activityItems.filter(item => item.timestamp > sevenDaysAgo);
                    
                    updateActivityLogDisplay();
                }
            } catch (error) {
                console.error('Error loading activities:', error);
                activityItems = [];
            }
        }

        // ==================== SESSION MANAGEMENT ====================
        function startSessionTimer() {
            try {
                clearTimeout(timeoutTimer);
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
                
                countdown = 300; // 5 minutes
                sessionTimeout.classList.remove('active');
                
                timeoutTimer = setTimeout(() => {
                    sessionTimeout.classList.add('active');
                    countdown = 60;
                    timeoutCountdown.textContent = countdown;
                    
                    countdownInterval = setInterval(() => {
                        countdown--;
                        timeoutCountdown.textContent = countdown;
                        
                        if (countdown <= 0) {
                            clearInterval(countdownInterval);
                            handleSessionExpired();
                        }
                    }, 1000);
                }, 5 * 60 * 1000); // 5 minutes
            } catch (error) {
                console.error('Error starting session timer:', error);
            }
        }

        function extendSession() {
            startSessionTimer();
            addActivity('Sitzung verlängert');
            showNotification('Sitzung erfolgreich verlängert', 'success');
        }

        function handleSessionExpired() {
            addActivity('Sitzung abgelaufen - automatische Aktualisierung', true);
            showNotification('Sitzung abgelaufen, Seite wird aktualisiert', 'warning');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }

        // ==================== SECURITY FUNCTIONS ====================
        function isLockedOut() {
            if (lockoutTime > Date.now()) {
                const remainingTime = Math.ceil((lockoutTime - Date.now()) / 1000);
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                
                errorText.textContent = `Zu viele fehlgeschlagene Versuche. Bitte warten Sie ${minutes}:${seconds.toString().padStart(2, '0')} Minuten.`;
                errorMessage.style.display = 'flex';
                
                // Update countdown in error message
                const lockoutInterval = setInterval(() => {
                    const newRemainingTime = Math.ceil((lockoutTime - Date.now()) / 1000);
                    if (newRemainingTime <= 0) {
                        clearInterval(lockoutInterval);
                        errorMessage.style.display = 'none';
                        failedAttempts = 0;
                        return;
                    }
                    const newMinutes = Math.floor(newRemainingTime / 60);
                    const newSeconds = newRemainingTime % 60;
                    errorText.textContent = `Zu viele fehlgeschlagene Versuche. Bitte warten Sie ${newMinutes}:${newSeconds.toString().padStart(2, '0')} Minuten.`;
                }, 1000);
                
                return true;
            }
            return false;
        }

        function handleFailedLogin() {
            failedAttempts++;
            addActivity('Fehlgeschlagener Anmeldeversuch', true);
            
            if (failedAttempts >= 5) {
                lockoutTime = Date.now() + (5 * 60 * 1000); // 5 minute lockout
                errorText.textContent = 'Zu viele fehlgeschlagene Versuche. Bitte warten Sie 5 Minuten.';
                errorMessage.style.display = 'flex';
            } else {
                errorText.textContent = `Falsches Passwort. Noch ${5 - failedAttempts} Versuche übrig.`;
                errorMessage.style.display = 'flex';
            }
            
            // Shake animation for error
            loginForm.style.animation = 'shake 0.5s';
            setTimeout(() => {
                loginForm.style.animation = '';
            }, 500);
            
            // Auto-hide error after 5 seconds
            setTimeout(() => {
                if (errorMessage.style.display === 'flex') {
                    errorMessage.style.display = 'none';
                }
            }, 5000);
        }

        // ==================== PASSWORD MANAGEMENT ====================
        function initializePassword() {
            if (!localStorage.getItem('adminPassword')) {
                // Default password (in a real app, this should be set by the user)
                localStorage.setItem('adminPassword', 'GITTERTIER');
            }
        }

        function togglePasswordVisibility() {
            isPasswordVisible = !isPasswordVisible;
            passwordInput.type = isPasswordVisible ? 'text' : 'password';
            
            if (isPasswordVisible) {
                passwordEyeIcon.classList.remove('fa-eye');
                passwordEyeIcon.classList.add('fa-eye-slash');
                togglePassword.setAttribute('aria-label', 'Passwort verbergen');
            } else {
                passwordEyeIcon.classList.remove('fa-eye-slash');
                passwordEyeIcon.classList.add('fa-eye');
                togglePassword.setAttribute('aria-label', 'Passwort anzeigen');
            }
            
            addActivity('Passwort-Sichtbarkeit geändert');
        }

        // ==================== REDIRECT PATH MANAGEMENT ====================
        function getRedirectPath() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const redirectParam = urlParams.get('redirect');
                
                if (!redirectParam) {
                    // Check if we have a stored redirect path
                    const storedRedirect = localStorage.getItem('redirectPath');
                    if (storedRedirect) {
                        try {
                            return atob(storedRedirect);
                        } catch (e) {
                            console.error('Error decoding stored redirect URL:', e);
                            return storedRedirect;
                        }
                    }
                    
                    // No redirect specified, show error modal
                    showErrorModal();
                    return null;
                }
                
                try {
                    // Store the redirect path in localStorage and remove from URL
                    localStorage.setItem('redirectPath', redirectParam);
                    
                    // Clean the URL by removing the redirect parameter
                    const cleanUrl = window.location.origin + window.location.pathname;
                    window.history.replaceState({}, document.title, cleanUrl);
                    
                    return atob(redirectParam);
                } catch (e) {
                    console.error('Error decoding redirect URL:', e);
                    return redirectParam;
                }
            } catch (error) {
                console.error('Error getting redirect path:', error);
                showErrorModal();
                return null;
            }
        }

        function clearRedirectPath() {
            localStorage.removeItem('redirectPath');
        }

        // ==================== TOKEN MANAGEMENT ====================
        function generateToken() {
            try {
                const tokens = JSON.parse(sessionStorage.getItem('validTokens') || '[]');
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let token;
                
                do {
                    token = '';
                    for(let i = 0; i < 64; i++) {
                        token += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                } while(tokens.includes(token));

                tokens.push(token);
                sessionStorage.setItem('validTokens', JSON.stringify(tokens));
                return token;
            } catch (error) {
                console.error('Error generating token:', error);
                return 'error-token-' + Date.now();
            }
        }

        // ==================== MODAL MANAGEMENT ====================
        function showErrorModal() {
            errorModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            const currentPath = window.location.href;
            redirectPathDisplay.textContent = currentPath.length > 50 ? 
                currentPath.substring(0, 47) + '...' : 
                currentPath;
        }

        function hideErrorModal() {
            errorModal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // ==================== NOTIFICATION SYSTEM ====================
        function showNotification(message, type = 'info') {
            try {
                // Create notification element if it doesn't exist
                let notification = document.querySelector('.notification-toast');
                if (!notification) {
                    notification = document.createElement('div');
                    notification.className = 'notification-toast';
                    document.body.appendChild(notification);
                    
                    // Add styles for notification
                    const style = document.createElement('style');
                    style.textContent = `
                        .notification-toast {
                            position: fixed;
                            top: 100px;
                            right: var(--spacing-lg);
                            background: var(--color-card-bg-glass);
                            backdrop-filter: var(--glass-blur);
                            border: var(--glass-border);
                            border-radius: var(--radius);
                            padding: var(--spacing-md) var(--spacing-lg);
                            box-shadow: var(--glass-shadow-lg);
                            transform: translateX(100%);
                            opacity: 0;
                            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1), opacity 0.3s ease;
                            z-index: 9999;
                            max-width: 300px;
                            pointer-events: none;
                            display: flex;
                            align-items: center;
                            gap: var(--spacing-sm);
                        }
                        .notification-toast.show {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        .notification-toast.success {
                            border-left: 4px solid var(--color-success);
                        }
                        .notification-toast.error {
                            border-left: 4px solid var(--color-error);
                        }
                        .notification-toast.warning {
                            border-left: 4px solid var(--color-warning);
                        }
                        .notification-toast.info {
                            border-left: 4px solid var(--color-primary);
                        }
                        @media (max-width: 768px) {
                            .notification-toast {
                                left: var(--spacing-md);
                                right: var(--spacing-md);
                                top: 80px;
                                max-width: none;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                notification.textContent = message;
                notification.className = 'notification-toast';
                if (type) notification.classList.add(type);
                
                // Remove any existing show class
                notification.classList.remove('show');
                
                // Trigger reflow
                void notification.offsetWidth;
                
                // Add show class
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.textContent === message) {
                            notification.textContent = '';
                            notification.className = 'notification-toast';
                        }
                    }, 300);
                }, 3000);
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }

        // ==================== FORM SUBMISSION HANDLER ====================
        async function handleLoginSubmit(e) {
            e.preventDefault();
            
            // Check if locked out
            if (isLockedOut()) {
                return;
            }
            
            if (redirectPath === null) {
                showErrorModal();
                return;
            }
            
            // Get stored password
            const storedPassword = localStorage.getItem('adminPassword');
            
            if (passwordInput.value === storedPassword) {
                // Reset failed attempts
                failedAttempts = 0;
                
                // Show loading state
                loginButton.innerHTML = '<span class="loader"></span> Anmeldung läuft...';
                loginButton.disabled = true;
                
                // Add success activity
                addActivity('Anmeldung erfolgreich');
                
                // Generate token
                const token = generateToken();
                
                // Store token if "Stay Logged In" is checked
                if (stayLoggedIn.checked) {
                    const authToken = {
                        token: token,
                        expires: Date.now() + (24 * 60 * 60 * 1000) // 1 day
                    };
                    localStorage.setItem('authToken', JSON.stringify(authToken));
                }
                
                // Create target URL with token
                const targetUrl = new URL(redirectPath, window.location.origin);
                targetUrl.searchParams.set('token', encodeURIComponent(token));
                
                // Clear the redirect path from localStorage
                clearRedirectPath();
                
                // Simulate authentication delay for better UX
                await new Promise(resolve => setTimeout(resolve, 1200));
                
                // Redirect to target URL
                window.location.href = targetUrl.toString();
            } else {
                handleFailedLogin();
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize theme
                initTheme();
                
                // Initialize password
                initializePassword();
                
                // Load activities
                loadActivities();
                
                // Set up time display
                updateTime();
                setInterval(updateTime, 1000);
                
                // Get redirect path
                redirectPath = getRedirectPath();
                
                // If redirect path exists, continue initialization
                if (redirectPath !== null) {
                    // Check for valid auth token
                    const authToken = JSON.parse(localStorage.getItem('authToken'));
                    if (authToken && authToken.expires > Date.now()) {
                        // Auto-login with stored token
                        const token = generateToken();
                        const targetUrl = new URL(redirectPath, window.location.origin);
                        targetUrl.searchParams.set('token', encodeURIComponent(token));
                        
                        // Show loading state
                        loginButton.innerHTML = '<span class="loader"></span> Automatische Anmeldung...';
                        loginButton.disabled = true;
                        
                        // Clear the redirect path from localStorage
                        clearRedirectPath();
                        
                        // Add activity
                        addActivity('Automatische Anmeldung mit gespeichertem Token');
                        
                        // Simulate delay
                        await new Promise(resolve => setTimeout(resolve, 800));
                        
                        // Redirect
                        window.location.href = targetUrl.toString();
                        return;
                    }
                    
                    // Check app settings for stay logged in option
                    const appSettings = JSON.parse(localStorage.getItem('appSettings')) || {};
                    if (appSettings.stayLoggedIn) {
                        stayLoggedIn.checked = true;
                    }
                    
                    // Focus password field
                    passwordInput.focus();
                    
                    // Add initial activity
                    addActivity('Anmeldeseite geladen');
                    
                    // Start session timer
                    startSessionTimer();
                    
                    // Show welcome notification
                    setTimeout(() => {
                        showNotification('Willkommen bei Gittertier Pro', 'info');
                    }, 1000);
                }
            } catch (error) {
                console.error('Error during initialization:', error);
                addActivity('Fehler bei der Initialisierung: ' + error.message, true);
            }
        });

        // ==================== EVENT LISTENERS ====================
        // Theme toggle
        themeToggle.addEventListener('click', toggleTheme);
        
        // Password visibility toggle
        togglePassword.addEventListener('click', togglePasswordVisibility);
        
        // Extend session button
        extendSessionBtn.addEventListener('click', extendSession);
        
        // Form submission
        loginForm.addEventListener('submit', handleLoginSubmit);
        
        // Modal buttons
        closeErrorModal.addEventListener('click', hideErrorModal);
        
        goToHome.addEventListener('click', () => {
            hideErrorModal();
            window.location.href = 'index.html';
        });
        
        retryLogin.addEventListener('click', () => {
            hideErrorModal();
            window.location.reload();
        });
        
        // Close modal when clicking outside
        errorModal.addEventListener('click', (e) => {
            if (e.target === errorModal) {
                hideErrorModal();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && errorModal.classList.contains('active')) {
                hideErrorModal();
            }
        });
        
        // Touch feedback for interactive elements
        document.addEventListener('touchstart', function(e) {
            if (e.target.classList.contains('touch-feedback')) {
                e.target.style.transform = 'scale(0.98)';
                e.target.style.transition = 'transform 0.1s ease';
            }
        }, { passive: true });
        
        document.addEventListener('touchend', function(e) {
            if (e.target.classList.contains('touch-feedback')) {
                e.target.style.transform = '';
                e.target.style.transition = '';
            }
        }, { passive: true });
        
        // Handle password input enter key
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                loginForm.dispatchEvent(new Event('submit'));
            }
        });
        
        // Responsive adjustments on resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                updateTime();
            }, 250);
        });
        
        // Handle offline/online status
        window.addEventListener('online', () => {
            showNotification('Verbindung wiederhergestellt', 'success');
        });
        
        window.addEventListener('offline', () => {
            showNotification('Keine Internetverbindung', 'warning');
        });
    </script>
</body>
</html>