<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>DPSG ¬∑ Pfadfinderpass Designer</title>
    <style>
        /* ---------- Gittertier-Design (basierend auf 404.html) ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-bg: #ffffff;
            --color-text: #111111;
            --color-accent: #2563eb;          /* kr√§ftiges Blau f√ºr Buttons */
            --color-accent-hover: #1d4ed8;
            --color-border: #e5e7eb;
            --color-card-bg: #ffffff;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
            --radius: 12px;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-serif: Georgia, 'Times New Roman', serif;
            --pass-orange: #d69e6b;            /* Karton-Orange */
            --pass-light: #f5e6d3;
            --task-circle-size: 24px;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: var(--font-sans);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            background: var(--color-card-bg);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem 1.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-area h1 {
            font-size: 1.6rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            background: linear-gradient(145deg, #2d3748, #1a202c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .badge-icon {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .btn-primary {
            background-color: var(--color-accent);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.2);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-primary:hover {
            background-color: var(--color-accent-hover);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background-color: white;
            color: var(--color-text);
            border: 1px solid var(--color-border);
            padding: 0.6rem 1.2rem;
            border-radius: 9999px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background-color: #f9fafb;
        }

        /* Hauptbereich ‚Äì Vorschau & Schnelleinstiege */
        .main-preview {
            flex: 1;
            padding: 2rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .preview-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .pass-showcase {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: center;
            align-items: flex-start;
        }

        /* Der Pass ‚Äì echte Kartenoptik */
        .pass-card {
            background: var(--pass-orange);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 1.8rem 1.5rem;
            font-family: var(--font-serif);
            width: min(100%, 500px);
            border: 1px solid #b47d54;
            transition: all 0.2s;
            position: relative;
            page-break-inside: avoid;
            break-inside: avoid;
        }

        .pass-card.front {
            background: var(--pass-orange) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path fill="%233b2c1e" d="M50 15L70 40H55L50 60L45 40H30L50 15Z"/></svg>') repeat;
            background-blend-mode: overlay;
        }

        .pass-card.back {
            background: var(--pass-orange);
            display: flex;
            flex-direction: column;
        }

        .pass-two-column {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 1.2rem;
            margin-top: 0.8rem;
        }

        /* Linke Spalte (Personalien) */
        .personal-area {
            position: relative;
            padding-right: 0.5rem;
        }

        .dpsg-watermark {
            position: absolute;
            top: 10px;
            left: 0;
            width: 80px;
            height: auto;
            opacity: 0.15;
            pointer-events: none;
            z-index: 1;
        }

        .personal-field {
            margin-bottom: 1rem;
            position: relative;
            z-index: 2;
        }

        .personal-field label {
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #5a3e2b;
            font-weight: 600;
        }

        .personal-field .field-value {
            border-bottom: 2px solid #8b6f50;
            padding: 0.2rem 0 0.1rem;
            min-height: 1.8rem;
            font-size: 1rem;
            word-break: break-word;
        }

        .photo-placeholder {
            width: 100%;
            aspect-ratio: 1/1;
            background: #e7cfb5;
            border-radius: 8px;
            border: 2px dashed #8b6f50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5a3e2b;
            font-size: 0.9rem;
            margin: 1rem 0;
            overflow: hidden;
        }

        .photo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Rechte Spalte (Aufgaben) */
        .tasks-area {
            background: rgba(255,240,220,0.3);
            padding: 0.6rem 0.8rem;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.7rem;
            font-size: 0.95rem;
        }

        .task-circle {
            width: var(--task-circle-size);
            height: var(--task-circle-size);
            background: white;
            border-radius: 50%;
            border: 2px solid #8b6f50;
            box-shadow: inset 0 2px 3px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .task-text {
            line-height: 1.3;
            border-bottom: 1px dotted #8b6f50;
            flex: 1;
            padding-bottom: 2px;
        }

        /* Stamm-Logo (Brombach) */
        .stamm-logo {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            width: 65px;
            height: auto;
            background: white;
            border-radius: 30px;
            padding: 4px 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 5;
        }

        /* R√ºckseite ‚Äì Badge-Sammlung */
        .badges-section {
            margin-top: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            border-top: 2px solid #b47d54;
            padding-top: 1.5rem;
        }

        .badge-item {
            background: #f5e6d3;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 2px solid #b47d54;
            font-size: 0.7rem;
            text-align: center;
            font-weight: bold;
            padding: 0.2rem;
            color: #4a3726;
        }

        .badge-item img {
            max-width: 40px;
            max-height: 40px;
            margin-bottom: 2px;
        }

        /* Druckansicht */
        @media print {
            body * {
                visibility: hidden;
            }
            .pass-card, .pass-card * {
                visibility: visible;
            }
            .pass-card {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: 1px solid #aaa;
                background: #d69e6b !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .app-header, .btn-primary, .btn-secondary, .modal-overlay, .quick-actions {
                display: none !important;
            }
        }

        /* Quick Actions (unter Vorschau) */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* ---------- Modal / Wizard ---------- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-wizard {
            background: white;
            border-radius: var(--radius);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .wizard-header {
            padding: 1.5rem 2rem;
            border-bottom: 2px solid var(--color-border);
            background: #fafafa;
        }

        .wizard-header h2 {
            font-size: 1.6rem;
            font-weight: 600;
        }

        .step-indicator {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .step-dot {
            width: 30px;
            height: 8px;
            border-radius: 20px;
            background: #d1d5db;
            transition: 0.2s;
        }
        .step-dot.active {
            background: var(--color-accent);
            width: 50px;
        }

        .wizard-content {
            padding: 2rem;
            flex: 1;
        }

        .wizard-step {
            display: none;
        }
        .wizard-step.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }
        .form-control {
            width: 100%;
            padding: 0.7rem 1rem;
            border: 1px solid var(--color-border);
            border-radius: 30px;
            font-size: 1rem;
        }

        .task-list-editor {
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
            max-height: 300px;
            overflow-y: auto;
            padding: 0.3rem;
        }

        .task-editor-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f9fafb;
            padding: 0.5rem 1rem;
            border-radius: 40px;
        }
        .task-editor-item input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.3rem;
            border-bottom: 1px solid #ccc;
        }
        .task-editor-item input:focus {
            outline: none;
            border-bottom-color: var(--color-accent);
        }
        .remove-task {
            background: none;
            border: none;
            font-size: 1.4rem;
            color: #9ca3af;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .remove-task:hover {
            background: #fee2e2;
            color: #b91c1c;
        }

        .badge-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
        }
        .badge-option {
            border: 2px solid var(--color-border);
            border-radius: 40px;
            padding: 0.6rem 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: 0.1s;
        }
        .badge-option.selected {
            border-color: var(--color-accent);
            background: #dbeafe;
        }
        .badge-option img {
            width: 30px;
            height: 30px;
        }

        .wizard-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .app-header {
                flex-direction: column;
                align-items: start;
            }
            .pass-showcase {
                flex-direction: column;
                align-items: center;
            }
            .pass-card {
                width: 100%;
            }
            .pass-two-column {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .stamm-logo {
                width: 50px;
            }
            .wizard-content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="logo-area">
            <img src="https://dpsg.de/sites/default/files/2021-08/dpsg-lilie_schwarz.png" alt="DPSG Lilie" class="badge-icon">
            <h1>pfadfinderpass.design</h1>
        </div>
        <button class="btn-primary" id="openWizardBtn">‚úß Pass gestalten</button>
    </header>

    <main class="main-preview">
        <div class="preview-container">
            <!-- Live-Vorschau: zwei Seiten nebeneinander / untereinander -->
            <div class="pass-showcase" id="livePreview">
                <!-- wird dynamisch per JS gerendert -->
            </div>

            <div class="quick-actions">
                <button class="btn-secondary" id="printBtn">üñ®Ô∏è Drucken / PDF</button>
                <button class="btn-secondary" id="resetBtn">‚Ü∫ Zur√ºcksetzen</button>
            </div>
        </div>
    </main>

    <!-- Wizard Modal -->
    <div class="modal-overlay" id="wizardModal">
        <div class="modal-wizard">
            <div class="wizard-header">
                <h2>Pass-Konfigurator</h2>
                <div class="step-indicator" id="stepIndicator">
                    <span class="step-dot active"></span>
                    <span class="step-dot"></span>
                    <span class="step-dot"></span>
                    <span class="step-dot"></span>
                </div>
            </div>
            <div class="wizard-content">
                <!-- Schritt 1: Pers√∂nliche Daten -->
                <div class="wizard-step active" id="step1">
                    <h3>üìã Pers√∂nliche Daten</h3>
                    <div class="form-group">
                        <label>Name / Pfadfindername</label>
                        <input type="text" class="form-control" id="inputName" placeholder="z.B. Max Mustermann" value="Lukas Feuerfuchs">
                    </div>
                    <div class="form-group">
                        <label>Stufe</label>
                        <input type="text" class="form-control" id="inputStufe" placeholder="z.B. W√∂lflinge, Jungpfadfinder..." value="Jungpfadfinder">
                    </div>
                    <div class="form-group">
                        <label>Stamm</label>
                        <input type="text" class="form-control" id="inputStamm" placeholder="Stamm St. Josef Brombach" value="St. Josef Brombach">
                    </div>
                    <div class="form-group">
                        <label>Foto (optional)</label>
                        <input type="file" class="form-control" id="inputPhoto" accept="image/*">
                        <small style="color: #666;">Wenn kein Foto, erscheint Platzhalter</small>
                    </div>
                </div>
                <!-- Schritt 2: Aufgaben verwalten -->
                <div class="wizard-step" id="step2">
                    <h3>‚úÖ Aufgaben / Fertigkeiten</h3>
                    <p>F√ºge Aufgaben hinzu oder entferne sie:</p>
                    <div id="taskEditorContainer" class="task-list-editor">
                        <!-- dynamisch per JS -->
                    </div>
                    <button class="btn-secondary" id="addTaskBtn" style="margin-top:1rem;">+ Aufgabe hinzuf√ºgen</button>
                </div>
                <!-- Schritt 3: Abzeichen & Logos (R√ºckseite) -->
                <div class="wizard-step" id="step3">
                    <h3>üèÖ R√ºckseite ‚Äì Abzeichen</h3>
                    <p>W√§hle Abzeichen f√ºr die R√ºckseite aus:</p>
                    <div class="badge-selector" id="badgeSelector">
                        <!-- dynamisch JS -->
                    </div>
                    <div class="form-group" style="margin-top:1rem;">
                        <label>Zus√§tzlicher Text / Motto</label>
                        <input type="text" class="form-control" id="backMotto" placeholder="z.B. 'Gut Pfadfinden'" value="Immer bereit!">
                    </div>
                </div>
                <!-- Schritt 4: Design & Abschluss -->
                <div class="wizard-step" id="step4">
                    <h3>üé® Design & Druck</h3>
                    <div class="form-group">
                        <label>Pass-Grundfarbe</label>
                        <input type="color" class="form-control" id="passColor" value="#d69e6b" style="height:50px;">
                    </div>
                    <div class="form-group">
                        <label>Schriftfarbe (Innenseite)</label>
                        <input type="color" class="form-control" id="textColor" value="#2d2d2d">
                    </div>
                    <p style="margin-top:1rem;">Alle Einstellungen werden live √ºbernommen. Du kannst das Modal jederzeit schlie√üen.</p>
                </div>
            </div>
            <div class="wizard-footer">
                <button class="btn-secondary" id="prevStepBtn" disabled>‚Üê Zur√ºck</button>
                <div>
                    <button class="btn-secondary" id="closeWizardBtn">Schlie√üen</button>
                    <button class="btn-primary" id="nextStepBtn">Weiter ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ------------- Zentraler State -------------
            const state = {
                personal: {
                    name: 'Lukas Feuerfuchs',
                    stufe: 'Jungpfadfinder',
                    stamm: 'St. Josef Brombach',
                    photoDataURL: null
                },
                tasks: [
                    'Feuer machen',
                    'Messerf√ºhrerschein',
                    'Zelt aufbauen',
                    'Rucksack packen',
                    'Knoten (Achtknoten, Mastwurf)',
                    'Wegzeichen lesen',
                    'Erste Hilfe Koffer',
                    'Navi ohne Akku'
                ],
                backBadges: ['dpsg-schwarz', 'dpsg-outline', 'brombach', 'feuer'], // IDs der aktivierten Badges
                backMotto: 'Immer bereit!',
                design: {
                    passColor: '#d69e6b',
                    textColor: '#2d2d2d'
                }
            };

            // Alle verf√ºgbaren Badges (f√ºr R√ºckseite)
            const availableBadges = [
                { id: 'dpsg-schwarz', label: 'DPSG Lilie', img: 'https://dpsg.de/sites/default/files/2021-08/dpsg-lilie_schwarz.png' },
                { id: 'dpsg-outline', label: 'DPSG Outline', img: 'https://dpsg.de/sites/default/files/2021-08/dpsg-lilie_outline.png' },
                { id: 'brombach', label: 'Brombach', img: 'http://www.dpsg-brombach.de/images/Logo_Stamm/DPSG_Stamm_St_Josef_Brombach.gif' },
                { id: 'feuer', label: 'Feuer', emoji: 'üî•' },
                { id: 'knoten', label: 'Knoten', emoji: 'ü™¢' },
                { id: 'kompass', label: 'Kompass', emoji: 'üß≠' },
                { id: 'zelt', label: 'Zelt', emoji: '‚õ∫' }
            ];

            // ------------- DOM-Elemente -------------
            const previewContainer = document.getElementById('livePreview');
            const openWizardBtn = document.getElementById('openWizardBtn');
            const modal = document.getElementById('wizardModal');
            const closeWizardBtn = document.getElementById('closeWizardBtn');
            const prevBtn = document.getElementById('prevStepBtn');
            const nextBtn = document.getElementById('nextStepBtn');
            const stepDots = document.querySelectorAll('.step-dot');
            const steps = document.querySelectorAll('.wizard-step');
            const printBtn = document.getElementById('printBtn');
            const resetBtn = document.getElementById('resetBtn');

            // Schrittverwaltung
            let currentStep = 1;
            const totalSteps = 4;

            // Inputs Schritt 1
            const inputName = document.getElementById('inputName');
            const inputStufe = document.getElementById('inputStufe');
            const inputStamm = document.getElementById('inputStamm');
            const inputPhoto = document.getElementById('inputPhoto');

            // Schritt 2 Task Container
            const taskEditorContainer = document.getElementById('taskEditorContainer');
            const addTaskBtn = document.getElementById('addTaskBtn');

            // Schritt 3
            const badgeSelector = document.getElementById('badgeSelector');
            const backMotto = document.getElementById('backMotto');

            // Schritt 4
            const passColor = document.getElementById('passColor');
            const textColor = document.getElementById('textColor');

            // ------------- Render-Funktionen -------------
            function renderPreview() {
                const passColorVal = state.design.passColor;
                const textColorVal = state.design.textColor;

                let photoHtml = '<div class="photo-placeholder">üì∑ Foto</div>';
                if (state.personal.photoDataURL) {
                    photoHtml = `<div class="photo-placeholder"><img src="${state.personal.photoDataURL}" alt="Passfoto"></div>`;
                }

                // Vorderseite HTML
                const frontHtml = `
                    <div class="pass-card front" style="background-color:${passColorVal}; color:${textColorVal};">
                        <img src="https://dpsg.de/sites/default/files/2021-08/dpsg-lilie_schwarz.png" class="dpsg-watermark" alt="Lilie">
                        <img src="http://www.dpsg-brombach.de/images/Logo_Stamm/DPSG_Stamm_St_Josef_Brombach.gif" class="stamm-logo" alt="Brombach">
                        <div class="pass-two-column">
                            <!-- linke Spalte -->
                            <div class="personal-area">
                                <div class="personal-field">
                                    <label>Name</label>
                                    <div class="field-value">${escapeHtml(state.personal.name)}</div>
                                </div>
                                <div class="personal-field">
                                    <label>Stufe</label>
                                    <div class="field-value">${escapeHtml(state.personal.stufe)}</div>
                                </div>
                                <div class="personal-field">
                                    <label>Stamm</label>
                                    <div class="field-value">${escapeHtml(state.personal.stamm)}</div>
                                </div>
                                ${photoHtml}
                            </div>
                            <!-- rechte Spalte: Aufgaben -->
                            <div class="tasks-area">
                                ${state.tasks.map(task => `
                                    <div class="task-item">
                                        <span class="task-circle"></span>
                                        <span class="task-text">${escapeHtml(task)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                // R√ºckseite mit Badges
                const activeBadges = availableBadges.filter(b => state.backBadges.includes(b.id));
                const badgesHtml = activeBadges.map(b => {
                    if (b.img) {
                        return `<div class="badge-item"><img src="${b.img}" alt="${b.label}"><span>${b.label}</span></div>`;
                    } else {
                        return `<div class="badge-item"><span style="font-size:2rem;">${b.emoji}</span><span>${b.label}</span></div>`;
                    }
                }).join('');

                const backHtml = `
                    <div class="pass-card back" style="background-color:${passColorVal}; color:${textColorVal};">
                        <img src="http://www.dpsg-brombach.de/images/Logo_Stamm/DPSG_Stamm_St_Josef_Brombach.gif" class="stamm-logo" alt="Brombach">
                        <div style="margin-top: 1rem; min-height: 150px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <p style="font-size: 1.5rem; font-style: italic; border-bottom: 2px solid #b47d54;">${escapeHtml(state.backMotto)}</p>
                        </div>
                        <div class="badges-section">
                            ${badgesHtml || '<p>Keine Abzeichen ausgew√§hlt</p>'}
                        </div>
                        <div style="margin-top: auto; text-align: center; font-size:0.8rem;">DPSG ¬∑ Pfadfinderpass</div>
                    </div>
                `;

                previewContainer.innerHTML = frontHtml + backHtml;
            }

            // Hilfsfunktion gegen XSS
            function escapeHtml(unsafe) {
                return unsafe.replace(/[&<>"']/g, function(m) {
                    if(m === '&') return '&amp;'; if(m === '<') return '&lt;'; if(m === '>') return '&gt;';
                    if(m === '"') return '&quot;'; return '&#039;';
                });
            }

            // Task-Editor rendern (Schritt 2)
            function renderTaskEditor() {
                taskEditorContainer.innerHTML = '';
                state.tasks.forEach((task, index) => {
                    const div = document.createElement('div');
                    div.className = 'task-editor-item';
                    div.innerHTML = `
                        <input type="text" value="${escapeHtml(task)}" data-index="${index}" class="task-input">
                        <button class="remove-task" data-index="${index}">‚úï</button>
                    `;
                    taskEditorContainer.appendChild(div);
                });
                // Eventlistener f√ºr Inputs
                document.querySelectorAll('.task-input').forEach(inp => {
                    inp.addEventListener('input', function(e) {
                        const idx = this.dataset.index;
                        state.tasks[idx] = this.value;
                        renderPreview();
                    });
                });
                document.querySelectorAll('.remove-task').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        const idx = this.dataset.index;
                        state.tasks.splice(idx, 1);
                        renderTaskEditor();
                        renderPreview();
                    });
                });
            }

            // Badge-Auswahl rendern (Schritt 3)
            function renderBadgeSelector() {
                badgeSelector.innerHTML = '';
                availableBadges.forEach(badge => {
                    const selected = state.backBadges.includes(badge.id);
                    const div = document.createElement('div');
                    div.className = `badge-option ${selected ? 'selected' : ''}`;
                    div.dataset.id = badge.id;
                    if (badge.img) {
                        div.innerHTML = `<img src="${badge.img}" style="width:30px;"> <span>${badge.label}</span>`;
                    } else {
                        div.innerHTML = `<span style="font-size:1.8rem;">${badge.emoji}</span> <span>${badge.label}</span>`;
                    }
                    div.addEventListener('click', () => {
                        const id = badge.id;
                        if (state.backBadges.includes(id)) {
                            state.backBadges = state.backBadges.filter(b => b !== id);
                        } else {
                            state.backBadges.push(id);
                        }
                        renderBadgeSelector();
                        renderPreview();
                    });
                    badgeSelector.appendChild(div);
                });
            }

            // ------------- Wizard Navigation -------------
            function showStep(step) {
                currentStep = step;
                steps.forEach((s, i) => {
                    s.classList.toggle('active', i === step-1);
                });
                stepDots.forEach((dot, i) => {
                    dot.classList.toggle('active', i < step); // bis zum aktuellen Schritt aktiv
                });
                prevBtn.disabled = (step === 1);
                if (step === totalSteps) {
                    nextBtn.textContent = 'Fertig';
                } else {
                    nextBtn.textContent = 'Weiter ‚Üí';
                }
            }

            // ------------- Event-Listener f√ºr Wizard Inputs (Live) -------------
            function bindWizardInputs() {
                inputName.addEventListener('input', (e) => { state.personal.name = e.target.value; renderPreview(); });
                inputStufe.addEventListener('input', (e) => { state.personal.stufe = e.target.value; renderPreview(); });
                inputStamm.addEventListener('input', (e) => { state.personal.stamm = e.target.value; renderPreview(); });
                inputPhoto.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            state.personal.photoDataURL = event.target.result;
                            renderPreview();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        state.personal.photoDataURL = null;
                        renderPreview();
                    }
                });

                backMotto.addEventListener('input', (e) => { state.backMotto = e.target.value; renderPreview(); });

                passColor.addEventListener('input', (e) => { state.design.passColor = e.target.value; renderPreview(); });
                textColor.addEventListener('input', (e) => { state.design.textColor = e.target.value; renderPreview(); });
            }

            // ------------- Initialisierung + Buttons -------------
            function init() {
                renderPreview();
                renderTaskEditor();
                renderBadgeSelector();
                bindWizardInputs();

                // Modal √∂ffnen
                openWizardBtn.addEventListener('click', () => {
                    modal.classList.add('active');
                    // synchronisiere Wizard-Felder mit aktuellem State
                    inputName.value = state.personal.name;
                    inputStufe.value = state.personal.stufe;
                    inputStamm.value = state.personal.stamm;
                    backMotto.value = state.backMotto;
                    passColor.value = state.design.passColor;
                    textColor.value = state.design.textColor;
                    renderTaskEditor();
                    renderBadgeSelector();
                    showStep(1);
                });

                closeWizardBtn.addEventListener('click', () => {
                    modal.classList.remove('active');
                });

                // Navigation
                nextBtn.addEventListener('click', () => {
                    if (currentStep < totalSteps) {
                        showStep(currentStep + 1);
                    } else {
                        // Fertig = Modal schlie√üen
                        modal.classList.remove('active');
                    }
                });
                prevBtn.addEventListener('click', () => {
                    if (currentStep > 1) showStep(currentStep - 1);
                });

                // Aufgabe hinzuf√ºgen
                addTaskBtn.addEventListener('click', () => {
                    state.tasks.push('Neue Aufgabe');
                    renderTaskEditor();
                    renderPreview();
                });

                // Drucken
                printBtn.addEventListener('click', () => {
                    window.print();
                });

                // Reset auf Beispiel
                resetBtn.addEventListener('click', () => {
                    state.personal = { name: 'Lukas Feuerfuchs', stufe: 'Jungpfadfinder', stamm: 'St. Josef Brombach', photoDataURL: null };
                    state.tasks = ['Feuer machen','Messerf√ºhrerschein','Zelt aufbauen','Rucksack packen','Knoten (Achtknoten, Mastwurf)','Wegzeichen lesen','Erste Hilfe Koffer','Navi ohne Akku'];
                    state.backBadges = ['dpsg-schwarz', 'dpsg-outline', 'brombach', 'feuer'];
                    state.backMotto = 'Immer bereit!';
                    state.design = { passColor: '#d69e6b', textColor: '#2d2d2d' };
                    renderPreview();
                    renderTaskEditor();
                    renderBadgeSelector();
                    // Inputs im Wizard zur√ºcksetzen, falls offen
                    inputName.value = state.personal.name;
                    inputStufe.value = state.personal.stufe;
                    inputStamm.value = state.personal.stamm;
                    backMotto.value = state.backMotto;
                    passColor.value = state.design.passColor;
                    textColor.value = state.design.textColor;
                });

                // Modal-Klick au√üen schlie√üen
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.classList.remove('active');
                });
            }

            // Start
            init();
        })();
    </script>

    <!-- Sicherstellen, dass die Bilder laden (falls http blockiert, dann Ersatz) -->
    <noscript>JavaScript wird ben√∂tigt</noscript>
</body>
</html>