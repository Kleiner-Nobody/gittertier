<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Einstellungen - Gittertier Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    /* ==================== APPLE LIQUID GLAS DESIGN ==================== */
    :root {
        /* Light Mode - Apple Design System */
        --color-primary: #007AFF;
        --color-primary-dark: #0056CC;
        --color-accent: #5856D6;
        --color-accent-light: #AF52DE;
        --color-success: #34C759;
        --color-warning: #FF9500;
        --color-error: #FF3B30;
        --color-dark: #000000;
        --color-light: #F2F2F7;
        --color-white: #FFFFFF;
        --color-gray: #8E8E93;
        --color-gray-light: #C7C7CC;
        --color-gray-dark: #48484A;
        --color-bg: #F2F2F7;
        --color-text: #000000;
        --color-text-muted: #8E8E93;
        --color-card-bg: #FFFFFF;
        --color-card-bg-glass: rgba(255, 255, 255, 0.7);
        --color-sidebar-bg: rgba(255, 255, 255, 0.8);
        --color-modal-bg: rgba(255, 255, 255, 0.95);
        --color-overlay: rgba(0, 0, 0, 0.5);
        --color-hover-gray: rgba(142, 142, 147, 0.08);
        --color-hover-gray-medium: rgba(142, 142, 147, 0.12);
        
        /* Premium Club Specific Colors */
        --color-premium: #FFD700;
        --color-premium-dark: #FFC107;
        --color-premium-gradient: linear-gradient(135deg, #FFD700 0%, #FF9500 100%);
        --color-silver: #C0C0C0;
        --color-gold: #FFD700;
        --color-platinum: #E5E4E2;
        --color-diamond: #B9F2FF;
        --color-premium-accent: linear-gradient(135deg, #FFD700 0%, #FF9F0A 100%);
        
        /* Apple Liquid Glas Effects */
        --glass-blur: blur(20px);
        --glass-border: 1px solid rgba(255, 255, 255, 0.2);
        --glass-border-dark: 1px solid rgba(0, 0, 0, 0.1);
        --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --glass-shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.12);
        --glass-shadow-xl: 0 12px 60px rgba(0, 0, 0, 0.16);
        
        --radius: 16px;
        --radius-sm: 8px;
        --radius-lg: 24px;
        --radius-xl: 28px;
        
        --transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        --transition-slow: all 0.5s cubic-bezier(0.2, 0, 0, 1);
        
        /* Gradients */
        --gradient-primary: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
        --gradient-accent: linear-gradient(135deg, #5856D6 0%, #AF52DE 100%);
        --gradient-success: linear-gradient(135deg, #34C759 0%, #30D158 100%);
        --gradient-warning: linear-gradient(135deg, #FF9500 0%, #FF9F0A 100%);
        --gradient-error: linear-gradient(135deg, #FF3B30 0%, #FF453A 100%);
        --gradient-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.4));
        --gradient-glass-dark: linear-gradient(135deg, rgba(28, 28, 30, 0.8), rgba(28, 28, 30, 0.4));
        --gradient-gray-hover: linear-gradient(135deg, rgba(142, 142, 147, 0.08), rgba(142, 142, 147, 0.12));
        --gradient-premium: linear-gradient(135deg, #FFD700 0%, #FF9F0A 100%);
        --gradient-silver: linear-gradient(135deg, #C0C0C0 0%, #A0A0A0 100%);
        --gradient-gold: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        --gradient-platinum: linear-gradient(135deg, #E5E4E2 0%, #C0C0C0 100%);
        --gradient-diamond: linear-gradient(135deg, #B9F2FF 0%, #66A6FF 100%);
        
        /* Font Sizes */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        --text-4xl: 2.25rem;
        
        /* Spacing */
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-xxl: 48px;
        
        /* Layout */
        --header-height: 64px;
        --sidebar-width: 280px;
        --sidebar-width-collapsed: 80px;
        --touch-target: 44px;
        
        /* Depth */
        --depth-1: 0 1px 3px rgba(0, 0, 0, 0.07);
        --depth-2: 0 4px 12px rgba(0, 0, 0, 0.1);
        --depth-3: 0 10px 30px rgba(0, 0, 0, 0.15);
        --depth-4: 0 20px 50px rgba(0, 0, 0, 0.2);
        
        /* Apple System Font Stack */
        --font-system: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Auto Dark Mode based on system preference */
    @media (prefers-color-scheme: dark) {
        :root {
            --color-bg: #000000;
            --color-text: #FFFFFF;
            --color-text-muted: #8E8E93;
            --color-card-bg: #1C1C1E;
            --color-card-bg-glass: rgba(28, 28, 30, 0.7);
            --color-sidebar-bg: rgba(28, 28, 30, 0.8);
            --color-modal-bg: rgba(28, 28, 30, 0.95);
            --color-overlay: rgba(0, 0, 0, 0.7);
            --color-light: #2C2C2E;
            --color-gray: #8E8E93;
            --color-gray-light: #48484A;
            --color-gray-dark: #C7C7CC;
            --color-white: #1C1C1E;
            --color-hover-gray: rgba(174, 174, 178, 0.08);
            --color-hover-gray-medium: rgba(174, 174, 178, 0.12);
            
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-border-dark: 1px solid rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            --glass-shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
            --glass-shadow-xl: 0 12px 60px rgba(0, 0, 0, 0.5);
            
            --gradient-gray-hover: linear-gradient(135deg, rgba(174, 174, 178, 0.08), rgba(174, 174, 178, 0.12));
            --gradient-glass: linear-gradient(135deg, rgba(28, 28, 30, 0.8), rgba(28, 28, 30, 0.4));
            
            --depth-1: 0 1px 3px rgba(0, 0, 0, 0.3);
            --depth-2: 0 4px 12px rgba(0, 0, 0, 0.4);
            --depth-3: 0 10px 30px rgba(0, 0, 0, 0.5);
            --depth-4: 0 20px 50px rgba(0, 0, 0, 0.6);
            
            --gradient-premium: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%);
        }
    }

    /* Manual Dark Mode Class */
    .dark-mode {
        --color-bg: #000000;
        --color-text: #FFFFFF;
        --color-text-muted: #8E8E93;
        --color-card-bg: #1C1C1E;
        --color-card-bg-glass: rgba(28, 28, 30, 0.7);
        --color-sidebar-bg: rgba(28, 28, 30, 0.8);
        --color-modal-bg: rgba(28, 28, 30, 0.95);
        --color-overlay: rgba(0, 0, 0, 0.7);
        --color-light: #2C2C2E;
        --color-gray: #8E8E93;
        --color-gray-light: #48484A;
        --color-gray-dark: #C7C7CC;
        --color-white: #1C1C1E;
        --color-hover-gray: rgba(174, 174, 178, 0.08);
        --color-hover-gray-medium: rgba(174, 174, 178, 0.12);
        
        --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        --glass-border-dark: 1px solid rgba(255, 255, 255, 0.1);
        --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        --glass-shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
        --glass-shadow-xl: 0 12px 60px rgba(0, 0, 0, 0.5);
        
        --gradient-gray-hover: linear-gradient(135deg, rgba(174, 174, 178, 0.08), rgba(174, 174, 178, 0.12));
        --gradient-glass: linear-gradient(135deg, rgba(28, 28, 30, 0.8), rgba(28, 28, 30, 0.4));
        
        --depth-1: 0 1px 3px rgba(0, 0, 0, 0.3);
        --depth-2: 0 4px 12px rgba(0, 0, 0, 0.4);
        --depth-3: 0 10px 30px rgba(0, 0, 0, 0.5);
        --depth-4: 0 20px 50px rgba(0, 0, 0, 0.6);
        
        --gradient-premium: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: var(--font-system);
        background: var(--color-bg);
        color: var(--color-text);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
        transition: var(--transition-slow);
    }

    /* ==================== HEADER - APPLE STYLE ==================== */
    .admin-header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-lg);
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-bottom: var(--glass-border);
        min-height: var(--touch-target);
    }

    @media (max-width: 480px) {
        .admin-header {
            padding: 0 var(--spacing-sm);
        }
    }

    .logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        font-weight: 700;
        font-size: var(--text-xl);
        color: var(--color-primary);
        min-height: var(--touch-target);
    }

    .logo i {
        font-size: var(--text-xl);
        color: var(--color-primary);
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header-controls {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
    }

    .time-display {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-size: var(--text-sm);
        color: var(--color-text);
        min-height: var(--touch-target);
        display: flex;
        align-items: center;
        border: var(--glass-border);
        box-shadow: var(--glass-shadow);
    }

    .logout-btn {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        color: var(--color-text);
        border: var(--glass-border);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        min-height: var(--touch-target);
        min-width: var(--touch-target);
        box-shadow: var(--glass-shadow);
    }

    .logout-btn:hover, .logout-btn:active, .logout-btn:focus {
        background: var(--gradient-gray-hover);
        transform: translateY(-1px);
        box-shadow: var(--glass-shadow-lg);
    }

    /* ==================== MAIN CONTENT ==================== */
    .admin-content {
        flex: 1;
        padding: var(--spacing-lg);
        overflow-x: hidden;
        background: var(--color-bg);
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
    }

    @media (max-width: 768px) {
        .admin-content {
            padding: var(--spacing-md);
        }
    }

    /* ==================== PAGE HEADER ==================== */
    .page-header {
        margin-bottom: var(--spacing-xl);
        padding-top: var(--spacing-lg);
    }

    .page-title {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        line-height: 1.2;
    }

    .page-subtitle {
        color: var(--color-text-muted);
        max-width: 600px;
        line-height: 1.4;
    }

    /* ==================== USER PROFILE SECTION ==================== */
    .user-profile-section {
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-lg);
        border: var(--glass-border);
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        box-shadow: var(--glass-shadow);
        position: relative;
        overflow: hidden;
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-3xl);
        color: white;
        box-shadow: var(--glass-shadow);
        flex-shrink: 0;
    }

    .profile-info {
        flex: 1;
    }

    .profile-name {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .profile-edit-btn {
        background: var(--gradient-glass);
        border: var(--glass-border);
        color: var(--color-text);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-size: var(--text-sm);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .profile-edit-btn:hover {
        background: var(--color-hover-gray);
        transform: translateY(-1px);
    }

    .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-lg);
        margin-top: var(--spacing-lg);
    }

    .profile-stat {
        background: var(--gradient-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius);
        border: var(--glass-border);
        padding: var(--spacing-lg);
        text-align: center;
        transition: var(--transition);
    }

    .profile-stat:hover {
        background: var(--color-hover-gray);
        transform: translateY(-2px);
    }

    .profile-stat-value {
        font-size: var(--text-2xl);
        font-weight: 900;
        margin-bottom: var(--spacing-xs);
        line-height: 1;
    }

    .profile-stat-label {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--color-text-muted);
    }

    /* ==================== LOYALTY STATUS SECTION ==================== */
    .loyalty-status-section {
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-lg);
        border: var(--glass-border);
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        box-shadow: var(--glass-shadow);
    }

    .loyalty-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }

    .loyalty-title {
        font-size: var(--text-xl);
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .loyalty-actions {
        display: flex;
        gap: var(--spacing-md);
    }

    .points-display {
        display: flex;
        align-items: center;
        gap: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        padding: var(--spacing-lg);
        background: var(--gradient-glass);
        border-radius: var(--radius);
        border: var(--glass-border);
    }

    .points-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-2xl);
        background: var(--gradient-premium);
        color: #000000;
        box-shadow: var(--glass-shadow);
    }

    .points-info h3 {
        font-size: var(--text-lg);
        font-weight: 700;
        margin-bottom: var(--spacing-sm);
    }

    .points-amount {
        font-size: var(--text-3xl);
        font-weight: 900;
        color: var(--color-premium);
        line-height: 1;
        margin-bottom: var(--spacing-xs);
    }

    .points-label {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
    }

    .tier-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--spacing-xl);
        padding: var(--spacing-lg);
        background: var(--gradient-glass);
        border-radius: var(--radius);
        border: var(--glass-border);
    }

    .tier-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-lg);
        border-radius: 50px;
        font-weight: 700;
        background: var(--gradient-premium);
        color: #000000;
        box-shadow: var(--glass-shadow);
        font-size: var(--text-lg);
    }

    .tier-badge i {
        font-size: var(--text-xl);
    }

    .progress-container {
        margin-top: var(--spacing-lg);
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--spacing-sm);
        font-weight: 600;
        color: var(--color-text);
    }

    .progress-bar {
        height: 12px;
        background: var(--color-light);
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: var(--spacing-md);
    }

    .progress-fill {
        height: 100%;
        border-radius: 6px;
        background: var(--gradient-premium);
        transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: shimmer 2s infinite;
    }

    /* ==================== SETTINGS SECTIONS ==================== */
    .settings-section {
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-lg);
        border: var(--glass-border);
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        box-shadow: var(--glass-shadow);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .section-title {
        font-size: var(--text-lg);
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .section-subtitle {
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-lg);
        font-size: var(--text-sm);
        line-height: 1.5;
    }

    .settings-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }

    .setting-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-lg);
        background: var(--gradient-glass);
        border-radius: var(--radius);
        border: var(--glass-border);
        transition: var(--transition);
    }

    .setting-item:hover {
        background: var(--color-hover-gray);
        transform: translateX(4px);
    }

    .setting-info {
        flex: 1;
    }

    .setting-title {
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
        color: var(--color-text);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .setting-description {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
        line-height: 1.4;
    }

    .setting-control {
        margin-left: var(--spacing-lg);
    }

    /* Toggle Switch */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 52px;
        height: 28px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-gray-light);
        transition: var(--transition);
        border-radius: 34px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: var(--transition);
        border-radius: 50%;
        box-shadow: var(--depth-1);
    }

    input:checked + .toggle-slider {
        background: var(--gradient-primary);
    }

    input:checked + .toggle-slider:before {
        transform: translateX(24px);
    }

    /* Select Dropdown */
    .select-control {
        background: var(--gradient-glass);
        border: var(--glass-border);
        color: var(--color-text);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius);
        font-size: var(--text-sm);
        cursor: pointer;
        min-width: 120px;
        transition: var(--transition);
    }

    .select-control:hover {
        background: var(--color-hover-gray);
    }

    .select-control:focus {
        outline: none;
        box-shadow: 0 0 0 2px var(--color-primary);
    }

    /* Premium Badge */
    .premium-badge {
        background: var(--gradient-premium);
        color: #000000;
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: var(--spacing-sm);
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .locked-setting {
        opacity: 0.7;
        position: relative;
    }

    .locked-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.1);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(2px);
        cursor: pointer;
    }

    .locked-overlay i {
        color: var(--color-gray);
        font-size: var(--text-lg);
    }

    /* ==================== PREMIUM FEATURES SECTION ==================== */
    .premium-features-section {
        background: linear-gradient(135deg, var(--color-card-bg-glass) 0%, rgba(255, 215, 0, 0.1) 100%);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-lg);
        border: 2px solid transparent;
        background-clip: padding-box;
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        box-shadow: var(--glass-shadow);
        position: relative;
        overflow: hidden;
    }

    .premium-features-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--gradient-premium);
        opacity: 0.05;
        z-index: -1;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--spacing-lg);
        margin-top: var(--spacing-lg);
    }

    .feature-card {
        background: var(--color-card-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-lg);
        border: var(--glass-border);
        padding: var(--spacing-lg);
        box-shadow: var(--glass-shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .feature-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--glass-shadow-lg);
    }

    .feature-card.unlocked {
        border: 2px solid transparent;
        background: linear-gradient(var(--color-card-bg-glass), var(--color-card-bg-glass)) padding-box,
                    var(--gradient-success) border-box;
    }

    .feature-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: var(--spacing-md);
    }

    .feature-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-lg);
        background: var(--gradient-glass);
        color: var(--color-text);
        border: var(--glass-border);
    }

    .feature-card.unlocked .feature-icon {
        background: var(--gradient-success);
        color: white;
    }

    .feature-cost {
        background: var(--gradient-premium);
        color: #000000;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: 50px;
        font-weight: 700;
        font-size: var(--text-xs);
    }

    .feature-title {
        font-size: var(--text-base);
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
        color: var(--color-text);
    }

    .feature-description {
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-md);
        font-size: var(--text-sm);
        line-height: 1.5;
    }

    .feature-status {
        display: inline-block;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: 50px;
        font-size: var(--text-xs);
        font-weight: 600;
        margin-bottom: var(--spacing-md);
    }

    .status-unlocked {
        background: rgba(52, 199, 89, 0.15);
        color: var(--color-success);
    }

    .status-locked {
        background: rgba(142, 142, 147, 0.15);
        color: var(--color-gray);
    }

    .unlock-btn {
        width: 100%;
        padding: var(--spacing-md);
        background: var(--gradient-premium);
        color: #000000;
        border: none;
        border-radius: var(--radius);
        font-weight: 700;
        cursor: pointer;
        transition: var(--transition);
        font-size: var(--text-sm);
        position: relative;
        overflow: hidden;
    }

    .unlock-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
    }

    .unlock-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: var(--color-gray);
    }

    .unlock-btn.unlocked {
        background: var(--gradient-success);
        color: white;
    }

    /* ==================== MODAL SYSTEM ==================== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-overlay);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        display: none;
        padding: var(--spacing-md);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .modal-overlay.active {
        display: flex;
        animation: fadeIn 0.3s ease;
    }

    .modal {
        background: var(--color-modal-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        width: 100%;
        max-width: 500px;
        box-shadow: var(--glass-shadow-xl);
        border: var(--glass-border);
        animation: scaleIn 0.3s cubic-bezier(0.2, 0, 0, 1);
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-lg {
        max-width: 700px;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .modal-title {
        font-size: var(--text-xl);
        font-weight: 600;
        line-height: 1.2;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .close-modal {
        background: var(--gradient-glass);
        border: var(--glass-border);
        font-size: var(--text-xl);
        color: var(--color-text);
        cursor: pointer;
        width: var(--touch-target);
        height: var(--touch-target);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .close-modal:hover, .close-modal:active, .close-modal:focus {
        background: var(--color-hover-gray);
        transform: rotate(90deg);
    }

    .modal-body {
        margin-bottom: var(--spacing-lg);
    }

    .modal-footer {
        text-align: center;
        margin-top: var(--spacing-lg);
        padding-top: var(--spacing-lg);
        border-top: 1px solid var(--color-border);
        color: var(--color-text-muted);
        font-size: var(--text-sm);
    }

    /* Input Styles */
    .modal-input {
        width: 100%;
        padding: var(--spacing-md);
        background: var(--gradient-glass);
        border: var(--glass-border);
        border-radius: var(--radius);
        font-size: var(--text-base);
        color: var(--color-text);
        transition: var(--transition);
        margin-bottom: var(--spacing-md);
    }

    .modal-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .modal-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 600;
        color: var(--color-text);
    }

    .modal-text {
        color: var(--color-text-muted);
        margin-bottom: var(--spacing-lg);
        line-height: 1.5;
        font-size: var(--text-sm);
    }

    /* Button Styles */
    .modal-btn {
        width: 100%;
        padding: var(--spacing-lg);
        border: none;
        border-radius: var(--radius);
        font-weight: 700;
        cursor: pointer;
        transition: var(--transition);
        font-size: var(--text-base);
        margin-bottom: var(--spacing-md);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
    }

    .btn-primary {
        background: var(--gradient-primary);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: var(--glass-shadow-lg);
    }

    .btn-secondary {
        background: var(--gradient-glass);
        border: var(--glass-border);
        color: var(--color-text);
    }

    .btn-secondary:hover:not(:disabled) {
        background: var(--color-hover-gray);
        transform: translateY(-2px);
    }

    .btn-premium {
        background: var(--gradient-premium);
        color: #000000;
    }

    .btn-premium:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
    }

    .btn-success {
        background: var(--gradient-success);
        color: white;
    }

    .btn-success:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(52, 199, 89, 0.3);
    }

    .btn-danger {
        background: var(--gradient-error);
        color: white;
    }

    .btn-danger:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(255, 59, 48, 0.3);
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    /* Form Groups */
    .form-group {
        margin-bottom: var(--spacing-lg);
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
    }

    /* Premium Modal */
    .premium-modal {
        background: var(--gradient-premium);
        color: #000000;
    }

    .premium-modal .modal-title {
        color: #000000;
    }

    .premium-modal .modal-text {
        color: rgba(0, 0, 0, 0.8);
    }

    .premium-icon {
        text-align: center;
        font-size: 4rem;
        color: #000000;
        margin-bottom: var(--spacing-lg);
        animation: pulse 2s infinite;
    }

    /* ==================== TUTORIAL SYSTEM ==================== */
    .tutorial-modal .modal-body {
        text-align: center;
    }

    .tutorial-slide {
        display: none;
    }

    .tutorial-slide.active {
        display: block;
    }

    .tutorial-icon {
        font-size: 3rem;
        color: var(--color-primary);
        margin-bottom: var(--spacing-lg);
    }

    .tutorial-content {
        margin-bottom: var(--spacing-xl);
    }

    .tutorial-indicators {
        display: flex;
        justify-content: center;
        gap: var(--spacing-sm);
        margin: var(--spacing-lg) 0;
    }

    .tutorial-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--color-gray-light);
        cursor: pointer;
        transition: var(--transition);
    }

    .tutorial-indicator.active {
        background: var(--color-primary);
        transform: scale(1.2);
    }

    .tutorial-navigation {
        display: flex;
        justify-content: space-between;
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
    }

    /* ==================== NOTIFICATION ==================== */
    .notification {
        position: fixed;
        bottom: var(--spacing-xl);
        left: 50%;
        transform: translateX(-50%);
        background: var(--color-card-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: var(--glass-border);
        border-radius: var(--radius);
        padding: var(--spacing-md) var(--spacing-lg);
        box-shadow: var(--glass-shadow-xl);
        z-index: 3000;
        display: none;
        align-items: center;
        gap: var(--spacing-md);
        max-width: 90%;
        animation: slideUp 0.3s ease;
    }

    .notification.show {
        display: flex;
    }

    .notification.success {
        border-left: 4px solid var(--color-success);
    }

    .notification.error {
        border-left: 4px solid var(--color-error);
    }

    .notification.warning {
        border-left: 4px solid var(--color-warning);
    }

    .notification.info {
        border-left: 4px solid var(--color-primary);
    }

    .notification-icon {
        font-size: var(--text-lg);
    }

    .notification.success .notification-icon {
        color: var(--color-success);
    }

    .notification.error .notification-icon {
        color: var(--color-error);
    }

    .notification.warning .notification-icon {
        color: var(--color-warning);
    }

    .notification.info .notification-icon {
        color: var(--color-primary);
    }

    .notification-message {
        font-weight: 500;
    }

    /* ==================== CONFETTI EFFECT ==================== */
    .confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
        display: none;
    }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 0.8;
        animation: confetti 2s ease-out forwards;
    }

    /* ==================== ANIMATIONS ==================== */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes scaleIn {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(20px) translateX(-50%); opacity: 0; }
        to { transform: translateY(0) translateX(-50%); opacity: 1; }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    @keyframes confetti {
        0% {
            transform: translateY(0) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(720deg);
            opacity: 0;
        }
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* ==================== RESPONSIVE DESIGN ==================== */
    @media (max-width: 1024px) {
        .features-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .admin-header {
            padding: 0 var(--spacing-sm);
        }
        
        .admin-content {
            padding: var(--spacing-md);
        }
        
        .profile-header {
            flex-direction: column;
            text-align: center;
            gap: var(--spacing-md);
        }
        
        .profile-info {
            text-align: center;
        }
        
        .profile-stats {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .loyalty-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .loyalty-actions {
            width: 100%;
            justify-content: space-between;
        }
        
        .points-display {
            flex-direction: column;
            text-align: center;
            gap: var(--spacing-md);
        }
        
        .tier-display {
            flex-direction: column;
            gap: var(--spacing-md);
            text-align: center;
        }
        
        .setting-item {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--spacing-md);
        }
        
        .setting-control {
            margin-left: 0;
            align-self: flex-end;
        }
        
        .features-grid {
            grid-template-columns: 1fr;
        }
        
        .modal {
            padding: var(--spacing-lg);
        }
        
        .tutorial-navigation {
            flex-direction: column;
        }
        
        .time-display {
            display: none;
        }
        
        .logout-btn span {
            display: none;
        }
        
        .logout-btn {
            width: var(--touch-target);
            padding: var(--spacing-sm);
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .profile-stats {
            grid-template-columns: 1fr;
        }
        
        .modal {
            padding: var(--spacing-md);
        }
        
        .modal-btn {
            padding: var(--spacing-md);
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            font-size: var(--text-2xl);
        }
        
        .points-icon {
            width: 60px;
            height: 60px;
            font-size: var(--text-xl);
        }
        
        .points-amount {
            font-size: var(--text-2xl);
        }
    }

    /* Landscape orientation */
    @media (max-height: 600px) and (orientation: landscape) {
        .modal {
            max-height: 85vh;
        }
        
        .admin-content {
            padding: var(--spacing-md);
        }
    }

    /* High-resolution displays */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .setting-item,
        .feature-card,
        .user-profile-section,
        .loyalty-status-section,
        .settings-section,
        .premium-features-section {
            border-width: 0.5px;
        }
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        .points-icon {
            animation: none;
        }
        
        .premium-icon {
            animation: none;
        }
    }

    /* iOS specific styles */
    @supports (-webkit-touch-callout: none) {
        footer {
            padding-bottom: calc(var(--spacing-xl) + env(safe-area-inset-bottom));
        }
    }

    /* Enhanced mobile accessibility */
    @media (hover: none) and (pointer: coarse) {
        .modal-btn,
        .unlock-btn,
        .logout-btn,
        .close-modal,
        .profile-edit-btn,
        .setting-item {
            min-height: 48px;
            padding: var(--spacing-md);
        }
        
        .feature-card,
        .setting-item {
            padding: var(--spacing-md);
        }
    }

    /* Improved touch feedback */
    .touch-feedback:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }

    /* Better focus styles for accessibility */
    *:focus-visible {
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
    }

    /* Loading states */
    .loading {
        opacity: 0.7;
        pointer-events: none;
        position: relative;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 24px;
        height: 24px;
        border: 2px solid var(--glass-border);
        border-top-color: var(--color-primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-top: -12px;
        margin-left: -12px;
    }

    /* Improved scrollbars */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--color-light);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--color-gray-light);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--color-gray);
    }

    /* Empty states */
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-xl);
        text-align: center;
        color: var(--color-text-muted);
        grid-column: 1 / -1;
    }

    .empty-state i {
        font-size: var(--text-3xl);
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
    }

    .empty-state p {
        font-size: var(--text-sm);
        line-height: 1.4;
    }

    /* Admin link */
    .admin-link {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        background: var(--gradient-glass);
        border: var(--glass-border);
        border-radius: var(--radius);
        color: var(--color-text);
        text-decoration: none;
        font-size: var(--text-sm);
        font-weight: 500;
        transition: var(--transition);
        margin-left: auto;
    }

    .admin-link:hover {
        background: var(--color-hover-gray);
        transform: translateY(-1px);
    }

    /* Purchase History */
    .purchase-history {
        max-height: 300px;
        overflow-y: auto;
        margin-top: var(--spacing-md);
    }

    .purchase-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md);
        border-bottom: 1px solid var(--color-border);
        transition: var(--transition);
    }

    .purchase-item:hover {
        background: var(--color-hover-gray);
    }

    .purchase-date {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
    }

    .purchase-amount {
        font-weight: 600;
        color: var(--color-success);
    }

    .purchase-items {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
    }

    /* Stats Chart */
    .stats-chart {
        height: 200px;
        margin-top: var(--spacing-lg);
        position: relative;
    }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="logo">
            <i class="fas fa-user-cog"></i>
            <span>Einstellungen</span>
        </div>
        <div class="header-controls">
            <div class="time-display" id="timeDisplay"></div>
            <a href="admin" class="admin-link">
                <i class="fas fa-lock"></i>
                <span>Admin</span>
            </a>
            <button class="logout-btn" id="logoutBtn" aria-label="Zurück zum Scanner">
                <i class="fas fa-arrow-left"></i>
                <span>Zurück</span>
            </button>
        </div>
    </div>

    <main class="admin-content" id="main-content">
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-user-cog"></i>
                Ihre Einstellungen
            </h1>
            <p class="page-subtitle">
                Verwalten Sie Ihre persönlichen Einstellungen, Premium-Features und Loyalitätseinstellungen.
            </p>
        </div>

        <!-- User Profile Section -->
        <section class="user-profile-section">
            <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <div class="profile-name">
                        <span id="user-name">Gast</span>
                        <button class="profile-edit-btn touch-feedback" id="edit-name-btn">
                            <i class="fas fa-edit"></i>
                            <span>Namen ändern</span>
                        </button>
                    </div>
                    <p class="page-subtitle" id="user-role">Standard Benutzer</p>
                </div>
            </div>
            
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="total-scans">0</div>
                    <div class="profile-stat-label">Gescannte Produkte</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="total-purchases">0</div>
                    <div class="profile-stat-label">Abgeschlossene Käufe</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="total-spent">0€</div>
                    <div class="profile-stat-label">Gesamtausgaben</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="join-date">-</div>
                    <div class="profile-stat-label">Mitglied seit</div>
                </div>
            </div>
        </section>

        <!-- Loyalty Status Section -->
        <section class="loyalty-status-section" id="loyalty-section">
            <div class="loyalty-header">
                <h2 class="loyalty-title">
                    <i class="fas fa-crown"></i>
                    Loyalität Status
                </h2>
                <div class="loyalty-actions">
                    <button class="btn-premium modal-btn touch-feedback" id="join-loyalty-btn" style="display: none;">
                        <i class="fas fa-crown"></i>
                        Premium beitreten
                    </button>
                    <button class="btn-secondary modal-btn touch-feedback" id="view-loyalty-details">
                        <i class="fas fa-chart-bar"></i>
                        Details anzeigen
                    </button>
                </div>
            </div>
            
            <div class="points-display">
                <div class="points-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="points-info">
                    <h3>Ihre Premium Punkte</h3>
                    <div class="points-amount" id="loyalty-points">0</div>
                    <div class="points-label">Gesammelte Punkte</div>
                </div>
            </div>
            
            <div class="tier-display">
                <div>
                    <h3>Aktueller Status</h3>
                    <div class="tier-badge" id="current-tier-badge">
                        <i class="fas fa-medal"></i>
                        <span id="current-tier">Bronze</span>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Fortschritt zum nächsten Level</span>
                        <span id="progress-text">0/500</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Scanner Settings Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-barcode"></i>
                    Scanner Einstellungen
                </h2>
            </div>
            <p class="section-subtitle">
                Passen Sie das Verhalten des Barcode-Scanners an Ihre Bedürfnisse an.
            </p>
            
            <div class="settings-grid">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-volume-up"></i>
                            Scangeräusche
                            <span class="premium-badge" id="sound-premium-badge" style="display: none;">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Spielt ein Bestätigungston ab, wenn ein Barcode gescannt wird
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="sound-effects-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-bolt"></i>
                            Automatisch hinzufügen
                        </div>
                        <div class="setting-description">
                            Fügt gescannte Produkte automatisch zum Warenkorb hinzu
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-add-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-sync-alt"></i>
                            Kontinuierliches Scannen
                        </div>
                        <div class="setting-description">
                            Scanner bleibt nach erfolgreichem Scan aktiv
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="continuous-scan-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item locked-setting" id="scanner-animation-setting">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-sparkles"></i>
                            Scanner Animationen
                            <span class="premium-badge">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Spezielle Puls-Animationen für den Barcode-Scanner
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="scanner-animation-toggle" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="locked-overlay" id="unlock-scanner-animation">
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
                
                <div class="setting-item locked-setting" id="scanner-effects-setting">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-magic"></i>
                            Scanner Effekte
                            <span class="premium-badge">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Verbesserte visuelle Effekte beim Scannen
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="scanner-effects-toggle" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="locked-overlay" id="unlock-scanner-effects">
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Display Settings Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-display"></i>
                    Anzeige Einstellungen
                </h2>
            </div>
            <p class="section-subtitle">
                Passen Sie das Erscheinungsbild der App an Ihre Vorlieben an.
            </p>
            
            <div class="settings-grid">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-text-height"></i>
                            Schriftgröße
                        </div>
                        <div class="setting-description">
                            Stellen Sie die Schriftgröße für bessere Lesbarkeit ein
                        </div>
                    </div>
                    <div class="setting-control">
                        <select class="select-control" id="font-size-select">
                            <option value="small">Klein</option>
                            <option value="medium" selected>Mittel</option>
                            <option value="large">Groß</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-palette"></i>
                            Design-Modus
                        </div>
                        <div class="setting-description">
                            Automatisch basierend auf Systemeinstellungen
                        </div>
                    </div>
                    <div class="setting-control">
                        <div class="select-control" id="theme-display" style="pointer-events: none;">
                            Automatisch
                        </div>
                    </div>
                </div>
                
                <div class="setting-item locked-setting" id="dark-mode-plus-setting">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-moon"></i>
                            Dark Mode Plus
                            <span class="premium-badge">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Erweiterte Dark Mode Optionen mit angepassten Farben
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="dark-mode-plus-toggle" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="locked-overlay" id="unlock-dark-mode-plus">
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
                
                <div class="setting-item locked-setting" id="transaction-effects-setting">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-fire"></i>
                            Transaktions-Effekte
                            <span class="premium-badge">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Spezielle Animationen bei erfolgreichen Zahlungen
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="transaction-effects-toggle" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="locked-overlay" id="unlock-transaction-effects">
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Payment Settings Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-credit-card"></i>
                    Bezahlung Einstellungen
                </h2>
            </div>
            <p class="section-subtitle">
                Einstellungen für Zahlungsvorgänge und Bestätigungen.
            </p>
            
            <div class="settings-grid">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-bell"></i>
                            Zahlungsbestätigungen
                        </div>
                        <div class="setting-description">
                            Zeigt eine Bestätigungsmeldung nach jeder Zahlung an
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="payment-confirmations-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item locked-setting" id="fast-checkout-setting">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-bolt"></i>
                            Schnellbezahlung
                            <span class="premium-badge">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Beschleunigte Bestätigung von Zahlungen
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="fast-checkout-toggle" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="locked-overlay" id="unlock-fast-checkout">
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
                
                <div class="setting-item locked-setting" id="priority-processing-setting">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-star"></i>
                            Prioritäts-Verarbeitung
                            <span class="premium-badge">
                                <i class="fas fa-lock"></i>
                                PREMIUM
                            </span>
                        </div>
                        <div class="setting-description">
                            Schnellere Verarbeitung von Zahlungsvorgängen
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="priority-processing-toggle" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="locked-overlay" id="unlock-priority-processing">
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Premium Features Section -->
        <section class="premium-features-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-gem"></i>
                    Premium Features
                </h2>
                <button class="btn-premium modal-btn touch-feedback" id="view-all-features">
                    <i class="fas fa-list"></i>
                    Alle Features
                </button>
            </div>
            <p class="section-subtitle">
                Schalten Sie exklusive Features mit Ihren Loyalitätspunkten frei.
            </p>
            
            <div class="features-grid" id="premium-features-grid">
                <!-- Premium features will be populated by JavaScript -->
            </div>
        </section>

        <!-- Tutorial Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-graduation-cap"></i>
                    Tutorial & Hilfe
                </h2>
            </div>
            <p class="section-subtitle">
                Lernen Sie, wie Sie die App optimal nutzen können.
            </p>
            
            <div class="settings-grid">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-play-circle"></i>
                            Einstellungen Tutorial
                        </div>
                        <div class="setting-description">
                            Eine geführte Tour durch alle Einstellungsoptionen
                        </div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-secondary modal-btn touch-feedback" id="start-tutorial-btn">
                            <i class="fas fa-play"></i>
                            Starten
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-question-circle"></i>
                            Häufige Fragen
                        </div>
                        <div class="setting-description">
                            Antworten auf häufig gestellte Fragen
                        </div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-secondary modal-btn touch-feedback" id="faq-btn">
                            <i class="fas fa-book-open"></i>
                            Anzeigen
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-history"></i>
                            Kaufhistorie
                        </div>
                        <div class="setting-description">
                            Zeigt Ihre bisherigen Käufe und Punkteverlauf an
                        </div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-secondary modal-btn touch-feedback" id="purchase-history-btn">
                            <i class="fas fa-receipt"></i>
                            Anzeigen
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-database"></i>
                    Daten & Speicher
                </h2>
            </div>
            <p class="section-subtitle">
                Verwalten Sie Ihre lokalen Daten und Einstellungen.
            </p>
            
            <div class="settings-grid">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-trash-alt"></i>
                            Lokale Daten löschen
                        </div>
                        <div class="setting-description">
                            Löscht alle lokal gespeicherten Einstellungen und den Warenkorb
                        </div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-danger modal-btn touch-feedback" id="clear-data-btn">
                            <i class="fas fa-trash"></i>
                            Löschen
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">
                            <i class="fas fa-redo"></i>
                            Standardeinstellungen
                        </div>
                        <div class="setting-description">
                            Setzt alle Einstellungen auf ihre Standardwerte zurück
                        </div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-secondary modal-btn touch-feedback" id="reset-settings-btn">
                            <i class="fas fa-undo"></i>
                            Zurücksetzen
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ==================== MODALS ==================== -->

    <!-- Edit Name Modal -->
    <div class="modal-overlay" id="edit-name-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-user-edit"></i>
                    Namen ändern
                </h2>
                <button class="close-modal touch-feedback" id="close-edit-name">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-text">
                    Geben Sie Ihren gewünschten Namen ein. Das Ändern des Namens kostet <strong>10 Punkte</strong>.
                </p>
                <div class="form-group">
                    <label class="modal-label" for="new-name-input">Neuer Name</label>
                    <input type="text" id="new-name-input" class="modal-input" placeholder="Ihr Name" maxlength="30">
                </div>
                <div class="points-info" style="background: var(--gradient-glass); padding: var(--spacing-md); border-radius: var(--radius); margin-bottom: var(--spacing-lg);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Ihre aktuellen Punkte:</span>
                        <span class="points-amount" id="name-change-points">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-xs);">
                        <span>Benötigte Punkte:</span>
                        <span style="color: var(--color-premium); font-weight: 600;">10</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-premium modal-btn touch-feedback" id="save-name-btn">
                    <i class="fas fa-check"></i>
                    Für 10 Punkte ändern
                </button>
                <button class="btn-secondary modal-btn touch-feedback" id="cancel-name-btn">
                    <i class="fas fa-times"></i>
                    Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Join Loyalty Program Modal -->
    <div class="modal-overlay" id="join-loyalty-modal">
        <div class="modal premium-modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-crown"></i>
                    Premium Club beitreten
                </h2>
                <button class="close-modal touch-feedback" id="close-join-loyalty">&times;</button>
            </div>
            <div class="modal-body">
                <div class="premium-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <h3 style="text-align: center; margin-bottom: var(--spacing-md); font-size: var(--text-xl);">
                    Werden Sie Premium-Mitglied!
                </h3>
                <p class="modal-text" style="text-align: center;">
                    Treten Sie dem Premium Club bei und genießen Sie exklusive Vorteile:
                </p>
                
                <div style="margin: var(--spacing-lg) 0;">
                    <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: rgba(255, 255, 255, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-gift" style="color: var(--color-premium);"></i>
                        <div>
                            <strong>100 Willkommenspunkte</strong>
                            <p style="margin: 0; font-size: var(--text-sm); opacity: 0.8;">Sofort nach Beitritt</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: rgba(255, 255, 255, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-rocket" style="color: var(--color-premium);"></i>
                        <div>
                            <strong>Doppelte Punkte</strong>
                            <p style="margin: 0; font-size: var(--text-sm); opacity: 0.8;">Auf alle Einkäufe</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: rgba(255, 255, 255, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-unlock" style="color: var(--color-premium);"></i>
                        <div>
                            <strong>Exklusive Features</strong>
                            <p style="margin: 0; font-size: var(--text-sm); opacity: 0.8;">Premium Scanner-Effekte</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: rgba(255, 255, 255, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-shield-alt" style="color: var(--color-premium);"></i>
                        <div>
                            <strong>Prioritärer Support</strong>
                            <p style="margin: 0; font-size: var(--text-sm); opacity: 0.8;">Schnellere Hilfe</p>
                        </div>
                    </div>
                </div>
                
                <p class="modal-text" style="text-align: center; font-size: var(--text-sm);">
                    Der Beitritt ist <strong>kostenlos</strong> und kann jederzeit gekündigt werden.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-premium modal-btn touch-feedback" id="confirm-join-loyalty" style="background: rgba(0, 0, 0, 0.9); color: white;">
                    <i class="fas fa-crown"></i>
                    Jetzt beitreten - 100 Punkte GRATIS!
                </button>
                <button class="btn-secondary modal-btn touch-feedback" id="cancel-join-loyalty">
                    <i class="fas fa-times"></i>
                    Vielleicht später
                </button>
            </div>
        </div>
    </div>

    <!-- Unlock Feature Modal -->
    <div class="modal-overlay" id="unlock-feature-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-unlock"></i>
                    Feature freischalten
                </h2>
                <button class="close-modal touch-feedback" id="close-unlock-feature">&times;</button>
            </div>
            <div class="modal-body">
                <div class="feature-icon" id="unlock-feature-icon" style="margin: 0 auto var(--spacing-lg);">
                    <i class="fas fa-star"></i>
                </div>
                <h3 style="text-align: center; margin-bottom: var(--spacing-md);" id="unlock-feature-title">
                    Feature Name
                </h3>
                <p class="modal-text" id="unlock-feature-description">
                    Feature Beschreibung
                </p>
                
                <div class="points-info" style="background: var(--gradient-glass); padding: var(--spacing-md); border-radius: var(--radius); margin-bottom: var(--spacing-lg);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Ihre aktuellen Punkte:</span>
                        <span class="points-amount" id="unlock-current-points">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-xs);">
                        <span>Benötigte Punkte:</span>
                        <span style="color: var(--color-premium); font-weight: 600;" id="unlock-required-points">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-xs); font-weight: 600;" id="unlock-points-difference">
                        <span>Verbleibend:</span>
                        <span style="color: var(--color-error);">0</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-premium modal-btn touch-feedback" id="confirm-unlock-feature">
                    <i class="fas fa-unlock"></i>
                    Feature freischalten
                </button>
                <button class="btn-secondary modal-btn touch-feedback" id="cancel-unlock-feature">
                    <i class="fas fa-times"></i>
                    Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- All Features Modal -->
    <div class="modal-overlay" id="all-features-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-gem"></i>
                    Alle Premium Features
                </h2>
                <button class="close-modal touch-feedback" id="close-all-features">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-text">
                    Entdecken Sie alle verfügbaren Premium Features, die Sie mit Ihren Loyalitätspunkten freischalten können.
                </p>
                
                <div class="features-grid" id="all-features-grid" style="margin-top: var(--spacing-lg);">
                    <!-- All features will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-btn touch-feedback" id="close-all-features-btn">
                    <i class="fas fa-times"></i>
                    Schließen
                </button>
            </div>
        </div>
    </div>

    <!-- Loyalty Details Modal -->
    <div class="modal-overlay" id="loyalty-details-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-chart-bar"></i>
                    Loyalität Details
                </h2>
                <button class="close-modal touch-feedback" id="close-loyalty-details">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <div style="background: var(--gradient-glass); padding: var(--spacing-md); border-radius: var(--radius); border: var(--glass-border);">
                        <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Aktuelle Punkte</div>
                        <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-premium);" id="modal-current-points">0</div>
                    </div>
                    <div style="background: var(--gradient-glass); padding: var(--spacing-md); border-radius: var(--radius); border: var(--glass-border);">
                        <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Lebenszeit Punkte</div>
                        <div style="font-size: var(--text-2xl); font-weight: 700;" id="modal-lifetime-points">0</div>
                    </div>
                    <div style="background: var(--gradient-glass); padding: var(--spacing-md); border-radius: var(--radius); border: var(--glass-border);">
                        <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Freigeschaltet</div>
                        <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success);" id="modal-unlocked-features">0</div>
                    </div>
                    <div style="background: var(--gradient-glass); padding: var(--spacing-md); border-radius: var(--radius); border: var(--glass-border);">
                        <div style="font-size: var(--text-sm); color: var(--color-text-muted);">Aktueller Status</div>
                        <div style="font-size: var(--text-xl); font-weight: 700;" id="modal-current-tier">Bronze</div>
                    </div>
                </div>
                
                <div class="progress-container" style="margin-bottom: var(--spacing-lg);">
                    <div class="progress-label">
                        <span>Fortschritt zum nächsten Level</span>
                        <span id="modal-progress-text">0/500</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="modal-progress-fill"></div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: var(--spacing-md);">Tier Vorteile</h3>
                <div class="tiers-grid" id="modal-tiers-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
                    <!-- Tiers will be populated by JavaScript -->
                </div>
                
                <h3 style="margin: var(--spacing-lg) 0 var(--spacing-md);">Punkteverlauf</h3>
                <div class="stats-chart">
                    <canvas id="points-chart"></canvas>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-btn touch-feedback" id="close-details-btn">
                    <i class="fas fa-times"></i>
                    Schließen
                </button>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="modal-overlay" id="tutorial-modal">
        <div class="modal">
            <div class="tutorial-slide active" id="tutorial-slide-1">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-graduation-cap"></i>
                        Einstellungen Tutorial
                    </h2>
                    <button class="close-modal touch-feedback" id="close-tutorial">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tutorial-icon">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <div class="tutorial-content">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-md);">Willkommen zum Einstellungen Tutorial!</h3>
                        <p class="modal-text">
                            In diesem Tutorial lernen Sie, wie Sie Ihre persönlichen Einstellungen anpassen, Premium-Features freischalten und Ihre Loyalitätspunkte optimal nutzen können.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="tutorial-indicators">
                        <div class="tutorial-indicator active" data-slide="1"></div>
                        <div class="tutorial-indicator" data-slide="2"></div>
                        <div class="tutorial-indicator" data-slide="3"></div>
                        <div class="tutorial-indicator" data-slide="4"></div>
                        <div class="tutorial-indicator" data-slide="5"></div>
                    </div>
                    <button class="btn-primary modal-btn touch-feedback" id="tutorial-next">
                        <i class="fas fa-arrow-right"></i>
                        Weiter
                    </button>
                </div>
            </div>
            
            <div class="tutorial-slide" id="tutorial-slide-2">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-user"></i>
                        Profil & Name
                    </h2>
                    <button class="close-modal touch-feedback" id="close-tutorial-2">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tutorial-icon">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div class="tutorial-content">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-md);">Persönliches Profil</h3>
                        <p class="modal-text">
                            Sie können Ihren Namen für <strong>10 Punkte</strong> ändern. Dies macht Ihre Erfahrung persönlicher und hilft bei der Identifikation.
                        </p>
                        <p class="modal-text">
                            Ihre Statistiken zeigen:
                            • Gescannte Produkte
                            • Abgeschlossene Käufe
                            • Gesamtausgaben
                            • Mitgliedschaftsdauer
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="tutorial-indicators">
                        <div class="tutorial-indicator" data-slide="1"></div>
                        <div class="tutorial-indicator active" data-slide="2"></div>
                        <div class="tutorial-indicator" data-slide="3"></div>
                        <div class="tutorial-indicator" data-slide="4"></div>
                        <div class="tutorial-indicator" data-slide="5"></div>
                    </div>
                    <div class="tutorial-navigation">
                        <button class="btn-secondary modal-btn touch-feedback" id="tutorial-prev-2">
                            <i class="fas fa-arrow-left"></i>
                            Zurück
                        </button>
                        <button class="btn-primary modal-btn touch-feedback" id="tutorial-next-2">
                            <i class="fas fa-arrow-right"></i>
                            Weiter
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="tutorial-slide" id="tutorial-slide-3">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-crown"></i>
                        Loyalität & Punkte
                    </h2>
                    <button class="close-modal touch-feedback" id="close-tutorial-3">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tutorial-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="tutorial-content">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-md);">Premium Club</h3>
                        <p class="modal-text">
                            Treten Sie dem <strong>Premium Club</strong> bei, um exklusive Vorteile zu erhalten:
                        </p>
                        <ul style="padding-left: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                            <li>100 Willkommenspunkte</li>
                            <li>Doppelte Punkte bei Einkäufen</li>
                            <li>Exklusive Premium-Features</li>
                            <li>Höhere Statuslevel mit mehr Vorteilen</li>
                        </ul>
                        <p class="modal-text">
                            Sammeln Sie Punkte durch Scannen und Einkäufe, um in höhere Level aufzusteigen.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="tutorial-indicators">
                        <div class="tutorial-indicator" data-slide="1"></div>
                        <div class="tutorial-indicator" data-slide="2"></div>
                        <div class="tutorial-indicator active" data-slide="3"></div>
                        <div class="tutorial-indicator" data-slide="4"></div>
                        <div class="tutorial-indicator" data-slide="5"></div>
                    </div>
                    <div class="tutorial-navigation">
                        <button class="btn-secondary modal-btn touch-feedback" id="tutorial-prev-3">
                            <i class="fas fa-arrow-left"></i>
                            Zurück
                        </button>
                        <button class="btn-primary modal-btn touch-feedback" id="tutorial-next-3">
                            <i class="fas fa-arrow-right"></i>
                            Weiter
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="tutorial-slide" id="tutorial-slide-4">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-sliders-h"></i>
                        Einstellungen
                    </h2>
                    <button class="close-modal touch-feedback" id="close-tutorial-4">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tutorial-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="tutorial-content">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-md);">Anpassbare Einstellungen</h3>
                        <p class="modal-text">
                            Passen Sie die App an Ihre Bedürfnisse an:
                        </p>
                        <ul style="padding-left: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                            <li><strong>Scanner Einstellungen:</strong> Geräusche, automatisches Hinzufügen</li>
                            <li><strong>Anzeige Einstellungen:</strong> Schriftgröße, Design-Modus</li>
                            <li><strong>Bezahlung Einstellungen:</strong> Bestätigungen, Schnellbezahlung</li>
                            <li><strong>Premium Features:</strong> Mit Punkten freischalten</li>
                        </ul>
                        <p class="modal-text">
                            <span class="premium-badge" style="margin: 0;">PREMIUM</span> markierte Features erfordern Premium-Mitgliedschaft.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="tutorial-indicators">
                        <div class="tutorial-indicator" data-slide="1"></div>
                        <div class="tutorial-indicator" data-slide="2"></div>
                        <div class="tutorial-indicator" data-slide="3"></div>
                        <div class="tutorial-indicator active" data-slide="4"></div>
                        <div class="tutorial-indicator" data-slide="5"></div>
                    </div>
                    <div class="tutorial-navigation">
                        <button class="btn-secondary modal-btn touch-feedback" id="tutorial-prev-4">
                            <i class="fas fa-arrow-left"></i>
                            Zurück
                        </button>
                        <button class="btn-primary modal-btn touch-feedback" id="tutorial-next-4">
                            <i class="fas fa-arrow-right"></i>
                            Weiter
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="tutorial-slide" id="tutorial-slide-5">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-flag-checkered"></i>
                        Tutorial abgeschlossen
                    </h2>
                    <button class="close-modal touch-feedback" id="close-tutorial-5">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tutorial-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="tutorial-content">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-md);">Sie sind bereit!</h3>
                        <p class="modal-text">
                            Sie haben erfolgreich alle Funktionen der Einstellungen kennengelernt. Sie können jetzt:
                        </p>
                        <ul style="padding-left: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                            <li>Ihren Namen ändern</li>
                            <li>Dem Premium Club beitreten</li>
                            <li>Premium-Features freischalten</li>
                            <li>Alle Einstellungen anpassen</li>
                            <li>Ihre Loyalität verfolgen</li>
                        </ul>
                        <p class="modal-text">
                            Das Tutorial können Sie jederzeit über den "Einstellungen Tutorial" Button erneut starten.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="tutorial-indicators">
                        <div class="tutorial-indicator" data-slide="1"></div>
                        <div class="tutorial-indicator" data-slide="2"></div>
                        <div class="tutorial-indicator" data-slide="3"></div>
                        <div class="tutorial-indicator" data-slide="4"></div>
                        <div class="tutorial-indicator active" data-slide="5"></div>
                    </div>
                    <div class="tutorial-navigation">
                        <button class="btn-secondary modal-btn touch-feedback" id="tutorial-prev-5">
                            <i class="fas fa-arrow-left"></i>
                            Zurück
                        </button>
                        <button class="btn-primary modal-btn touch-feedback" id="tutorial-finish">
                            <i class="fas fa-check"></i>
                            Fertig
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAQ Modal -->
    <div class="modal-overlay" id="faq-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-question-circle"></i>
                    Häufige Fragen
                </h2>
                <button class="close-modal touch-feedback" id="close-faq">&times;</button>
            </div>
            <div class="modal-body">
                <div class="faq-category" style="margin-bottom: var(--spacing-xl);">
                    <h3 style="margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="fas fa-crown"></i>
                        Premium Club
                    </h3>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Was ist der Premium Club?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Der Premium Club ist ein Treueprogramm, bei dem Sie Punkte sammeln können, um exklusive Features freizuschalten und von besonderen Vorteilen zu profitieren.
                        </div>
                    </div>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Wie bekomme ich Punkte?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Sie erhalten Punkte durch Scannen von Produkten (1 Punkt pro Scan) und durch Einkäufe (1 Punkt pro Euro). Premium-Mitglieder erhalten doppelte Punkte.
                        </div>
                    </div>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Kostet der Premium Club etwas?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Nein, der Beitritt ist komplett kostenlos. Sie erhalten sogar 100 Willkommenspunkte bei der Anmeldung.
                        </div>
                    </div>
                </div>
                
                <div class="faq-category" style="margin-bottom: var(--spacing-xl);">
                    <h3 style="margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="fas fa-sliders-h"></i>
                        Einstellungen
                    </h3>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Kann ich meinen Namen ändern?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Ja, Sie können Ihren Namen für 10 Loyalitätspunkte ändern. Klicken Sie auf "Namen ändern" in Ihrem Profil.
                        </div>
                    </div>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Was sind Premium-Features?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Premium-Features sind erweiterte Funktionen, die Sie mit Loyalitätspunkten freischalten können, wie spezielle Scanner-Effekte oder schnellere Bezahlung.
                        </div>
                    </div>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Werden meine Einstellungen gespeichert?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Ja, alle Ihre Einstellungen werden lokal in Ihrem Browser gespeichert und bleiben auch nach Schließen der App erhalten.
                        </div>
                    </div>
                </div>
                
                <div class="faq-category">
                    <h3 style="margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="fas fa-tools"></i>
                        Technische Fragen
                    </h3>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Was passiert, wenn ich meine Daten lösche?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Alle lokalen Einstellungen, der Warenkorb und nicht-gespeicherte Daten werden gelöscht. Ihre Loyalitätspunkte und Premium-Mitgliedschaft bleiben erhalten, da diese server-seitig gespeichert werden.
                        </div>
                    </div>
                    <div class="faq-item" style="margin-bottom: var(--spacing-md);">
                        <div class="faq-question" style="font-weight: 600; margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-question" style="color: var(--color-primary);"></i>
                            Wie funktioniert der Dark Mode?
                        </div>
                        <div class="faq-answer" style="color: var(--color-text-muted);">
                            Der Dark Mode wird automatisch basierend auf den Systemeinstellungen Ihres Geräts aktiviert. Es gibt keinen manellen Schalter, um Konsistenz zu gewährleisten.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-btn touch-feedback" id="close-faq-btn">
                    <i class="fas fa-times"></i>
                    Schließen
                </button>
            </div>
        </div>
    </div>

    <!-- Purchase History Modal -->
    <div class="modal-overlay" id="purchase-history-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-history"></i>
                    Kaufhistorie
                </h2>
                <button class="close-modal touch-feedback" id="close-purchase-history">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-text">
                    Hier sehen Sie Ihre bisherigen Käufe und die dabei erhaltenen Punkte.
                </p>
                
                <div class="purchase-history" id="purchase-history-list">
                    <!-- Purchase history will be populated by JavaScript -->
                </div>
                
                <div class="empty-state" id="empty-purchase-history" style="display: none;">
                    <i class="fas fa-receipt"></i>
                    <p>Keine Käufe gefunden</p>
                    <p>Ihre Kaufhistorie wird hier angezeigt, sobald Sie Ihren ersten Einkauf abgeschlossen haben.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-btn touch-feedback" id="close-history-btn">
                    <i class="fas fa-times"></i>
                    Schließen
                </button>
            </div>
        </div>
    </div>

    <!-- Clear Data Confirmation Modal -->
    <div class="modal-overlay" id="clear-data-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Daten löschen bestätigen
                </h2>
                <button class="close-modal touch-feedback" id="close-clear-data">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: var(--spacing-lg);">
                    <i class="fas fa-trash-alt" style="font-size: 3rem; color: var(--color-error); margin-bottom: var(--spacing-md);"></i>
                    <h3 style="margin-bottom: var(--spacing-md);">Sind Sie sicher?</h3>
                </div>
                <p class="modal-text">
                    Diese Aktion löscht <strong>alle lokalen Daten</strong> einschließlich:
                </p>
                <ul style="padding-left: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                    <li>Alle Einstellungen</li>
                    <li>Aktuellen Warenkorb</li>
                    <li>Lokale Produktdaten</li>
                    <li>Session-Daten</li>
                </ul>
                <p class="modal-text" style="color: var(--color-error); font-weight: 600;">
                    Diese Aktion kann nicht rückgängig gemacht werden!
                </p>
                <p class="modal-text">
                    Ihre Loyalitätspunkte und Premium-Mitgliedschaft bleiben erhalten.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-danger modal-btn touch-feedback" id="confirm-clear-data">
                    <i class="fas fa-trash"></i>
                    Alle Daten löschen
                </button>
                <button class="btn-secondary modal-btn touch-feedback" id="cancel-clear-data">
                    <i class="fas fa-times"></i>
                    Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Settings Confirmation Modal -->
    <div class="modal-overlay" id="reset-settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-redo"></i>
                    Einstellungen zurücksetzen
                </h2>
                <button class="close-modal touch-feedback" id="close-reset-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: var(--spacing-lg);">
                    <i class="fas fa-undo" style="font-size: 3rem; color: var(--color-warning); margin-bottom: var(--spacing-md);"></i>
                    <h3 style="margin-bottom: var(--spacing-md);">Einstellungen zurücksetzen?</h3>
                </div>
                <p class="modal-text">
                    Diese Aktion setzt <strong>alle Einstellungen</strong> auf ihre Standardwerte zurück:
                </p>
                <ul style="padding-left: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                    <li>Scanner Einstellungen</li>
                    <li>Anzeige Einstellungen</li>
                    <li>Bezahlung Einstellungen</li>
                    <li>Benutzerpräferenzen</li>
                </ul>
                <p class="modal-text">
                    Ihre Loyalitätspunkte, Premium-Mitgliedschaft und freigeschalteten Features bleiben erhalten.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-danger modal-btn touch-feedback" id="confirm-reset-settings">
                    <i class="fas fa-redo"></i>
                    Zurücksetzen
                </button>
                <button class="btn-secondary modal-btn touch-feedback" id="cancel-reset-settings">
                    <i class="fas fa-times"></i>
                    Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti-container" id="confetti-container"></div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="notification-message" id="notification-message"></div>
    </div>

    <script>
        // ==================== USER SETTINGS MANAGER ====================
        class UserSettingsManager {
            constructor() {
                this.storageKeys = {
                    userSettings: 'userSettings',
                    loyaltyData: 'gittertier_loyalty_data',
                    paymentPrefs: 'gittertier_payment_preferences',
                    unlockedFeatures: 'gittertier_unlocked_features',
                    appSettings: 'appSettings',
                    purchaseHistory: 'gittertier_purchase_history',
                    tutorialSeen: 'gittertier_settings_tutorial_seen'
                };
                
                this.defaultSettings = {
                    soundEffects: true,
                    autoAddToCart: false,
                    continuousScan: false,
                    scanSound: true,
                    fontSize: 'medium',
                    paymentConfirmations: true,
                    theme: 'auto'
                };
                
                this.premiumFeatures = [
                    {
                        id: 'scanner_animation',
                        title: 'Scanner Animation',
                        icon: 'fas fa-sparkles',
                        description: 'Spezielle Puls-Animation für den Barcode-Scanner',
                        cost: 200,
                        settingKey: 'gittertier_scanner_animation',
                        category: 'scanner'
                    },
                    {
                        id: 'scanner_effects',
                        title: 'Scanner Effekte',
                        icon: 'fas fa-magic',
                        description: 'Verbesserte visuelle Effekte beim Scannen',
                        cost: 220,
                        settingKey: 'gittertier_scanner_effects',
                        category: 'scanner'
                    },
                    {
                        id: 'fast_checkout',
                        title: 'Schnellbezahlung',
                        icon: 'fas fa-bolt',
                        description: 'Schnellere Bestätigung von Zahlungen',
                        cost: 300,
                        settingKey: 'gittertier_fast_checkout',
                        category: 'payment'
                    },
                    {
                        id: 'transaction_effects',
                        title: 'Transaktions-Effekte',
                        icon: 'fas fa-fire',
                        description: 'Spezielle Animationen bei erfolgreichen Zahlungen',
                        cost: 120,
                        settingKey: 'gittertier_transaction_effects',
                        category: 'payment'
                    },
                    {
                        id: 'priority_processing',
                        title: 'Prioritäts-Verarbeitung',
                        icon: 'fas fa-star',
                        description: 'Schnellere Verarbeitung von Zahlungsvorgängen',
                        cost: 300,
                        settingKey: 'gittertier_priority_processing',
                        category: 'payment'
                    },
                    {
                        id: 'dark_mode_plus',
                        title: 'Dark Mode Plus',
                        icon: 'fas fa-moon',
                        description: 'Erweiterte Dark Mode Optionen mit angepassten Farben',
                        cost: 150,
                        settingKey: 'gittertier_dark_mode_plus',
                        category: 'display'
                    },
                    {
                        id: 'point_multiplier',
                        title: 'Punkt-Multiplikator',
                        icon: 'fas fa-rocket',
                        description: 'Erhalten Sie 2x Punkte auf alle Einkäufe',
                        cost: 500,
                        settingKey: 'gittertier_point_multiplier',
                        category: 'points'
                    }
                ];
                
                this.currentTutorialSlide = 1;
                this.totalTutorialSlides = 5;
                this.init();
            }

            init() {
                this.loadAllData();
                this.applySettings();
                this.applyDarkMode();
                this.setupEventListeners();
                this.updateUI();
                
                // Check tutorial status
                setTimeout(() => {
                    this.checkTutorial();
                }, 1500);
            }

            loadAllData() {
                // Load user settings
                const savedSettings = localStorage.getItem(this.storageKeys.userSettings);
                this.userSettings = savedSettings ? JSON.parse(savedSettings) : {...this.defaultSettings};
                
                // Load loyalty data (try multiple sources for compatibility)
                const loyaltyData = localStorage.getItem(this.storageKeys.loyaltyData);
                const paymentPrefs = localStorage.getItem(this.storageKeys.paymentPrefs);
                
                if (loyaltyData) {
                    this.loyaltyData = JSON.parse(loyaltyData);
                } else if (paymentPrefs) {
                    const prefs = JSON.parse(paymentPrefs);
                    this.loyaltyData = {
                        currentPoints: prefs.loyaltyPoints || 0,
                        lifetimePoints: prefs.loyaltyPoints || 0,
                        currentTier: prefs.currentTier || 'bronze',
                        isPremiumMember: prefs.isLoyaltyMember || false,
                        joinDate: prefs.joinDate || new Date().toISOString()
                    };
                } else {
                    this.loyaltyData = {
                        currentPoints: 0,
                        lifetimePoints: 0,
                        currentTier: 'bronze',
                        isPremiumMember: false,
                        joinDate: null
                    };
                }
                
                // Load unlocked features
                const unlockedFeatures = localStorage.getItem(this.storageKeys.unlockedFeatures);
                this.unlockedFeatures = unlockedFeatures ? JSON.parse(unlockedFeatures) : {};
                
                // Load purchase history
                const purchaseHistory = localStorage.getItem(this.storageKeys.purchaseHistory);
                this.purchaseHistory = purchaseHistory ? JSON.parse(purchaseHistory) : [];
                
                // Load app settings for stats
                const appSettings = localStorage.getItem(this.storageKeys.appSettings);
                this.appSettings = appSettings ? JSON.parse(appSettings) : {};
                
                // Load user name
                this.userName = localStorage.getItem('gittertier_user_name') || 'Gast';
                
                // Load user stats
                this.userStats = {
                    totalScans: parseInt(localStorage.getItem('gittertier_total_scans')) || 0,
                    totalPurchases: parseInt(localStorage.getItem('gittertier_total_purchases')) || 0,
                    totalSpent: parseFloat(localStorage.getItem('gittertier_total_spent')) || 0
                };
            }

            saveUserSettings() {
                localStorage.setItem(this.storageKeys.userSettings, JSON.stringify(this.userSettings));
            }

            saveLoyaltyData() {
                localStorage.setItem(this.storageKeys.loyaltyData, JSON.stringify(this.loyaltyData));
                
                // Also update payment preferences for compatibility
                const paymentPrefs = JSON.parse(localStorage.getItem(this.storageKeys.paymentPrefs) || '{}');
                paymentPrefs.loyaltyPoints = this.loyaltyData.currentPoints;
                paymentPrefs.isLoyaltyMember = this.loyaltyData.isPremiumMember;
                paymentPrefs.currentTier = this.loyaltyData.currentTier;
                localStorage.setItem(this.storageKeys.paymentPrefs, JSON.stringify(paymentPrefs));
            }

            saveUnlockedFeatures() {
                localStorage.setItem(this.storageKeys.unlockedFeatures, JSON.stringify(this.unlockedFeatures));
            }

            savePurchaseHistory() {
                localStorage.setItem(this.storageKeys.purchaseHistory, JSON.stringify(this.purchaseHistory));
            }

            saveUserName(name) {
                this.userName = name;
                localStorage.setItem('gittertier_user_name', name);
            }

            saveUserStats() {
                localStorage.setItem('gittertier_total_scans', this.userStats.totalScans.toString());
                localStorage.setItem('gittertier_total_purchases', this.userStats.totalPurchases.toString());
                localStorage.setItem('gittertier_total_spent', this.userStats.totalSpent.toString());
            }

            applySettings() {
                // Apply sound effects setting
                if (!this.userSettings.soundEffects) {
                    // Disable sound effects in the app
                    window.playSound = function() {};
                }
                
                // Apply font size
                const fontSizeMap = {
                    small: '14px',
                    medium: '16px',
                    large: '18px'
                };
                document.documentElement.style.fontSize = fontSizeMap[this.userSettings.fontSize] || '16px';
                
                // Apply auto dark mode based on system preference
                this.applyDarkMode();
            }

            applyDarkMode() {
                const theme = localStorage.getItem('gittertier_theme');
                if (theme === 'night' || theme === 'dark') {
                    document.body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-mode');
                } else {
                    // Auto detect from system
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                }
            }

            getTierInfo(tier) {
                const tiers = {
                    bronze: { 
                        name: 'Bronze', 
                        icon: 'fas fa-medal',
                        color: '#CD7F32',
                        gradient: 'var(--gradient-glass)',
                        multiplier: 1.0,
                        minPoints: 0,
                        nextPoints: 500,
                        discount: 0,
                        benefits: [
                            'Grundlegende Funktionen',
                            'Punktesammeln',
                            'Willkommensgeschenk',
                            '5% Rabatt auf ausgewählte Artikel'
                        ]
                    },
                    silver: { 
                        name: 'Silber', 
                        icon: 'fas fa-medal',
                        color: '#C0C0C0',
                        gradient: 'var(--gradient-silver)',
                        multiplier: 1.2,
                        minPoints: 500,
                        nextPoints: 1500,
                        discount: 5,
                        benefits: [
                            'Alle Bronze Vorteile',
                            '5% Rabatt auf alle Einkäufe',
                            'Exklusive Angebote',
                            'Premium Belegdesign'
                        ]
                    },
                    gold: { 
                        name: 'Gold', 
                        icon: 'fas fa-medal',
                        color: '#FFD700',
                        gradient: 'var(--gradient-gold)',
                        multiplier: 1.5,
                        minPoints: 1500,
                        nextPoints: 3000,
                        discount: 10,
                        benefits: [
                            'Alle Silber Vorteile',
                            '10% Rabatt auf alle Einkäufe',
                            'Kostenlose Produktproben',
                            'Prioritärer Support',
                            'Gold Belegdesign'
                        ]
                    },
                    platinum: { 
                        name: 'Platin', 
                        icon: 'fas fa-gem',
                        color: '#E5E4E2',
                        gradient: 'var(--gradient-platinum)',
                        multiplier: 2.0,
                        minPoints: 3000,
                        nextPoints: 5000,
                        discount: 15,
                        benefits: [
                            'Alle Gold Vorteile',
                            '15% Rabatt auf alle Einkäufe',
                            'Früher Zugang zu neuen Produkten',
                            'Persönlicher Shopping-Assistent',
                            'Platinum Belegdesign'
                        ]
                    },
                    diamond: { 
                        name: 'Diamant', 
                        icon: 'fas fa-gem',
                        color: '#B9F2FF',
                        gradient: 'var(--gradient-diamond)',
                        multiplier: 3.0,
                        minPoints: 5000,
                        nextPoints: null,
                        discount: 20,
                        benefits: [
                            'Alle Platin Vorteile',
                            '20% Rabatt auf alle Einkäufe',
                            'Kostenlose Lieferung',
                            'VIP-Events',
                            'Persönlicher Einkaufsberater'
                        ]
                    }
                };
                return tiers[tier] || tiers.bronze;
            }

            calculateTier(points) {
                if (points >= 5000) return 'diamond';
                if (points >= 3000) return 'platinum';
                if (points >= 1500) return 'gold';
                if (points >= 500) return 'silver';
                return 'bronze';
            }

            addPoints(amount, reason = '') {
                const oldTier = this.loyaltyData.currentTier;
                this.loyaltyData.currentPoints += amount;
                this.loyaltyData.lifetimePoints += amount;
                
                const newTier = this.calculateTier(this.loyaltyData.currentPoints);
                this.loyaltyData.currentTier = newTier;
                
                this.saveLoyaltyData();
                this.updateUI();
                
                if (newTier !== oldTier) {
                    this.showNotification(`🎉 Herzlichen Glückwunsch! Sie wurden von ${this.getTierInfo(oldTier).name} auf ${this.getTierInfo(newTier).name} befördert!`, 'success');
                    this.createConfetti();
                } else if (amount > 0) {
                    this.showNotification(`${amount} Punkte erhalten! ${reason}`, 'success');
                }
                
                return true;
            }

            spendPoints(amount) {
                if (this.loyaltyData.currentPoints < amount) {
                    this.showNotification('Nicht genug Punkte!', 'error');
                    return false;
                }
                
                this.loyaltyData.currentPoints -= amount;
                this.saveLoyaltyData();
                this.updateUI();
                this.showNotification(`${amount} Punkte ausgegeben`, 'info');
                return true;
            }

            unlockFeature(featureId) {
                const feature = this.premiumFeatures.find(f => f.id === featureId);
                if (!feature) return false;
                
                // Check if already unlocked
                if (this.unlockedFeatures[featureId]) {
                    // Toggle activation
                    this.unlockedFeatures[featureId].active = !this.unlockedFeatures[featureId].active;
                    this.saveUnlockedFeatures();
                    
                    if (this.unlockedFeatures[featureId].active) {
                        this.applyFeature(featureId);
                        this.showNotification(`${feature.title} aktiviert`, 'success');
                    } else {
                        this.removeFeature(featureId);
                        this.showNotification(`${feature.title} deaktiviert`, 'info');
                    }
                    
                    this.updateUI();
                    return true;
                }
                
                // Try to unlock
                if (this.loyaltyData.currentPoints >= feature.cost) {
                    if (this.spendPoints(feature.cost)) {
                        this.unlockedFeatures[featureId] = {
                            unlocked: true,
                            unlockedDate: new Date().toISOString(),
                            active: true
                        };
                        
                        this.applyFeature(featureId);
                        this.saveUnlockedFeatures();
                        this.showNotification(`🎉 ${feature.title} freigeschaltet!`, 'success');
                        this.createConfetti();
                        this.updateUI();
                        return true;
                    }
                }
                
                return false;
            }

            applyFeature(featureId) {
                const feature = this.premiumFeatures.find(f => f.id === featureId);
                if (!feature) return;
                
                // Apply feature to localStorage
                localStorage.setItem(feature.settingKey, 'true');
                
                // Apply visual effects if applicable
                if (featureId === 'scanner_animation' || featureId === 'scanner_effects') {
                    this.showNotification('Scanner-Effekte wurden aktiviert. Starten Sie den Scanner neu, um die Änderungen zu sehen.', 'info');
                }
            }

            removeFeature(featureId) {
                const feature = this.premiumFeatures.find(f => f.id === featureId);
                if (!feature) return;
                
                localStorage.removeItem(feature.settingKey);
            }

            isFeatureUnlocked(featureId) {
                return this.unlockedFeatures[featureId]?.unlocked || false;
            }

            isFeatureActive(featureId) {
                return this.unlockedFeatures[featureId]?.active || false;
            }

            joinPremiumClub() {
                if (this.loyaltyData.isPremiumMember) {
                    this.showNotification('Sie sind bereits Premium-Mitglied!', 'info');
                    return false;
                }
                
                this.loyaltyData.isPremiumMember = true;
                this.loyaltyData.joinDate = new Date().toISOString();
                
                // Add welcome bonus
                this.addPoints(100, 'Willkommensbonus');
                
                this.saveLoyaltyData();
                this.showNotification('Herzlich willkommen im Premium Club! Sie erhalten 100 Willkommenspunkte!', 'success');
                this.createConfetti();
                this.updateUI();
                return true;
            }

            changeUserName(newName) {
                if (!newName || newName.trim() === '') {
                    this.showNotification('Bitte geben Sie einen gültigen Namen ein', 'error');
                    return false;
                }
                
                if (newName === this.userName) {
                    this.showNotification('Das ist bereits Ihr aktueller Name', 'info');
                    return false;
                }
                
                // Name change costs 10 points
                if (this.spendPoints(10)) {
                    this.saveUserName(newName.trim());
                    this.showNotification(`Ihr Name wurde erfolgreich zu "${newName.trim()}" geändert`, 'success');
                    this.updateUI();
                    return true;
                }
                
                return false;
            }

            addPurchase(purchaseData) {
                const purchase = {
                    id: 'PUR-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5),
                    date: new Date().toISOString(),
                    items: purchaseData.items || [],
                    total: purchaseData.total || 0,
                    pointsEarned: Math.floor(purchaseData.total) || 0
                };
                
                this.purchaseHistory.unshift(purchase);
                if (this.purchaseHistory.length > 50) {
                    this.purchaseHistory = this.purchaseHistory.slice(0, 50);
                }
                
                // Update stats
                this.userStats.totalPurchases++;
                this.userStats.totalSpent += purchase.total;
                this.saveUserStats();
                
                this.savePurchaseHistory();
                return purchase;
            }

            addScan() {
                this.userStats.totalScans++;
                this.saveUserStats();
                this.updateUI();
            }

            clearLocalData() {
                // Clear all local data except loyalty and premium features
                localStorage.removeItem(this.storageKeys.userSettings);
                localStorage.removeItem('gittertier_cart');
                localStorage.removeItem('gittertier_scanner_animation');
                localStorage.removeItem('gittertier_scanner_effects');
                localStorage.removeItem('gittertier_fast_checkout');
                localStorage.removeItem('gittertier_transaction_effects');
                localStorage.removeItem('gittertier_priority_processing');
                localStorage.removeItem('gittertier_dark_mode_plus');
                localStorage.removeItem('gittertier_point_multiplier');
                localStorage.removeItem('gittertier_total_scans');
                localStorage.removeItem('gittertier_total_purchases');
                localStorage.removeItem('gittertier_total_spent');
                
                // Reset user settings to default
                this.userSettings = {...this.defaultSettings};
                this.userStats = {
                    totalScans: 0,
                    totalPurchases: 0,
                    totalSpent: 0
                };
                
                this.saveUserSettings();
                this.saveUserStats();
                this.applySettings();
                this.showNotification('Alle lokalen Daten wurden gelöscht', 'success');
                this.updateUI();
            }

            resetSettings() {
                this.userSettings = {...this.defaultSettings};
                this.saveUserSettings();
                this.applySettings();
                this.showNotification('Alle Einstellungen wurden auf Standardwerte zurückgesetzt', 'success');
                this.updateUI();
            }

            // UI Updates
            updateUI() {
                // Update user name
                document.getElementById('user-name').textContent = this.userName;
                document.getElementById('profile-avatar').innerHTML = `<i class="fas fa-user"></i>`;
                
                // Update user stats
                document.getElementById('total-scans').textContent = this.userStats.totalScans;
                document.getElementById('total-purchases').textContent = this.userStats.totalPurchases;
                document.getElementById('total-spent').textContent = this.userStats.totalSpent.toFixed(2) + '€';
                
                // Update join date
                if (this.loyaltyData.joinDate) {
                    const joinDate = new Date(this.loyaltyData.joinDate);
                    document.getElementById('join-date').textContent = joinDate.toLocaleDateString('de-DE');
                } else {
                    document.getElementById('join-date').textContent = '-';
                }
                
                // Update loyalty points
                document.getElementById('loyalty-points').textContent = this.loyaltyData.currentPoints;
                document.getElementById('name-change-points').textContent = this.loyaltyData.currentPoints;
                document.getElementById('unlock-current-points').textContent = this.loyaltyData.currentPoints;
                document.getElementById('modal-current-points').textContent = this.loyaltyData.currentPoints;
                document.getElementById('modal-lifetime-points').textContent = this.loyaltyData.lifetimePoints;
                
                // Update tier display
                const tierInfo = this.getTierInfo(this.loyaltyData.currentTier);
                document.getElementById('current-tier').textContent = tierInfo.name;
                document.getElementById('current-tier-badge').innerHTML = `<i class="${tierInfo.icon}"></i><span>${tierInfo.name}</span>`;
                document.getElementById('modal-current-tier').textContent = tierInfo.name;
                
                // Update progress bar
                const nextTierPoints = tierInfo.nextPoints;
                if (nextTierPoints) {
                    const progress = ((this.loyaltyData.currentPoints - tierInfo.minPoints) / (nextTierPoints - tierInfo.minPoints)) * 100;
                    document.getElementById('progress-fill').style.width = `${Math.min(progress, 100)}%`;
                    document.getElementById('progress-text').textContent = 
                        `${this.loyaltyData.currentPoints - tierInfo.minPoints}/${nextTierPoints - tierInfo.minPoints}`;
                    document.getElementById('modal-progress-fill').style.width = `${Math.min(progress, 100)}%`;
                    document.getElementById('modal-progress-text').textContent = 
                        `${this.loyaltyData.currentPoints - tierInfo.minPoints}/${nextTierPoints - tierInfo.minPoints}`;
                } else {
                    document.getElementById('progress-fill').style.width = '100%';
                    document.getElementById('progress-text').textContent = 'Maximales Level erreicht!';
                    document.getElementById('modal-progress-fill').style.width = '100%';
                    document.getElementById('modal-progress-text').textContent = 'Maximales Level erreicht!';
                }
                
                // Update unlocked features count
                const unlockedCount = Object.values(this.unlockedFeatures).filter(f => f.unlocked && f.active).length;
                document.getElementById('modal-unlocked-features').textContent = unlockedCount;
                
                // Update loyalty section visibility
                const joinBtn = document.getElementById('join-loyalty-btn');
                const loyaltySection = document.getElementById('loyalty-section');
                
                if (this.loyaltyData.isPremiumMember) {
                    joinBtn.style.display = 'none';
                    loyaltySection.style.background = 'linear-gradient(135deg, var(--color-card-bg-glass) 0%, rgba(255, 215, 0, 0.1) 100%)';
                } else {
                    joinBtn.style.display = 'block';
                    loyaltySection.style.background = 'var(--color-card-bg-glass)';
                }
                
                // Update settings toggles
                document.getElementById('sound-effects-toggle').checked = this.userSettings.soundEffects;
                document.getElementById('auto-add-toggle').checked = this.userSettings.autoAddToCart;
                document.getElementById('continuous-scan-toggle').checked = this.userSettings.continuousScan;
                document.getElementById('payment-confirmations-toggle').checked = this.userSettings.paymentConfirmations;
                document.getElementById('font-size-select').value = this.userSettings.fontSize;
                
                // Update premium feature toggles
                document.getElementById('scanner-animation-toggle').checked = this.isFeatureActive('scanner_animation');
                document.getElementById('scanner-effects-toggle').checked = this.isFeatureActive('scanner_effects');
                document.getElementById('fast-checkout-toggle').checked = this.isFeatureActive('fast_checkout');
                document.getElementById('transaction-effects-toggle').checked = this.isFeatureActive('transaction_effects');
                document.getElementById('priority-processing-toggle').checked = this.isFeatureActive('priority_processing');
                document.getElementById('dark-mode-plus-toggle').checked = this.isFeatureActive('dark_mode_plus');
                
                // Enable/disable premium feature toggles based on unlock status
                const premiumToggles = [
                    'scanner-animation-toggle',
                    'scanner-effects-toggle',
                    'fast-checkout-toggle',
                    'transaction-effects-toggle',
                    'priority-processing-toggle',
                    'dark-mode-plus-toggle'
                ];
                
                premiumToggles.forEach(toggleId => {
                    const toggle = document.getElementById(toggleId);
                    const featureId = toggleId.replace('-toggle', '');
                    const feature = this.premiumFeatures.find(f => f.id === featureId);
                    
                    if (feature && this.isFeatureUnlocked(featureId)) {
                        toggle.disabled = false;
                        // Remove locked overlay
                        const settingElement = document.getElementById(`${featureId}-setting`);
                        if (settingElement) {
                            settingElement.classList.remove('locked-setting');
                            const overlay = settingElement.querySelector('.locked-overlay');
                            if (overlay) overlay.style.display = 'none';
                        }
                    } else {
                        toggle.disabled = true;
                    }
                });
                
                // Render premium features grid
                this.renderPremiumFeatures();
                
                // Render all features modal
                this.renderAllFeatures();
                
                // Render tiers in modal
                this.renderTiersModal();
                
                // Render purchase history
                this.renderPurchaseHistory();
                
                // Update charts if modal is open
                if (document.getElementById('loyalty-details-modal').classList.contains('active')) {
                    this.renderPointsChart();
                }
            }

            renderPremiumFeatures() {
                const container = document.getElementById('premium-features-grid');
                if (!container) return;
                
                // Filter to show only 4 features in main view
                const featuredFeatures = this.premiumFeatures.slice(0, 4);
                
                if (featuredFeatures.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-gem"></i>
                            <p>Keine Premium Features verfügbar</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = featuredFeatures.map(feature => {
                    const isUnlocked = this.isFeatureUnlocked(feature.id);
                    const isActive = this.isFeatureActive(feature.id);
                    
                    return `
                        <div class="feature-card ${isUnlocked ? 'unlocked' : ''}">
                            <div class="feature-header">
                                <div class="feature-icon">
                                    <i class="${feature.icon}"></i>
                                </div>
                                <div class="feature-cost">${feature.cost} Punkte</div>
                            </div>
                            <h3 class="feature-title">${feature.title}</h3>
                            <p class="feature-description">${feature.description}</p>
                            <div class="feature-status ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                                ${isUnlocked ? (isActive ? '✅ Aktiviert' : '⏸️ Deaktiviert') : '🔒 Gesperrt'}
                            </div>
                            <button class="unlock-btn ${isUnlocked ? 'unlocked' : ''}" 
                                    data-feature="${feature.id}"
                                    ${!isUnlocked && this.loyaltyData.currentPoints < feature.cost ? 'disabled' : ''}>
                                ${isUnlocked ? 
                                    (isActive ? 
                                        '<i class="fas fa-toggle-on"></i> Deaktivieren' : 
                                        '<i class="fas fa-toggle-off"></i> Aktivieren') : 
                                    (this.loyaltyData.currentPoints >= feature.cost ? 
                                        `<i class="fas fa-lock-open"></i> Für ${feature.cost} Punkte freischalten` : 
                                        '🔒 Nicht genug Punkte')}
                            </button>
                        </div>
                    `;
                }).join('');
            }

            renderAllFeatures() {
                const container = document.getElementById('all-features-grid');
                if (!container) return;
                
                if (this.premiumFeatures.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-gem"></i>
                            <p>Keine Premium Features verfügbar</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = this.premiumFeatures.map(feature => {
                    const isUnlocked = this.isFeatureUnlocked(feature.id);
                    const isActive = this.isFeatureActive(feature.id);
                    
                    return `
                        <div class="feature-card ${isUnlocked ? 'unlocked' : ''}">
                            <div class="feature-header">
                                <div class="feature-icon">
                                    <i class="${feature.icon}"></i>
                                </div>
                                <div class="feature-cost">${feature.cost} Punkte</div>
                            </div>
                            <h3 class="feature-title">${feature.title}</h3>
                            <p class="feature-description">${feature.description}</p>
                            <div class="feature-status ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                                ${isUnlocked ? (isActive ? '✅ Aktiviert' : '⏸️ Deaktiviert') : '🔒 Gesperrt'}
                            </div>
                            <button class="unlock-btn ${isUnlocked ? 'unlocked' : ''}" 
                                    data-feature="${feature.id}"
                                    ${!isUnlocked && this.loyaltyData.currentPoints < feature.cost ? 'disabled' : ''}>
                                ${isUnlocked ? 
                                    (isActive ? 
                                        '<i class="fas fa-toggle-on"></i> Deaktivieren' : 
                                        '<i class="fas fa-toggle-off"></i> Aktivieren') : 
                                    (this.loyaltyData.currentPoints >= feature.cost ? 
                                        `<i class="fas fa-lock-open"></i> Für ${feature.cost} Punkte freischalten` : 
                                        '🔒 Nicht genug Punkte')}
                            </button>
                        </div>
                    `;
                }).join('');
            }

            renderTiersModal() {
                const container = document.getElementById('modal-tiers-grid');
                if (!container) return;
                
                const tiers = ['bronze', 'silver', 'gold', 'platinum', 'diamond'];
                const currentTier = this.loyaltyData.currentTier;
                
                container.innerHTML = tiers.map(tier => {
                    const tierInfo = this.getTierInfo(tier);
                    const isCurrent = currentTier === tier;
                    const isUnlocked = this.loyaltyData.currentPoints >= tierInfo.minPoints;
                    
                    return `
                        <div style="background: ${isCurrent ? tierInfo.gradient : 'var(--gradient-glass)'}; 
                                    border: ${isCurrent ? '2px solid ' + tierInfo.color : 'var(--glass-border)'}; 
                                    border-radius: var(--radius); padding: var(--spacing-md); text-align: center;">
                            <div style="font-size: var(--text-lg); font-weight: 700; margin-bottom: var(--spacing-xs); color: ${isCurrent ? '#000000' : 'var(--color-text)'};">
                                ${tierInfo.name}
                            </div>
                            <div style="font-size: var(--text-sm); color: ${isCurrent ? 'rgba(0, 0, 0, 0.8)' : 'var(--color-text-muted)'}; margin-bottom: var(--spacing-xs);">
                                Ab ${tierInfo.minPoints} Punkten
                            </div>
                            <div style="font-size: var(--text-xs); color: ${isCurrent ? 'rgba(0, 0, 0, 0.6)' : 'var(--color-text-muted)'};">
                                ${isCurrent ? '✔ Aktueller Status' : (isUnlocked ? '✔ Erreicht' : '🔒 Noch nicht erreicht')}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderPurchaseHistory() {
                const container = document.getElementById('purchase-history-list');
                const emptyState = document.getElementById('empty-purchase-history');
                
                if (!container) return;
                
                if (this.purchaseHistory.length === 0) {
                    container.innerHTML = '';
                    if (emptyState) emptyState.style.display = 'flex';
                    return;
                }
                
                if (emptyState) emptyState.style.display = 'none';
                
                container.innerHTML = this.purchaseHistory.slice(0, 20).map(purchase => {
                    const date = new Date(purchase.date);
                    const itemCount = purchase.items.length;
                    
                    return `
                        <div class="purchase-item">
                            <div>
                                <div class="purchase-date">${date.toLocaleDateString('de-DE')} ${date.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'})}</div>
                                <div class="purchase-items">${itemCount} Artikel</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="purchase-amount">${purchase.total.toFixed(2)}€</div>
                                <div style="font-size: var(--text-xs); color: var(--color-premium);">
                                    +${purchase.pointsEarned} Punkte
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderPointsChart() {
                const ctx = document.getElementById('points-chart');
                if (!ctx) return;
                
                // Destroy existing chart if it exists
                if (this.pointsChart) {
                    this.pointsChart.destroy();
                }
                
                // Generate sample data for last 7 days
                const labels = [];
                const data = [];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - i);
                    labels.push(date.toLocaleDateString('de-DE', { weekday: 'short' }));
                    
                    // Generate random points for demonstration
                    data.push(Math.floor(Math.random() * 50) + 10);
                }
                
                // Add today's actual points
                data[6] = Math.floor(this.loyaltyData.currentPoints / 10);
                
                this.pointsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Punkte pro Tag',
                            data: data,
                            borderColor: 'var(--color-premium)',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(142, 142, 147, 0.1)'
                                },
                                ticks: {
                                    color: 'var(--color-text-muted)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(142, 142, 147, 0.1)'
                                },
                                ticks: {
                                    color: 'var(--color-text-muted)'
                                }
                            }
                        }
                    }
                });
            }

            // Tutorial System
            checkTutorial() {
                const tutorialSeen = localStorage.getItem(this.storageKeys.tutorialSeen);
                if (!tutorialSeen && this.userStats.totalPurchases === 0) {
                    setTimeout(() => {
                        this.showTutorial();
                    }, 2000);
                }
            }

            showTutorial() {
                this.currentTutorialSlide = 1;
                this.showModal('tutorial-modal');
                this.updateTutorialSlide();
            }

            hideTutorial() {
                this.hideModal('tutorial-modal');
                localStorage.setItem(this.storageKeys.tutorialSeen, 'true');
            }

            updateTutorialSlide() {
                // Hide all slides
                document.querySelectorAll('.tutorial-slide').forEach(slide => {
                    slide.classList.remove('active');
                });
                
                // Show current slide
                const currentSlide = document.getElementById(`tutorial-slide-${this.currentTutorialSlide}`);
                if (currentSlide) {
                    currentSlide.classList.add('active');
                }
                
                // Update indicators
                document.querySelectorAll('.tutorial-indicator').forEach((indicator, index) => {
                    if (index + 1 === this.currentTutorialSlide) {
                        indicator.classList.add('active');
                    } else {
                        indicator.classList.remove('active');
                    }
                });
            }

            nextTutorialSlide() {
                if (this.currentTutorialSlide < this.totalTutorialSlides) {
                    this.currentTutorialSlide++;
                    this.updateTutorialSlide();
                } else {
                    this.hideTutorial();
                    this.showNotification('Tutorial abgeschlossen! Sie können es jederzeit über den Tutorial-Button neu starten.', 'success');
                }
            }

            prevTutorialSlide() {
                if (this.currentTutorialSlide > 1) {
                    this.currentTutorialSlide--;
                    this.updateTutorialSlide();
                }
            }

            // Modal System
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            showUnlockFeatureModal(featureId) {
                const feature = this.premiumFeatures.find(f => f.id === featureId);
                if (!feature) return;
                
                const isUnlocked = this.isFeatureUnlocked(featureId);
                const canAfford = this.loyaltyData.currentPoints >= feature.cost;
                
                document.getElementById('unlock-feature-icon').innerHTML = `<i class="${feature.icon}"></i>`;
                document.getElementById('unlock-feature-title').textContent = feature.title;
                document.getElementById('unlock-feature-description').textContent = feature.description;
                document.getElementById('unlock-required-points').textContent = feature.cost;
                document.getElementById('unlock-current-points').textContent = this.loyaltyData.currentPoints;
                
                const pointsDiff = feature.cost - this.loyaltyData.currentPoints;
                const pointsDiffElement = document.getElementById('unlock-points-difference');
                
                if (pointsDiff > 0) {
                    pointsDiffElement.innerHTML = `<span>Verbleibend:</span><span style="color: var(--color-error);">${pointsDiff}</span>`;
                    pointsDiffElement.style.display = 'flex';
                } else {
                    pointsDiffElement.style.display = 'none';
                }
                
                const confirmBtn = document.getElementById('confirm-unlock-feature');
                if (isUnlocked) {
                    confirmBtn.innerHTML = `<i class="fas fa-sync-alt"></i> ${this.isFeatureActive(featureId) ? 'Deaktivieren' : 'Aktivieren'}`;
                    confirmBtn.classList.remove('btn-premium');
                    confirmBtn.classList.add('btn-secondary');
                } else {
                    confirmBtn.innerHTML = `<i class="fas fa-unlock"></i> Für ${feature.cost} Punkte freischalten`;
                    confirmBtn.classList.remove('btn-secondary');
                    confirmBtn.classList.add('btn-premium');
                    confirmBtn.disabled = !canAfford;
                }
                
                // Store current feature for later use
                confirmBtn.dataset.feature = featureId;
                
                this.showModal('unlock-feature-modal');
            }

            // Effects and Notifications
            createConfetti() {
                const container = document.getElementById('confetti-container');
                if (!container) return;
                
                container.style.display = 'block';
                container.innerHTML = '';
                
                const colors = ['#FFD700', '#FF9F0A', '#FF375F', '#5856D6', '#34C759'];
                
                for (let i = 0; i < 150; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.animationDuration = Math.random() * 2 + 1 + 's';
                    confetti.style.animationDelay = Math.random() * 1 + 's';
                    container.appendChild(confetti);
                }
                
                setTimeout(() => {
                    container.style.display = 'none';
                    container.innerHTML = '';
                }, 3000);
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                const messageElement = document.getElementById('notification-message');
                
                if (!notification || !messageElement) return;
                
                // Set message and type
                messageElement.textContent = message;
                notification.className = 'notification';
                notification.classList.add(type);
                
                // Show notification
                notification.classList.add('show');
                
                // Auto hide after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Event Listeners Setup
            setupEventListeners() {
                // Back button
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    window.history.back();
                });
                
                // Edit name button
                document.getElementById('edit-name-btn').addEventListener('click', () => {
                    document.getElementById('new-name-input').value = this.userName;
                    this.showModal('edit-name-modal');
                });
                
                // Save name button
                document.getElementById('save-name-btn').addEventListener('click', () => {
                    const newName = document.getElementById('new-name-input').value.trim();
                    if (this.changeUserName(newName)) {
                        this.hideModal('edit-name-modal');
                    }
                });
                
                // Cancel name button
                document.getElementById('cancel-name-btn').addEventListener('click', () => {
                    this.hideModal('edit-name-modal');
                });
                
                // Join loyalty button
                document.getElementById('join-loyalty-btn').addEventListener('click', () => {
                    this.showModal('join-loyalty-modal');
                });
                
                // Confirm join loyalty
                document.getElementById('confirm-join-loyalty').addEventListener('click', () => {
                    if (this.joinPremiumClub()) {
                        this.hideModal('join-loyalty-modal');
                    }
                });
                
                // Cancel join loyalty
                document.getElementById('cancel-join-loyalty').addEventListener('click', () => {
                    this.hideModal('join-loyalty-modal');
                });
                
                // View loyalty details
                document.getElementById('view-loyalty-details').addEventListener('click', () => {
                    this.showModal('loyalty-details-modal');
                    // Render chart when modal opens
                    setTimeout(() => {
                        this.renderPointsChart();
                    }, 100);
                });
                
                // View all features
                document.getElementById('view-all-features').addEventListener('click', () => {
                    this.showModal('all-features-modal');
                });
                
                // Start tutorial
                document.getElementById('start-tutorial-btn').addEventListener('click', () => {
                    this.showTutorial();
                });
                
                // FAQ button
                document.getElementById('faq-btn').addEventListener('click', () => {
                    this.showModal('faq-modal');
                });
                
                // Purchase history
                document.getElementById('purchase-history-btn').addEventListener('click', () => {
                    this.showModal('purchase-history-modal');
                });
                
                // Clear data button
                document.getElementById('clear-data-btn').addEventListener('click', () => {
                    this.showModal('clear-data-modal');
                });
                
                // Reset settings button
                document.getElementById('reset-settings-btn').addEventListener('click', () => {
                    this.showModal('reset-settings-modal');
                });
                
                // Settings toggles
                document.getElementById('sound-effects-toggle').addEventListener('change', (e) => {
                    this.userSettings.soundEffects = e.target.checked;
                    this.saveUserSettings();
                    this.showNotification(e.target.checked ? 'Scangeräusche aktiviert' : 'Scangeräusche deaktiviert', 'info');
                });
                
                document.getElementById('auto-add-toggle').addEventListener('change', (e) => {
                    this.userSettings.autoAddToCart = e.target.checked;
                    this.saveUserSettings();
                    this.showNotification(e.target.checked ? 'Automatisches Hinzufügen aktiviert' : 'Automatisches Hinzufügen deaktiviert', 'info');
                });
                
                document.getElementById('continuous-scan-toggle').addEventListener('change', (e) => {
                    this.userSettings.continuousScan = e.target.checked;
                    this.saveUserSettings();
                    this.showNotification(e.target.checked ? 'Kontinuierliches Scannen aktiviert' : 'Kontinuierliches Scannen deaktiviert', 'info');
                });
                
                document.getElementById('payment-confirmations-toggle').addEventListener('change', (e) => {
                    this.userSettings.paymentConfirmations = e.target.checked;
                    this.saveUserSettings();
                    this.showNotification(e.target.checked ? 'Zahlungsbestätigungen aktiviert' : 'Zahlungsbestätigungen deaktiviert', 'info');
                });
                
                document.getElementById('font-size-select').addEventListener('change', (e) => {
                    this.userSettings.fontSize = e.target.value;
                    this.saveUserSettings();
                    this.applySettings();
                    this.showNotification(`Schriftgröße auf ${e.target.value} geändert`, 'info');
                });
                
                // Premium feature unlock overlays
                document.getElementById('unlock-scanner-animation').addEventListener('click', () => {
                    this.showUnlockFeatureModal('scanner_animation');
                });
                
                document.getElementById('unlock-scanner-effects').addEventListener('click', () => {
                    this.showUnlockFeatureModal('scanner_effects');
                });
                
                document.getElementById('unlock-fast-checkout').addEventListener('click', () => {
                    this.showUnlockFeatureModal('fast_checkout');
                });
                
                document.getElementById('unlock-transaction-effects').addEventListener('click', () => {
                    this.showUnlockFeatureModal('transaction_effects');
                });
                
                document.getElementById('unlock-priority-processing').addEventListener('click', () => {
                    this.showUnlockFeatureModal('priority_processing');
                });
                
                document.getElementById('unlock-dark-mode-plus').addEventListener('click', () => {
                    this.showUnlockFeatureModal('dark_mode_plus');
                });
                
                // Feature unlock buttons (dynamic)
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.unlock-btn')) {
                        const featureId = e.target.closest('.unlock-btn').dataset.feature;
                        if (featureId) {
                            if (this.isFeatureUnlocked(featureId)) {
                                // Toggle activation
                                this.unlockFeature(featureId);
                            } else {
                                // Show unlock modal
                                this.showUnlockFeatureModal(featureId);
                            }
                        }
                    }
                });
                
                // Confirm unlock feature
                document.getElementById('confirm-unlock-feature').addEventListener('click', (e) => {
                    const featureId = e.target.dataset.feature;
                    if (featureId) {
                        if (this.unlockFeature(featureId)) {
                            this.hideModal('unlock-feature-modal');
                        }
                    }
                });
                
                // Cancel unlock feature
                document.getElementById('cancel-unlock-feature').addEventListener('click', () => {
                    this.hideModal('unlock-feature-modal');
                });
                
                // Confirm clear data
                document.getElementById('confirm-clear-data').addEventListener('click', () => {
                    this.clearLocalData();
                    this.hideModal('clear-data-modal');
                });
                
                // Confirm reset settings
                document.getElementById('confirm-reset-settings').addEventListener('click', () => {
                    this.resetSettings();
                    this.hideModal('reset-settings-modal');
                });
                
                // Tutorial navigation
                document.getElementById('tutorial-next').addEventListener('click', () => {
                    this.nextTutorialSlide();
                });
                
                document.getElementById('tutorial-next-2').addEventListener('click', () => {
                    this.nextTutorialSlide();
                });
                
                document.getElementById('tutorial-next-3').addEventListener('click', () => {
                    this.nextTutorialSlide();
                });
                
                document.getElementById('tutorial-next-4').addEventListener('click', () => {
                    this.nextTutorialSlide();
                });
                
                document.getElementById('tutorial-finish').addEventListener('click', () => {
                    this.hideTutorial();
                    this.showNotification('Tutorial abgeschlossen! Sie können es jederzeit über den Tutorial-Button neu starten.', 'success');
                });
                
                document.getElementById('tutorial-prev-2').addEventListener('click', () => {
                    this.prevTutorialSlide();
                });
                
                document.getElementById('tutorial-prev-3').addEventListener('click', () => {
                    this.prevTutorialSlide();
                });
                
                document.getElementById('tutorial-prev-4').addEventListener('click', () => {
                    this.prevTutorialSlide();
                });
                
                document.getElementById('tutorial-prev-5').addEventListener('click', () => {
                    this.prevTutorialSlide();
                });
                
                // Tutorial indicators
                document.querySelectorAll('.tutorial-indicator').forEach(indicator => {
                    indicator.addEventListener('click', (e) => {
                        const slide = parseInt(e.target.dataset.slide);
                        this.currentTutorialSlide = slide;
                        this.updateTutorialSlide();
                    });
                });
                
                // Close modals
                const closeButtons = [
                    'close-edit-name', 'close-join-loyalty', 'close-unlock-feature',
                    'close-all-features', 'close-loyalty-details', 'close-tutorial',
                    'close-tutorial-2', 'close-tutorial-3', 'close-tutorial-4', 'close-tutorial-5',
                    'close-faq', 'close-purchase-history', 'close-clear-data', 'close-reset-settings',
                    'close-all-features-btn', 'close-details-btn', 'close-faq-btn', 'close-history-btn',
                    'cancel-clear-data', 'cancel-reset-settings'
                ];
                
                closeButtons.forEach(buttonId => {
                    const button = document.getElementById(buttonId);
                    if (button) {
                        button.addEventListener('click', () => {
                            const modalId = buttonId.replace('close-', '').replace('cancel-', '') + '-modal';
                            this.hideModal(modalId);
                        });
                    }
                });
                
                // Close modal on overlay click
                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            this.hideModal(overlay.id.replace('-modal', '').replace('modal-', ''));
                        }
                    });
                });
                
                // Close modal on escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal-overlay.active').forEach(overlay => {
                            this.hideModal(overlay.id.replace('-modal', '').replace('modal-', ''));
                        });
                    }
                });
                
                // Update time display
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
                
                // Auto dark mode detection
                if (window.matchMedia) {
                    const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                    darkModeMediaQuery.addListener((e) => {
                        const theme = localStorage.getItem('gittertier_theme');
                        if (!theme) {
                            if (e.matches) {
                                document.body.classList.add('dark-mode');
                            } else {
                                document.body.classList.remove('dark-mode');
                            }
                        }
                    });
                }
                
                // Add demo interaction for testing
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    const demoBtn = document.createElement('button');
                    demoBtn.innerHTML = '<i class="fas fa-plus"></i> 50 Demo-Punkte';
                    demoBtn.style.position = 'fixed';
                    demoBtn.style.bottom = '80px';
                    demoBtn.style.right = '20px';
                    demoBtn.style.zIndex = '1000';
                    demoBtn.style.padding = '10px 15px';
                    demoBtn.style.background = 'var(--gradient-primary)';
                    demoBtn.style.color = 'white';
                    demoBtn.style.border = 'none';
                    demoBtn.style.borderRadius = '20px';
                    demoBtn.style.cursor = 'pointer';
                    demoBtn.style.fontSize = '12px';
                    demoBtn.style.fontWeight = '600';
                    demoBtn.style.boxShadow = 'var(--glass-shadow)';
                    
                    demoBtn.addEventListener('click', () => {
                        this.addPoints(50, 'Demo-Punkte hinzugefügt');
                    });
                    
                    document.body.appendChild(demoBtn);
                }
            }

            updateTime() {
                try {
                    const now = new Date();
                    const timeDisplay = document.getElementById('timeDisplay');
                    
                    if (timeDisplay) {
                        const timeString = now.toLocaleTimeString('de-DE', {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: window.innerWidth <= 768 ? undefined : '2-digit'
                        });
                        const dateString = now.toLocaleDateString('de-DE', {
                            weekday: window.innerWidth <= 768 ? 'short' : 'long',
                            day: '2-digit',
                            month: window.innerWidth <= 768 ? 'short' : 'long',
                            year: window.innerWidth <= 768 ? undefined : 'numeric'
                        });
                        timeDisplay.textContent = window.innerWidth <= 768 ? 
                            `${dateString}, ${timeString}` : 
                            `${dateString}, ${timeString}`;
                    }
                } catch (error) {
                    console.error('Error updating time:', error);
                }
            }
        }

        // ==================== INITIALIZATION ====================
        let userSettingsManager;

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize manager
            userSettingsManager = new UserSettingsManager();
            
            // Apply dark mode on load
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
            }
            
            // Expose to global scope for integration with other pages
            window.userSettingsManager = userSettingsManager;
            
            // Check for any pending actions from other pages
            setTimeout(() => {
                // Check if a purchase was just made
                const lastPurchase = sessionStorage.getItem('gittertier_last_purchase');
                if (lastPurchase) {
                    try {
                        const purchaseData = JSON.parse(lastPurchase);
                        userSettingsManager.addPurchase(purchaseData);
                        userSettingsManager.addPoints(purchaseData.pointsEarned || Math.floor(purchaseData.total), 'Einkauf abgeschlossen');
                        sessionStorage.removeItem('gittertier_last_purchase');
                    } catch (e) {
                        console.error('Error processing last purchase:', e);
                    }
                }
                
                // Check for scans
                const scanCount = sessionStorage.getItem('gittertier_scan_count');
                if (scanCount) {
                    const count = parseInt(scanCount);
                    for (let i = 0; i < count; i++) {
                        userSettingsManager.addScan();
                        if (userSettingsManager.loyaltyData.isPremiumMember) {
                            userSettingsManager.addPoints(1, 'Produkt gescannt');
                        }
                    }
                    sessionStorage.removeItem('gittertier_scan_count');
                }
            }, 500);
        });

        // Helper function for other pages to register purchases
        window.registerPurchase = function(purchaseData) {
            if (userSettingsManager) {
                const purchase = userSettingsManager.addPurchase(purchaseData);
                
                // Calculate points (1 point per euro, double for premium)
                let points = Math.floor(purchaseData.total);
                if (userSettingsManager.loyaltyData.isPremiumMember) {
                    points *= 2;
                }
                
                userSettingsManager.addPoints(points, 'Einkauf abgeschlossen');
                return purchase;
            }
            return null;
        };

        // Helper function for other pages to register scans
        window.registerScan = function() {
            if (userSettingsManager) {
                userSettingsManager.addScan();
                
                // Add points for premium members
                if (userSettingsManager.loyaltyData.isPremiumMember) {
                    userSettingsManager.addPoints(1, 'Produkt gescannt');
                }
                return true;
            }
            return false;
        };

        // Auto-save scans in session storage for later processing
        if (typeof window !== 'undefined' && window.addEventListener) {
            window.addEventListener('beforeunload', function() {
                // This would be called from the scanner page
                // For now, we'll just ensure data is saved
                if (userSettingsManager) {
                    // Any cleanup needed
                }
            });
        }
    </script>
</body>
</html>