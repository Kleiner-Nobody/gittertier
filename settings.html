<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erweiterte Systemeinstellungen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <style>
        :root {
          --bg: #ebeded;
          --surface: #ffffff;
          --text: #2c3e50;
          --text-secondary: #455a64;
          --accent: #6c757d;
          --accent-dark: #5a6268;
          --accent-light: #d6d8db;
          --success: #28a745;
          --danger: #dc3545;
          --warning: #ffc107;
          --info: #17a2b8;
          --border-radius: 16px;
          --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
          -webkit-tap-highlight-color: transparent;
        }

        body {
          font-family: 'Segoe UI', system-ui, sans-serif;
          background: var(--bg);
          color: var(--text);
          min-height: 100vh;
          padding: 20px;
          background-image: 
            radial-gradient(circle at 15% 50%, rgba(108, 117, 125, 0.05) 0%, transparent 20%),
            radial-gradient(circle at 85% 30%, rgba(108, 117, 125, 0.03) 0%, transparent 20%),
            linear-gradient(to bottom, #ebeded, #d6d8db);
          touch-action: manipulation;
        }

        .container {
          max-width: 1200px;
          width: 100%;
          margin: 0 auto;
          padding: 20px;
        }

        /* Header with accent bar */
        header {
          background: var(--accent);
          color: white;
          padding: 20px 30px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          box-shadow: var(--shadow);
          border-radius: var(--border-radius);
          margin-bottom: 30px;
          position: relative;
          overflow: hidden;
        }

        header::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 5px;
          background: var(--accent-dark);
          border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .logo {
          display: flex;
          align-items: center;
          gap: 15px;
        }

        .logo h1 {
          font-size: 1.8rem;
          font-weight: 700;
        }

        .logo i {
          font-size: 1.8rem;
        }

        .user-info {
          display: flex;
          align-items: center;
          gap: 20px;
        }

        .user-icon {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background: var(--accent-light);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.5rem;
          color: var(--accent);
        }

        /* Card styles */
        .settings-card {
          background: var(--surface);
          border-radius: var(--border-radius);
          padding: 30px;
          box-shadow: var(--shadow);
          position: relative;
          overflow: hidden;
          border: 1px solid rgba(0, 0, 0, 0.05);
          margin-bottom: 30px;
        }
        
        .settings-card::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 5px;
          background: var(--accent);
          border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .section-title {
          margin: 0 0 30px 0;
          font-size: 1.8rem;
          color: var(--text);
          font-weight: 600;
          position: relative;
          padding-bottom: 15px;
          border-bottom: 1px solid var(--accent-light);
        }

        .section-title::after {
          content: "";
          position: absolute;
          bottom: 0;
          left: 0;
          width: 60px;
          height: 4px;
          background: var(--accent);
          border-radius: 2px;
        }

        .settings-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 25px;
        }

        .settings-group {
          margin-bottom: 25px;
        }

        .settings-label {
          display: block;
          margin-bottom: 10px;
          font-weight: 600;
          color: var(--text);
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .settings-input {
          width: 100%;
          padding: 16px;
          border: 2px solid var(--accent-light);
          border-radius: 12px;
          font-size: 1.1rem;
          transition: all 0.3s ease;
          background: #ffffff;
          font-family: inherit;
        }

        .settings-input:focus {
          border-color: var(--accent);
          outline: none;
          box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
        }

        textarea.settings-input {
          min-height: 120px;
          resize: vertical;
        }

        /* Buttons */
        .button-group {
          display: flex;
          gap: 15px;
          margin-top: 30px;
          flex-wrap: wrap;
        }

        .btn {
          padding: 18px 30px;
          border: none;
          border-radius: 8px;
          font-size: 1.1rem;
          cursor: pointer;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 12px;
          font-weight: 600;
          box-shadow: var(--shadow);
          position: relative;
          overflow: hidden;
        }

        .btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
          background: var(--accent);
          color: white;
        }

        .btn-primary:hover {
          background: var(--accent-dark);
        }

        .btn-secondary {
          background: var(--accent-light);
          color: var(--text);
        }

        .btn-secondary:hover {
          background: #d1d5da;
        }

        .btn-danger {
          background: var(--danger);
          color: white;
        }

        .btn-danger:hover {
          background: #bd2130;
        }

        .btn-success {
          background: var(--success);
          color: white;
        }

        .btn-success:hover {
          background: #218838;
        }

        /* Toggle switches */
        .switch {
          position: relative;
          display: inline-block;
          width: 60px;
          height: 34px;
        }

        .switch input { 
          opacity: 0;
          width: 0;
          height: 0;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          transition: .4s;
          border-radius: 34px;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 26px;
          width: 26px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }

        input:checked + .slider {
          background-color: var(--success);
        }

        input:checked + .slider:before {
          transform: translateX(26px);
        }

        .number-input {
          width: 120px;
          padding: 12px;
          border: 2px solid var(--accent-light);
          border-radius: 8px;
          font-size: 1rem;
        }

        .range-container {
          display: flex;
          align-items: center;
          gap: 15px;
        }

        .radio-group {
          display: flex;
          gap: 15px;
          align-items: center;
          flex-wrap: wrap;
        }

        .radio-group label {
          display: flex;
          align-items: center;
          gap: 8px;
          cursor: pointer;
          padding: 8px 12px;
          border-radius: 8px;
          transition: background 0.3s;
        }

        .radio-group label:hover {
          background: var(--accent-light);
        }

        /* Floating icons */
        .floating-icon {
          position: fixed;
          z-index: 0;
          opacity: 0.08;
          animation: float 6s ease-in-out infinite;
          color: var(--accent);
          font-size: 50px;
        }

        .floating-icon:nth-child(1) {
          top: 10%;
          left: 10%;
        }

        .floating-icon:nth-child(2) {
          bottom: 15%;
          right: 10%;
          animation-delay: 0.5s;
        }

        .floating-icon:nth-child(3) {
          top: 30%;
          right: 15%;
          animation-delay: 1s;
        }

        @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-15px); }
          100% { transform: translateY(0px); }
        }

        /* Footer */
        footer {
          text-align: center;
          padding: 30px 0;
          margin-top: 40px;
          color: var(--text-secondary);
          font-size: 1rem;
          border-top: 1px solid var(--accent-light);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
          header {
            flex-direction: column;
            text-align: center;
            gap: 20px;
            padding: 25px 20px;
          }
          
          .button-group {
            flex-direction: column;
          }
          
          .btn {
            width: 100%;
          }
          
          .settings-grid {
            grid-template-columns: 1fr;
          }
        }

        @media (max-width: 480px) {
          body {
            padding: 15px;
          }
          
          .section-title {
            font-size: 1.5rem;
          }
          
          .settings-card {
            padding: 25px 20px;
          }
          
          .radio-group {
            flex-direction: column;
            align-items: flex-start;
          }
        }
    </style>
</head>
<body>
    <!-- Floating background icons -->
    <div class="floating-icon"><i class="fas fa-cog"></i></div>
    <div class="floating-icon"><i class="fas fa-sliders-h"></i></div>
    <div class="floating-icon"><i class="fas fa-wrench"></i></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-cogs"></i>
                <h1>Systemeinstellungen</h1>
            </div>
            <div class="user-info">
                <div>Administrator</div>
                <div class="user-icon">
                    <i class="fas fa-user-shield"></i>
                </div>
            </div>
        </header>

        <!-- General Settings -->
        <div class="settings-card">
            <h2 class="section-title">Allgemein</h2>
            <div class="settings-grid">
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-store"></i> Shop-Name
                    </label>
                    <input type="text" class="settings-input" id="shopName" placeholder="Mein Shop">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-euro-sign"></i> Währung
                    </label>
                    <select class="settings-input" id="currency">
                        <option value="EUR">Euro (€)</option>
                        <option value="USD">Dollar ($)</option>
                        <option value="GBP">Pfund (£)</option>
                    </select>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-id-card"></i> Umsatzsteuer-ID
                    </label>
                    <input type="text" class="settings-input" id="taxId" placeholder="DE123456789">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-clock"></i> Zeitzone
                    </label>
                    <select class="settings-input" id="timezone">
                        <option value="Europe/Berlin">Berlin (GMT+1)</option>
                        <option value="Europe/London">London (GMT+0)</option>
                        <option value="America/New_York">New York (GMT-5)</option>
                    </select>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-calendar-alt"></i> Datumsformat
                    </label>
                    <div class="radio-group">
                        <label><input type="radio" name="dateFormat" value="dd.MM.yyyy"> DD.MM.YYYY</label>
                        <label><input type="radio" name="dateFormat" value="MM/dd/yyyy"> MM/DD/YYYY</label>
                        <label><input type="radio" name="dateFormat" value="yyyy-MM-dd"> YYYY-MM-DD</label>
                    </div>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-bell"></i> Benachrichtigungsdauer (ms)
                    </label>
                    <input type="number" class="number-input" id="notificationDuration" min="1000" step="500" value="3000">
                </div>
            </div>
        </div>

        <!-- Payment Settings -->
        <div class="settings-card">
            <h2 class="section-title">Zahlungen</h2>
            <div class="settings-grid">
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-credit-card"></i> Zahlungsmethoden
                    </label>
                    <div style="display: grid; gap: 15px;">
                        <label><input type="checkbox" class="payment-method" value="cash" checked> Bargeld</label>
                        <label><input type="checkbox" class="payment-method" value="ec-card" checked> EC-Karte</label>
                        <label><input type="checkbox" class="payment-method" value="credit-card"> Kreditkarte</label>
                        <label><input type="checkbox" class="payment-method" value="mobile-pay"> Mobile Pay</label>
                    </div>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-print"></i> Automatischer Belegdruck
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="autoPrint" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-coins"></i> Trinkgeld aktivieren
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="tipsEnabled">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-money-bill-wave"></i> Min. Kartenzahlung (€)
                    </label>
                    <input type="number" class="number-input" id="minCardAmount" min="0" step="0.50" value="5.00">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-wave-square"></i> Kontaktloses Limit (€)
                    </label>
                    <input type="number" class="number-input" id="contactlessLimit" min="0" step="5" value="50">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-hourglass-half"></i> Zahlungstimeout (s)
                    </label>
                    <input type="number" class="number-input" id="paymentTimeout" min="30" step="10" value="120">
                </div>
            </div>
        </div>

        <!-- Display Settings -->
        <div class="settings-card">
            <h2 class="section-title">Anzeige</h2>
            <div class="settings-grid">
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-palette"></i> Hauptfarbe
                    </label>
                    <input type="color" id="primaryColor" value="#2c3e50">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-font"></i> Schriftgröße (%)
                    </label>
                    <div class="range-container">
                        <input type="range" id="fontSize" min="80" max="150" value="100">
                        <span id="fontSizeValue">100%</span>
                    </div>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-language"></i> Sprache
                    </label>
                    <select class="settings-input" id="language">
                        <option value="de" selected>Deutsch</option>
                        <option value="en">English</option>
                        <option value="fr">Français</option>
                    </select>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-image"></i> Produktbilder anzeigen
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="showImages" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-film"></i> Animationen aktivieren
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="animationsEnabled" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Receipt Settings -->
        <div class="settings-card">
            <h2 class="section-title">Beleg-Einstellungen</h2>
            <div class="settings-grid">
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-heading"></i> Beleg-Headertext
                    </label>
                    <textarea class="settings-input" id="receiptHeader" rows="3">Vielen Dank für Ihren Einkauf!</textarea>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-camera"></i> Logo auf Beleg drucken
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="printLogo" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-copy"></i> Kundenkopie drucken
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="printCustomerCopy" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-ruler-horizontal"></i> Belegbreite (mm)
                    </label>
                    <input type="number" class="number-input" id="receiptWidth" min="50" max="100" value="80">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-align-left"></i> Detaillierte Artikelbeschreibung
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="detailedItems">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Security Settings -->
        <div class="settings-card">
            <h2 class="section-title">Sicherheit</h2>
            <div class="settings-grid">
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-lock"></i> Login-Timeout (Minuten)
                    </label>
                    <input type="number" class="number-input" id="loginTimeout" min="1" max="60" value="15">
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-key"></i> Passwortkomplexität
                    </label>
                    <select class="settings-input" id="passwordComplexity">
                        <option value="low">Niedrig</option>
                        <option value="medium" selected>Mittel</option>
                        <option value="high">Hoch</option>
                    </select>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-sign-out-alt"></i> Automatischer Logout
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="autoLogout" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">
                        <i class="fas fa-ban"></i> Maximale Login-Versuche
                    </label>
                    <input type="number" class="number-input" id="maxLoginAttempts" min="1" max="10" value="3">
                </div>
            </div>
        </div>

        <!-- Data Management -->
        <div class="settings-card">
            <h2 class="section-title">Datenverwaltung</h2>
            <div class="button-group">
                <button class="btn btn-primary" id="saveSettings">
                    <i class="fas fa-save"></i> Alle speichern
                </button>
                <button class="btn btn-secondary" id="exportSettings">
                    <i class="fas fa-file-export"></i> Export
                </button>
                <label class="btn btn-secondary">
                    <i class="fas fa-file-import"></i> Import 
                    <input type="file" id="importSettings" hidden>
                </label>
                <button class="btn btn-danger" id="resetSettings">
                    <i class="fas fa-undo"></i> Zurücksetzen
                </button>
            </div>
        </div>

        <footer>
            <p>© 2023 Systemeinstellungen | Alle Rechte vorbehalten</p>
        </footer>
    </div>

    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = decodeURIComponent(urlParams.get('token') || '');
            const validTokens = JSON.parse(sessionStorage.getItem('validTokens') || '[]');
            const tokenIndex = validTokens.indexOf(urlToken);

            if(tokenIndex === -1) {
                const redirect = encodeURIComponent(window.location.href);
                window.location.href = `login.html?redirect=${redirect}`;
            } else {
                // Remove used token and clean URL
                validTokens.splice(tokenIndex, 1);
                sessionStorage.setItem('validTokens', JSON.stringify(validTokens));
                history.replaceState(null, null, window.location.pathname);
            }
        })();
        
        // Initialize settings
        const defaultSettings = {
            general: {
                shopName: "Mein Shop",
                currency: "EUR",
                taxId: "",
                timezone: "Europe/Berlin",
                dateFormat: "dd.MM.yyyy",
                notificationDuration: 3000
            },
            payment: {
                methods: ["cash", "ec-card"],
                autoPrint: true,
                tipsEnabled: false,
                minCardAmount: 5,
                contactlessLimit: 50,
                paymentTimeout: 120
            },
            display: {
                primaryColor: "#2c3e50",
                fontSize: 100,
                language: "de",
                showImages: true,
                animationsEnabled: true
            },
            receipts: {
                header: "Vielen Dank für Ihren Einkauf!",
                printLogo: true,
                customerCopy: true,
                width: 80,
                detailedItems: false
            },
            security: {
                loginTimeout: 15,
                passwordComplexity: "medium",
                autoLogout: true,
                maxLoginAttempts: 3
            }
        };

        // Load settings
        function loadSettings() {
            const saved = JSON.parse(localStorage.getItem('posSettings')) || defaultSettings;
            
            // General
            document.getElementById('shopName').value = saved.general.shopName;
            document.getElementById('currency').value = saved.general.currency;
            document.getElementById('taxId').value = saved.general.taxId;
            document.getElementById('timezone').value = saved.general.timezone;
            document.querySelector(`input[name="dateFormat"][value="${saved.general.dateFormat}"]`).checked = true;
            document.getElementById('notificationDuration').value = saved.general.notificationDuration;

            // Payment
            document.querySelectorAll('.payment-method').forEach(cb => {
                cb.checked = saved.payment.methods.includes(cb.value);
            });
            document.getElementById('autoPrint').checked = saved.payment.autoPrint;
            document.getElementById('tipsEnabled').checked = saved.payment.tipsEnabled;
            document.getElementById('minCardAmount').value = saved.payment.minCardAmount;
            document.getElementById('contactlessLimit').value = saved.payment.contactlessLimit;
            document.getElementById('paymentTimeout').value = saved.payment.paymentTimeout;

            // Display
            document.getElementById('primaryColor').value = saved.display.primaryColor;
            document.getElementById('fontSize').value = saved.display.fontSize;
            document.getElementById('fontSizeValue').textContent = `${saved.display.fontSize}%`;
            document.getElementById('language').value = saved.display.language;
            document.getElementById('showImages').checked = saved.display.showImages;
            document.getElementById('animationsEnabled').checked = saved.display.animationsEnabled;

            // Receipts
            document.getElementById('receiptHeader').value = saved.receipts.header;
            document.getElementById('printLogo').checked = saved.receipts.printLogo;
            document.getElementById('printCustomerCopy').checked = saved.receipts.customerCopy;
            document.getElementById('receiptWidth').value = saved.receipts.width;
            document.getElementById('detailedItems').checked = saved.receipts.detailedItems;

            // Security
            document.getElementById('loginTimeout').value = saved.security.loginTimeout;
            document.getElementById('passwordComplexity').value = saved.security.passwordComplexity;
            document.getElementById('autoLogout').checked = saved.security.autoLogout;
            document.getElementById('maxLoginAttempts').value = saved.security.maxLoginAttempts;

            applyVisualSettings(saved);
        }

        // Save settings
        function saveSettings() {
            const settings = {
                general: {
                    shopName: document.getElementById('shopName').value,
                    currency: document.getElementById('currency').value,
                    taxId: document.getElementById('taxId').value,
                    timezone: document.getElementById('timezone').value,
                    dateFormat: document.querySelector('input[name="dateFormat"]:checked').value,
                    notificationDuration: parseInt(document.getElementById('notificationDuration').value)
                },
                payment: {
                    methods: Array.from(document.querySelectorAll('.payment-method:checked')).map(cb => cb.value),
                    autoPrint: document.getElementById('autoPrint').checked,
                    tipsEnabled: document.getElementById('tipsEnabled').checked,
                    minCardAmount: parseFloat(document.getElementById('minCardAmount').value),
                    contactlessLimit: parseFloat(document.getElementById('contactlessLimit').value),
                    paymentTimeout: parseInt(document.getElementById('paymentTimeout').value)
                },
                display: {
                    primaryColor: document.getElementById('primaryColor').value,
                    fontSize: parseInt(document.getElementById('fontSize').value),
                    language: document.getElementById('language').value,
                    showImages: document.getElementById('showImages').checked,
                    animationsEnabled: document.getElementById('animationsEnabled').checked
                },
                receipts: {
                    header: document.getElementById('receiptHeader').value,
                    printLogo: document.getElementById('printLogo').checked,
                    customerCopy: document.getElementById('printCustomerCopy').checked,
                    width: parseInt(document.getElementById('receiptWidth').value),
                    detailedItems: document.getElementById('detailedItems').checked
                },
                security: {
                    loginTimeout: parseInt(document.getElementById('loginTimeout').value),
                    passwordComplexity: document.getElementById('passwordComplexity').value,
                    autoLogout: document.getElementById('autoLogout').checked,
                    maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value)
                }
            };

            localStorage.setItem('posSettings', JSON.stringify(settings));
            applyVisualSettings(settings);
            
            // Show success message
            const btn = document.getElementById('saveSettings');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Gespeichert!';
            btn.classList.add('btn-success');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-primary');
            }, 2000);
        }

        // Apply visual settings
        function applyVisualSettings(settings) {
            document.documentElement.style.setProperty('--accent', settings.display.primaryColor);
            document.documentElement.style.fontSize = `${settings.display.fontSize}%`;
        }

        // Event Listeners
        document.getElementById('saveSettings').addEventListener('click', saveSettings);
        document.getElementById('fontSize').addEventListener('input', function() {
            document.getElementById('fontSizeValue').textContent = `${this.value}%`;
        });

        // Reset functionality
        document.getElementById('resetSettings').addEventListener('click', () => {
            if(confirm('Alle Einstellungen zurücksetzen?')) {
                localStorage.removeItem('posSettings');
                loadSettings();
                alert('Einstellungen wurden zurückgesetzt!');
            }
        });

        // Export/Import
        document.getElementById('exportSettings').addEventListener('click', () => {
            const settings = JSON.parse(localStorage.getItem('posSettings')) || defaultSettings;
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(settings, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "system_settings.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        });

        document.getElementById('importSettings').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const settings = JSON.parse(e.target.result);
                    localStorage.setItem('posSettings', JSON.stringify(settings));
                    loadSettings();
                    alert('Einstellungen wurden erfolgreich importiert!');
                } catch (error) {
                    alert('Fehler beim Import: Ungültiges Dateiformat');
                }
            };
            reader.readAsText(file);
        });

        // Initial load
        window.addEventListener('load', loadSettings);
    </script>
</body>
</html>